<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="CS144 - https://Tryanel.github.io/cs144/">
    <meta name="author" content="SantonLee - https://Tryanel.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>CS144</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css" />
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" />
    
    <link rel="stylesheet" href="https://Tryanel.github.io/style.min.6bbccf0916939df698171c34d30f896276712c30bd56be0d7fd8023e1b00c3d9.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate ">
        <div class="cool-before" style=""></div>
        <div id="header" class=""><div class="container-header">
    
    
    <div class="right">
        
        <h1 class="title">CS144</h1>
    
        
            
            <div id="toc">ğŸ“œ</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2024-09-26&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2024-09-26&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            14503 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            29 åˆ†é’Ÿ</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/cs">cs</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#lab0">lab0</a>
      <ul>
        <li><a href="#networking-by-hand">Networking by hand</a></li>
        <li><a href="#writing-a-network-program-using-an-os-stream-socket">Writing a network program using an OS stream socket</a></li>
      </ul>
    </li>
    <li><a href="#lab1">lab1</a>
      <ul>
        <li><a href="#getting-started">Getting started</a></li>
        <li><a href="#putting-substrings-in-sequence">Putting substrings in sequence</a></li>
      </ul>
    </li>
    <li><a href="#lab-2">lab 2</a>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#getting-started-1">Getting started</a></li>
        <li><a href="#checkpoint-2-the-tcp-receiver">Checkpoint 2: The TCP Receiver</a></li>
      </ul>
    </li>
    <li><a href="#lab-3">lab 3</a>
      <ul>
        <li><a href="#overview-1">Overview</a></li>
        <li><a href="#getting-started-2">Getting started</a></li>
        <li><a href="#checkpoint-3-the-tcp-sender">Checkpoint 3: The TCP Sender</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h1 id="cs144">CS144</h1>
<h2 id="lab0">lab0</h2>
<p><a href="https://tryanel.github.io/Documents/check0.pdf">lab0æ–‡æ¡£</a></p>
<h3 id="networking-by-hand">Networking by hand</h3>
<p>ä¸»è¦æ˜¯ä¸€äº›å‘½ä»¤è¡Œæ“ä½œ</p>
<h4 id="fetch-a-web-page">Fetch a Web page</h4>
<ol>
<li>
<p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code>http://cs144.keithw.org/hello</code>å°†ä¼šçœ‹åˆ°<code>Hello, CS144!</code></p>
</li>
<li>
<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥<code>telnet cs144.keithw.org http</code>å°†ä¼šçœ‹åˆ°</p>
<img src="./imgs/image-20240603212753989.png" alt="image-20240603212753989" style="zoom:80%;" />
<p>æ­¤æ—¶æœåŠ¡å™¨æ­£åœ¨ç­‰å¾…æˆ‘ä»¬çš„è¯·æ±‚ï¼Œå¯ä»¥è¾“å…¥è¿™æ®µä»£ç ï¼Œå…·ä½“å«ä¹‰äº†è§£HTTPåè®®å°±çŸ¥é“ï¼Œè¾“å…¥å®Œäº†è®°å¾—æŒ‰ä¸¤ä¸‹å›è½¦ï¼ˆHTTPçš„åŒ…æ ¼å¼ï¼Œè¿˜è®°å¾—åˆšå¼€å§‹æˆ‘åªæŒ‰äº†ä¸€æ¬¡å›è½¦ï¼Œç»“æœå°±æ˜¯è¶…æ—¶æ²¡æœ‰ååº”ï¼Œå…¶å®æ˜¯æ ¼å¼ä¸å®Œæ•´ï¼ŒæœåŠ¡å™¨ä¹Ÿä¸ä¼šåšå‡ºå“åº”ï¼Œæ‰€ä»¥å°±è¶…æ—¶äº†ï¼Œå› æ­¤ä¸€å®šè¦æœ‰ä¸¤ä¸ªå›è½¦æ¢è¡Œï¼‰ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#008080">$telnet</span> cs144.keithw.org http
</span></span><span style="display:flex;"><span>Trying 104.196.238.229...
</span></span><span style="display:flex;"><span>Connected to cs144.keithw.org.
</span></span><span style="display:flex;"><span>Escape character is <span style="color:#d14">&#39;^]&#39;</span>.
</span></span><span style="display:flex;"><span>GET /hello HTTP/1.1
</span></span><span style="display:flex;"><span>Host: cs144.keithw.org
</span></span><span style="display:flex;"><span>Connection: close
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#099">200</span> OK
</span></span><span style="display:flex;"><span>Date: Tue, <span style="color:#099">04</span> Jun <span style="color:#099">2024</span> 12:31:28 GMT
</span></span><span style="display:flex;"><span>Server: Apache
</span></span><span style="display:flex;"><span>Last-Modified: Thu, <span style="color:#099">13</span> Dec <span style="color:#099">2018</span> 15:45:29 GMT
</span></span><span style="display:flex;"><span>ETag: <span style="color:#d14">&#34;e-57ce93446cb64&#34;</span>
</span></span><span style="display:flex;"><span>Accept-Ranges: bytes
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#099">14</span>
</span></span><span style="display:flex;"><span>Connection: close
</span></span><span style="display:flex;"><span>Content-Type: text/plain
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Hello, CS144!
</span></span><span style="display:flex;"><span>Connection closed by foreign host.
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æ ¹æ®è¦æ±‚å‘é€ SUNet ID æ¥è·å– secret codeã€‚å› ä¸ºå¹¶æ²¡æœ‰çœŸå®çš„ IDï¼Œæ‰€ä»¥è¿™é‡Œç”¨éšæœºçš„æ•°å­—æ›¿ä»£ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#008080">$telnet</span> cs144.keithw.org http
</span></span><span style="display:flex;"><span>Trying 104.196.238.229...
</span></span><span style="display:flex;"><span>Connected to cs144.keithw.org.
</span></span><span style="display:flex;"><span>Escape character is <span style="color:#d14">&#39;^]&#39;</span>.
</span></span><span style="display:flex;"><span>GET /lab0/1234 HTTP/1.1
</span></span><span style="display:flex;"><span>Host: cs144.keithw.org
</span></span><span style="display:flex;"><span>Connetction: close
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#099">200</span> OK
</span></span><span style="display:flex;"><span>Date: Tue, <span style="color:#099">04</span> Jun <span style="color:#099">2024</span> 12:37:10 GMT
</span></span><span style="display:flex;"><span>Server: Apache
</span></span><span style="display:flex;"><span>X-You-Said-Your-SunetID-Was: <span style="color:#099">1234</span>
</span></span><span style="display:flex;"><span>X-Your-Code-Is: <span style="color:#099">997233</span>
</span></span><span style="display:flex;"><span>Content-length: <span style="color:#099">108</span>
</span></span><span style="display:flex;"><span>Vary: Accept-Encoding
</span></span><span style="display:flex;"><span>Content-Type: text/plain
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Hello! You told us that your SUNet ID was <span style="color:#d14">&#34;1234&#34;</span>. Please see the HTTP headers <span style="color:#000;font-weight:bold">(</span>above<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">for</span> your secret code.
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h4 id="send-yourself-an-email">Send yourself an email</h4>
<p>è¿™é‡Œéœ€è¦çœŸå®çš„SUNet IDï¼Œæ‰€ä»¥ä¸åšäº†ã€‚</p>
<h4 id="listening-and-connecting">Listening and connecting</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># terminal 1</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">$netcat</span> -v -l -p <span style="color:#099">9090</span>
</span></span><span style="display:flex;"><span>Listening on 0.0.0.0 <span style="color:#099">9090</span>
</span></span><span style="display:flex;"><span>Connection received on localhost <span style="color:#099">49336</span>
</span></span><span style="display:flex;"><span>hello
</span></span><span style="display:flex;"><span>ä½ å¥½
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># terminal 2</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">$telnet</span> localhost <span style="color:#099">9090</span>
</span></span><span style="display:flex;"><span>Trying 127.0.0.1...
</span></span><span style="display:flex;"><span>Connected to localhost.
</span></span><span style="display:flex;"><span>Escape character is <span style="color:#d14">&#39;^]&#39;</span>.
</span></span><span style="display:flex;"><span>hello
</span></span><span style="display:flex;"><span>ä½ å¥½
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="writing-a-network-program-using-an-os-stream-socket">Writing a network program using an OS stream socket</h3>
<p>å…ˆæŠŠminnowä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼š<code>git clone https://github.com/cs144/minnow</code></p>
<h4 id="writing-webget">Writing webget</h4>
<p>æ–‡æ¡£é‡è¦ä¿¡æ¯ï¼š</p>
<p>Itâ€™s time to implement <strong>webget</strong>, a program to fetch Web pages over the Internet using the operating systemâ€™s TCP support and stream-socket abstractionâ€”â€”just like you did by hand earlier in this lab.</p>
<ol>
<li>From the build directory, open the file <code>../apps/webget.cc</code> in a text editor or IDE.</li>
<li>In the <code>get_URL</code> function, find the comment starting <code>// Your code here.</code></li>
<li>Implement the simple Web client as described in this file, using the format of an HTTP (Web) request that you used earlier. Use the <code>TCPSocket</code> and <code>Address</code> classes.</li>
<li>Hints:</li>
</ol>
<ul>
<li>Please note that in HTTP, each line must be ended with <code>\r\n</code> (itâ€™s not sufficient to use just <code>\n</code> or <code>endl</code>).</li>
<li>Donâ€™t forget to include the <code>Connection: close</code> line in your clientâ€™s request. This tells the server that it shouldnâ€™t wait around for your client to send any more requests after this one. Instead, the server will send one reply and then will immediately end its outgoing bytestream (the one from the serverâ€™s socket to your socket). Youâ€™ll discover that your incoming byte stream has ended because your socket will reach â€œEOFâ€ (end of file) when you have read the entire byte stream coming from the server. Thatâ€™s how your client will know that the server has finished its reply.</li>
<li>Make sure to read and print all the output from the server until the socket reaches â€œEOFâ€ (end of file)â€”<strong>a single call to read is not enough</strong>.</li>
<li>We expect youâ€™ll need to write about ten lines of code.</li>
</ul>
<p>è¯»å®Œäº†ä¹‹åå°±å¯ä»¥å»å®ç°<code>webget.cc</code>æ–‡ä»¶çš„<code>get_URL</code>å‡½æ•°ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">get_URL</span>( <span style="color:#000;font-weight:bold">const</span> string<span style="color:#000;font-weight:bold">&amp;</span> host, <span style="color:#000;font-weight:bold">const</span> string<span style="color:#000;font-weight:bold">&amp;</span> path )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// cerr &lt;&lt; &#34;Function called: get_URL(&#34; &lt;&lt; host &lt;&lt; &#34;, &#34; &lt;&lt; path &lt;&lt; &#34;)\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// cerr &lt;&lt; &#34;Warning: get_URL() has not been implemented yet.\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">auto</span> sc <span style="color:#000;font-weight:bold">=</span> TCPSocket();	<span style="color:#998;font-style:italic">// åˆ›å»ºå¥—æ¥å­—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">auto</span> addr <span style="color:#000;font-weight:bold">=</span> Address(host, <span style="color:#d14">&#34;http&#34;</span>);	<span style="color:#998;font-style:italic">// è¿æ¥æœåŠ¡å™¨çš„åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>  sc.connect(addr);	<span style="color:#998;font-style:italic">// è¿æ¥æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å‘é€HTTPè¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  sc.write(<span style="color:#d14">&#34;GET &#34;</span>);
</span></span><span style="display:flex;"><span>  sc.write(path);
</span></span><span style="display:flex;"><span>  sc.write(<span style="color:#d14">&#34; HTTP/1.1</span><span style="color:#d14">\r\n</span><span style="color:#d14">&#34;</span>);
</span></span><span style="display:flex;"><span>  sc.write(<span style="color:#d14">&#34;Host: &#34;</span>);
</span></span><span style="display:flex;"><span>  sc.write(host);
</span></span><span style="display:flex;"><span>  sc.write(<span style="color:#d14">&#34;</span><span style="color:#d14">\r\n</span><span style="color:#d14">&#34;</span>);
</span></span><span style="display:flex;"><span>  sc.write(<span style="color:#d14">&#34;Connection: close</span><span style="color:#d14">\r\n\r\n</span><span style="color:#d14">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// åŠå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  sc.shutdown(SHUT_WR);
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">while</span> (<span style="color:#000;font-weight:bold">!</span>sc.eof()) {
</span></span><span style="display:flex;"><span>    string buf;
</span></span><span style="display:flex;"><span>    sc.read(buf);
</span></span><span style="display:flex;"><span>    cout <span style="color:#000;font-weight:bold">&lt;&lt;</span> buf;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  sc.close();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ç°å®Œæˆä½¿ç”¨<code>cmake --build build</code>ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶åœ¨buildç›®å½•ä¸‹ï¼Œè¿›å…¥buildç›®å½•æ‰§è¡Œ<code>./apps/webget cs144.keithw.org /hello</code>å‘½ä»¤åå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>HTTP/1.1 <span style="color:#099">200</span> OK
</span></span><span style="display:flex;"><span>Date: Fri, <span style="color:#099">06</span> Sep <span style="color:#099">2024</span> 09:02:09 GMT
</span></span><span style="display:flex;"><span>Server: Apache
</span></span><span style="display:flex;"><span>Last-Modified: Thu, <span style="color:#099">13</span> Dec <span style="color:#099">2018</span> 15:45:29 GMT
</span></span><span style="display:flex;"><span>ETag: <span style="color:#d14">&#34;e-57ce93446cb64&#34;</span>
</span></span><span style="display:flex;"><span>Accept-Ranges: bytes
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#099">14</span>
</span></span><span style="display:flex;"><span>Connection: close
</span></span><span style="display:flex;"><span>Content-Type: text/plain
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Hello, CS144!
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ç»“æœä¸ä¹‹å‰çš„ä¸€è‡´</p>
<p>å®Œæˆè¿™äº›åæ‰§è¡Œ<code>make check_webget</code>è¿›è¡Œæµ‹è¯•ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Cat@Cat:~/exing/CS144/minnow/build<span style="color:#008080">$make</span> check_webget
</span></span><span style="display:flex;"><span>Test project /home/cat/exing/CS144/minnow/build
</span></span><span style="display:flex;"><span>    Start 1: compile with bug-checkers
</span></span><span style="display:flex;"><span>1/2 Test <span style="color:#998;font-style:italic">#1: compile with bug-checkers ........   Passed    3.15 sec</span>
</span></span><span style="display:flex;"><span>    Start 2: t_webget
</span></span><span style="display:flex;"><span>2/2 Test <span style="color:#998;font-style:italic">#2: t_webget .........................   Passed    1.52 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#099">0</span> tests failed out of <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#0086b3">time</span> <span style="color:#000;font-weight:bold">(</span>real<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span>   4.67 sec
</span></span><span style="display:flex;"><span>Built target check_webget
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤å¯ä»¥è¿›å…¥ä¸‹ä¸€é˜¶æ®µ</p>
<h4 id="an-in-memory-reliable-byte-stream">An in-memory reliable byte stream</h4>
<blockquote>
<p>By now, youâ€™ve seen how the abstraction of a reliable byte stream can be useful in communicating across the Internet, even though the Internet itself only provides the service of &ldquo;best-effort&rdquo; (unreliable) datagrams.</p>
<p>To finish off this weekâ€™s lab, you will implement, in memory on a single computer, an object that provides this abstraction. (You may have done something similar in CS 110.) Bytes are written on the â€œinputâ€ side and can be read, in the same sequence, from the â€œoutputâ€ side. The byte stream is finite: the writer can end the input, and then no more bytes can be written. When the reader has read to the end of the stream, it will reach â€œEOFâ€ (end of file) and no more bytes can be read.</p>
<p>Your byte stream will also be flow-controlled to limit its memory consumption at any given time. The object is initialized with a particular â€œcapacityâ€: the maximum number of bytes itâ€™s willing to store in its own memory at any given point. The byte stream will limit the writer in how much it can write at any given moment, to make sure that the stream doesnâ€™t exceed its storage capacity. As the reader reads bytes and drains them from the stream, the writer is allowed to write more. Your byte stream is for use in a single threadâ€”you donâ€™t have to worry about concurrent writers/readers, locking, or race conditions.</p>
<p>To be clear: the byte stream is finite, but it can be almost arbitrarily long before the writer ends the input and finishes the stream. Your implementation must be able to handle streams that are much longer than the capacity. The capacity limits the number of bytes that are held in memory (written but not yet read) at a given point, but does not limit the length of the stream. An object with a capacity of only one byte could still carry a stream that is terabytes and terabytes long, as long as the writer keeps writing one byte at a time and the reader reads each byte before the writer is allowed to write the next byte.</p>
</blockquote>
<p>æ³¨æ„ä¸Šé¢æåˆ°ä¸€ä¸ªæ¦‚å¿µâ€œEOFâ€ï¼Œæ„æ€æ˜¯å­—èŠ‚æµä¸­writerç«¯é¦–å…ˆå…³é—­äº†ï¼Œå…¶æ¬¡readerç«¯å°†æ‰€æœ‰çš„å­—èŠ‚å…¨éƒ¨è¯»å–å®Œäº†ï¼Œæ­¤æ—¶å­—èŠ‚æµè¾¾åˆ°äº†EOFã€‚</p>
<p>ç°åœ¨è¦æ±‚æˆ‘ä»¬å®ç°ä»¥ä¸‹å‡½æ•°ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Hereâ€™s what the interface looks like for the writer:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">push</span>( std<span style="color:#000;font-weight:bold">::</span>string data ); <span style="color:#998;font-style:italic">// Push data to stream, but only as much as available capacity allows.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">close</span>(); <span style="color:#998;font-style:italic">// Signal that the stream has reached its ending. Nothing more will be written.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">is_closed</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Has the stream been closed?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">available_capacity</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// How many bytes can be pushed to the stream right now?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">bytes_pushed</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Total number of bytes cumulatively pushed to the stream
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// And here is the interface for the reader:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>std<span style="color:#000;font-weight:bold">::</span>string_view peek() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Peek at the next bytes in the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">pop</span>( <span style="color:#458;font-weight:bold">uint64_t</span> len ); <span style="color:#998;font-style:italic">// Remove `len` bytes from the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">is_finished</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Is the stream finished (closed and fully popped)?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">has_error</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Has the stream had an error?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">bytes_buffered</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Number of bytes currently buffered (pushed and not popped)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">bytes_popped</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Total number of bytes cumulatively popped from stream
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">	å¯ä»¥æ ¹æ®è¿™å‡ ä¸ªéœ€æ±‚æ„æ€å¦‚ä½•å®ç°ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•å®ç°å­—èŠ‚æµï¼Œè¿™é‡Œå†³å®šä½¿ç”¨éå¸¸å·§å¦™çš„ç¯çŠ¶å­—èŠ‚æµå®ç°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">	ç©ºé—´çš„å¾ªç¯åˆ©ç”¨ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨æ¨¡è¿ç®—ï¼Œç°åœ¨å¾ˆå¤šç¼“å­˜å¤§å°ä¹Ÿæ˜¯è¿™æ ·è®¡ç®—ã€‚å…¶ä½™åªéœ€è¦æ ¹æ®æ³¨é‡Šæç¤ºåœ¨è®¾ç½®ä¸€ä¸ªbuf
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">	ä¸€ä¸ªtotal numberç»Ÿè®¡å†™çš„æ€»æ•°ï¼Œä¸€ä¸ªtotal numberç»Ÿè®¡è¯»çš„æ€»æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ªboolå˜é‡æ ‡è®°bufferæ˜¯å¦å…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®æ³¨é‡Šçš„æè¿°ä»¥åŠæ–‡æ¡£çš„è®²è¿°è¡¥å……<code>byte_stream.hh</code>æ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;cstdint&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;string&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;string_view&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;vector&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Reader</span>;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Writer</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ByteStream</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">explicit</span> ByteStream( <span style="color:#458;font-weight:bold">uint64_t</span> capacity );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Helper functions (provided) to access the ByteStream&#39;s Reader and Writer interfaces
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  Reader<span style="color:#000;font-weight:bold">&amp;</span> reader();
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> Reader<span style="color:#000;font-weight:bold">&amp;</span> reader() <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span>  Writer<span style="color:#000;font-weight:bold">&amp;</span> writer();
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> Writer<span style="color:#000;font-weight:bold">&amp;</span> writer() <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">set_error</span>() { error_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>; };       <span style="color:#998;font-style:italic">// Signal that the stream suffered an error.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">has_error</span>() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> error_; }; <span style="color:#998;font-style:italic">// Has the stream had an error?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">protected</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Please add any additional state to the ByteStream here, and not to the Writer and Reader interfaces.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> capacity_;
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> error_ {};
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// ä¸‹é¢å››è¡Œä¸ºè¡¥å……
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  std<span style="color:#000;font-weight:bold">::</span>vector<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">&gt;</span> buf_;
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint64_t</span> nread_;
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint64_t</span> nwrite_;
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> is_closed_;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Writer</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">public</span> ByteStream
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> push( std<span style="color:#000;font-weight:bold">::</span>string data ); <span style="color:#998;font-style:italic">// Push data to stream, but only as much as available capacity allows.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">close</span>();                  <span style="color:#998;font-style:italic">// Signal that the stream has reached its ending. Nothing more will be written.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">is_closed</span>() <span style="color:#000;font-weight:bold">const</span>;              <span style="color:#998;font-style:italic">// Has the stream been closed?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">available_capacity</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// How many bytes can be pushed to the stream right now?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">bytes_pushed</span>() <span style="color:#000;font-weight:bold">const</span>;       <span style="color:#998;font-style:italic">// Total number of bytes cumulatively pushed to the stream
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Reader</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">public</span> ByteStream
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  std<span style="color:#000;font-weight:bold">::</span>string_view peek() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Peek at the next bytes in the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">pop</span>( <span style="color:#458;font-weight:bold">uint64_t</span> len );      <span style="color:#998;font-style:italic">// Remove `len` bytes from the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">is_finished</span>() <span style="color:#000;font-weight:bold">const</span>;        <span style="color:#998;font-style:italic">// Is the stream finished (closed and fully popped)?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">bytes_buffered</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// Number of bytes currently buffered (pushed and not popped)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">bytes_popped</span>() <span style="color:#000;font-weight:bold">const</span>;   <span style="color:#998;font-style:italic">// Total number of bytes cumulatively popped from stream
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * read: A (provided) helper function thats peeks and pops up to `len` bytes
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * from a ByteStream Reader into a string;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">read</span>( Reader<span style="color:#000;font-weight:bold">&amp;</span> reader, <span style="color:#458;font-weight:bold">uint64_t</span> len, std<span style="color:#000;font-weight:bold">::</span>string<span style="color:#000;font-weight:bold">&amp;</span> out );
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¡¥å……åå®ç°<code>byte_stream.cc</code>æ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;byte_stream.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">using</span> <span style="color:#000;font-weight:bold">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ByteStream<span style="color:#000;font-weight:bold">::</span>ByteStream( <span style="color:#458;font-weight:bold">uint64_t</span> capacity ) <span style="color:#000;font-weight:bold">:</span> capacity_( capacity ),buf_(vector<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">&gt;</span>(capacity_)) ,nread_(<span style="color:#099">0</span>), nwrite_(<span style="color:#099">0</span>), is_closed_(<span style="color:#0086b3">false</span>){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> Writer<span style="color:#000;font-weight:bold">::</span>is_closed() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> is_closed_;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// return false;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> Writer<span style="color:#000;font-weight:bold">::</span>push( string data )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">const</span> <span style="color:#000;font-weight:bold">auto</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#900;font-weight:bold">item</span> : data) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (nwrite_ <span style="color:#000;font-weight:bold">&gt;=</span> nread_ <span style="color:#000;font-weight:bold">+</span> capacity_) {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    buf_[nwrite_ <span style="color:#000;font-weight:bold">%</span> capacity_] <span style="color:#000;font-weight:bold">=</span> item;	<span style="color:#998;font-style:italic">// å¾ˆä¼˜é›…çš„å­—èŠ‚æµï¼Œå®ç°äº†å¯å¾ªç¯åˆ©ç”¨ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">++</span>nwrite_;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> Writer<span style="color:#000;font-weight:bold">::</span>close()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  is_closed_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> Writer<span style="color:#000;font-weight:bold">::</span>available_capacity() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> capacity_ <span style="color:#000;font-weight:bold">-</span> (nwrite_ <span style="color:#000;font-weight:bold">-</span> nread_);
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// return {};
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> Writer<span style="color:#000;font-weight:bold">::</span>bytes_pushed() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> nwrite_;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// return {};
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> Reader<span style="color:#000;font-weight:bold">::</span>is_finished() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// return nread_ == capacity_;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// return {};
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> is_closed_ <span style="color:#000;font-weight:bold">&amp;&amp;</span> nread_ <span style="color:#000;font-weight:bold">==</span> nwrite_;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> Reader<span style="color:#000;font-weight:bold">::</span>bytes_popped() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> nread_;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// return nread_;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// return {};
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>string_view Reader<span style="color:#000;font-weight:bold">::</span>peek() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span> (nread_ <span style="color:#000;font-weight:bold">==</span> nwrite_) <span style="color:#000;font-weight:bold">return</span> {};
</span></span><span style="display:flex;"><span>  string_view <span style="color:#900;font-weight:bold">sv</span>(<span style="color:#000;font-weight:bold">&amp;</span>buf_[nread_ <span style="color:#000;font-weight:bold">%</span> capacity_], <span style="color:#099">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> sv;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// return {};
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> Reader<span style="color:#000;font-weight:bold">::</span>pop( <span style="color:#458;font-weight:bold">uint64_t</span> len )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// (void)len;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">uint64_t</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> len; <span style="color:#000;font-weight:bold">++</span>i) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (nread_ <span style="color:#000;font-weight:bold">&lt;</span> nwrite_) {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">++</span>nread_;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> Reader<span style="color:#000;font-weight:bold">::</span>bytes_buffered() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span> nwrite_ <span style="color:#000;font-weight:bold">-</span> nread_;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// return {};
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨buildç›®å½•ä¸‹makeï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span> 42%<span style="color:#000;font-weight:bold">]</span> Built target util_debug
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span> 57%<span style="color:#000;font-weight:bold">]</span> Built target minnow_debug
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span> 68%<span style="color:#000;font-weight:bold">]</span> Built target minnow_testing_debug
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span> 78%<span style="color:#000;font-weight:bold">]</span> Built target stream_copy
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span> 89%<span style="color:#000;font-weight:bold">]</span> Built target webget
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>100%<span style="color:#000;font-weight:bold">]</span> Built target tcp_native
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åmake check0</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Test project /home/sniffstherose/cs144/minnow/build
</span></span><span style="display:flex;"><span>      Start  1: compile with bug-checkers
</span></span><span style="display:flex;"><span> 1/10 Test  <span style="color:#998;font-style:italic">#1: compile with bug-checkers ........   Passed    2.78 sec</span>
</span></span><span style="display:flex;"><span>      Start  2: t_webget
</span></span><span style="display:flex;"><span> 2/10 Test  <span style="color:#998;font-style:italic">#2: t_webget .........................   Passed    1.52 sec</span>
</span></span><span style="display:flex;"><span>      Start  3: byte_stream_basics
</span></span><span style="display:flex;"><span> 3/10 Test  <span style="color:#998;font-style:italic">#3: byte_stream_basics ...............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  4: byte_stream_capacity
</span></span><span style="display:flex;"><span> 4/10 Test  <span style="color:#998;font-style:italic">#4: byte_stream_capacity .............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  5: byte_stream_one_write
</span></span><span style="display:flex;"><span> 5/10 Test  <span style="color:#998;font-style:italic">#5: byte_stream_one_write ............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  6: byte_stream_two_writes
</span></span><span style="display:flex;"><span> 6/10 Test  <span style="color:#998;font-style:italic">#6: byte_stream_two_writes ...........   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  7: byte_stream_many_writes
</span></span><span style="display:flex;"><span> 7/10 Test  <span style="color:#998;font-style:italic">#7: byte_stream_many_writes ..........   Passed    0.09 sec</span>
</span></span><span style="display:flex;"><span>      Start  8: byte_stream_stress_test
</span></span><span style="display:flex;"><span> 8/10 Test  <span style="color:#998;font-style:italic">#8: byte_stream_stress_test ..........   Passed    0.13 sec</span>
</span></span><span style="display:flex;"><span>      Start 37: compile with optimization
</span></span><span style="display:flex;"><span> 9/10 Test <span style="color:#998;font-style:italic">#37: compile with optimization ........   Passed    0.69 sec</span>
</span></span><span style="display:flex;"><span>      Start 38: byte_stream_speed_test
</span></span><span style="display:flex;"><span>             ByteStream throughput: 22.85 Gbit/s
</span></span><span style="display:flex;"><span>10/10 Test <span style="color:#998;font-style:italic">#38: byte_stream_speed_test ...........   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#099">0</span> tests failed out of <span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#0086b3">time</span> <span style="color:#000;font-weight:bold">(</span>real<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span>   5.61 sec
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®æ–‡æ¡£æè¿°</p>
<blockquote>
<p>If all tests pass, the check0 test will then run a speed benchmark of your implementation. ==Anything faster than 0.1 Gbit/s== (in other words, 100 million bits per second) is acceptable for purposes of this class. (It is possible for an implementation to perform faster than 10 Gbit/s, but this depends on the speed of your computer and is not required.)</p>
</blockquote>
<p>åˆ°æ­¤lab0æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œæœ€åè®°å¾—gitç®¡ç†ä¸€ä¸‹é¡¹ç›®ä»£ç </p>
<h2 id="lab1">lab1</h2>
<p><a href="https://tryanel.github.io/Documents/check1.pdf">lab1æ–‡æ¡£</a></p>
<h3 id="getting-started">Getting started</h3>
<p>é¦–å…ˆåˆå¹¶lab1å’Œlab0çš„ä»£ç ï¼šåœ¨ä¸â€œminnowâ€åŒçº§ç›®å½•ä¸‹æ‰§è¡Œ<code>git merge origin/check1-startercode</code>ç„¶ååˆå§‹åŒ–ä¸€ä¸‹buildç³»ç»Ÿ<code>cmake -S . -B build</code>ï¼Œæœ€åå†buildä¸€ä¸‹ï¼š<code>cmake --build build</code></p>
<h3 id="putting-substrings-in-sequence">Putting substrings in sequence</h3>
<blockquote>
<p>As part of the lab assignment, you will implement a TCP receiver: the module that receives datagrams and turns them into a reliable byte stream to be read from the socket by the applicationâ€”just as your webget program read the byte stream from the webserver in Checkpoint 0.</p>
<p>The TCP sender is dividing its byte stream up into short segments (substrings no more than about 1,460 bytes apiece) so that they each fit inside a datagram. But the network might reorder these datagrams, or drop them, or deliver them more than once. The receiver must reassemble the segments into the contiguous stream of bytes that they started out as.</p>
<p>In this lab youâ€™ll write the data structure that will be responsible for this reassembly: a Reassembler. It will receive substrings, consisting of a string of bytes, and the index of the first byte of that string within the larger stream. Each byte of the stream has its own unique index, starting from zero and counting upwards. As soon as the Reassembler knows the next byte of the stream, it will write it to the Writer side of a ByteStreamâ€” the same ByteStream you implemented in checkpoint 0. The Reassemblerâ€™s â€œcustomerâ€ can read from the Reader side of the same ByteStream.</p>
</blockquote>
<p>é‡è¦ä¿¡æ¯ï¼š</p>
<ul>
<li>ç½‘ç»œå¯èƒ½ä¼šé€ æˆæ•°æ®æŠ¥é‡æ–°æ’åºã€ä¸¢å¼ƒæˆ–å¤šæ¬¡ä¼ é€</li>
<li>æ¥æ”¶æ–¹å¿…é¡»å°†Segmenté‡æ–°ç»„åˆï¼Œä½¿å…¶è¿ç»­</li>
<li>æ¯ä¸ªå­å­—ç¬¦ä¸²éƒ½æœ‰ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç´¢å¼•</li>
<li>æµçš„æ¯ä¸ªå­—èŠ‚éƒ½æœ‰å”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸”ä»0å¼€å§‹</li>
<li>æµçš„ä¸‹ä¸€å­—èŠ‚è¢«é‡ç»„å™¨æ¥å—åº”å½“ç«‹é©¬å°†å…¶å†™å…¥æµçš„Writerç«¯</li>
</ul>
<p>psï¼šæˆ‘ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªï¼Ÿ</p>
<p><img src="./imgs/image-20240925191916703.png" alt="image-20240925191916703"></p>
<p>å…ˆæ”¾ä¸Šæ•´ä¸ªé¡¹ç›®å®ç°çš„ä¸œè¥¿ï¼š</p>
<img src="./imgs/image-20240910092821539.png" alt="image-20240910092821539"  />
<p>æ€»ç»“æ–‡æ¡£å†…å®¹å¤§æ¦‚å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬åœ¨lab0å®ç°äº†å­—èŠ‚æµï¼ˆByteStreaméƒ¨åˆ†ï¼‰ï¼Œç°åœ¨lab1è¦å®ç°StreamReassemblerï¼Œè¿™éƒ¨åˆ†æ˜¯TCPå¯é ä¼ è¾“çš„ä¿è¯ï¼Œä½¿ç”¨æ»‘åŠ¨çª—å£æ€æƒ³å®ç°ã€‚å‚è€ƒä¸‹å›¾ï¼š</p>
<img src="./imgs/image-20240910093038165.png" alt="image-20240910093038165"  />
<p>å…¶ä¸­è“è‰²éƒ¨åˆ†ä¸ºå·²ç»ç¼“å­˜å¹¶ä¸”è¯»èµ°çš„å­—èŠ‚ï¼Œç»¿è‰²éƒ¨åˆ†ä¸ºå­—èŠ‚æµä¸­ç¼“å­˜çš„æœªè¢«è¯»èµ°å­—èŠ‚ï¼Œçº¢è‰²éƒ¨åˆ†ä¸ºç¼“å­˜åœ¨Reassemblerå†…å­˜ä¸­çš„å­—èŠ‚ï¼ˆä¸€èˆ¬æ˜¯substringçš„indexä¸å¯¹ï¼Œå…ˆç¼“å­˜åœ¨è¿™é‡Œé¢ï¼Œç­‰é¡ºåºæ­£ç¡®åå†å°†å…¶æ”¾å…¥ByteStreamä¸­ï¼‰ã€‚æ¯”è¾ƒå¤æ‚çš„åº”è¯¥æ˜¯å¦‚ä½•ç¼“å­˜ï¼Œå¹¶ä¸”è®©å…¶é‡æ–°æœ‰åºã€‚</p>
<h4 id="what-should-the-reassembler-store-internally">What should the Reassembler store internally?</h4>
<ol>
<li>Bytes that are the next bytes in the stream. The Reassembler should push these to the stream (output .writer()) as soon as they are known.</li>
<li>Bytes that fit within the streamâ€™s available capacity but canâ€™t yet be written, because earlier bytes remain unknown. These should be stored internally in the Reassembler.</li>
<li>Bytes that lie beyond the streamâ€™s available capacity. These should be discarded. The Reassemblerâ€™s will not store any bytes that canâ€™t be pushed to the ByteStream either immediately, or as soon as earlier bytes become known.</li>
</ol>
<p>éœ€æ±‚åˆ†æï¼š</p>
<ul>
<li>ä¸€ä¸ªå˜é‡ä¿å­˜é‡ç»„å™¨çš„æœŸå¾…åºåˆ—ï¼›</li>
<li>æ¥æ”¶åˆ°äº†ç¼ºå¤±éƒ¨åˆ†å­—èŠ‚çš„å­—èŠ‚åˆ†ç»„ï¼Œå¹¶ä¸”å­—èŠ‚åˆ†ç»„çš„å¤§å°ä¸è¶…è¿‡ByteStreamçš„å®¹é‡åˆ™å°†å…¶å­˜åœ¨é‡ç»„å™¨çš„ç¼“å­˜ä¸­ï¼›</li>
<li>æ¥æ”¶åˆ°äº†first_indexä¸åœ¨æ¥æ”¶èŒƒå›´å†…çš„å­—èŠ‚åˆ†ç»„ç›´æ¥ä¸¢å¼ƒï¼Œå› ä¸ºByteStreamå¤„ç†ä¸äº†è¯¥å­—èŠ‚åˆ†ç»„ï¼›</li>
<li>å½“é‡ç»„å™¨å¾—åˆ°äº†ç¼ºå¤±çš„å­—èŠ‚åˆ†ç»„æ—¶è¦ç«‹åˆ»å°†ç¼“å†²åŒºä¸­æ‰€æœ‰èƒ½è¢«æ¨å…¥çš„å­—èŠ‚æ¨å…¥ByteStreamä¸­ã€‚ï¼ˆè¶…å‡ºå®¹é‡å°±æˆªæ–­ï¼‰ï¼›</li>
<li>è€ƒè™‘ç‰¹æ®Šæƒ…å†µï¼šfirst_indexåœ¨æ¥æ”¶èŒƒå›´å†…ï¼Œä½†æ˜¯å­—èŠ‚æœ¬èº«é•¿åº¦å¤§äºå®¹é‡çš„åˆ†ç»„ï¼Œåˆ™æˆªæ–­åç¼“å­˜æˆ–æ¨å…¥ByteStreamã€‚</li>
</ul>
<p>ç¨‹åºå®ç°ï¼š</p>
<ol>
<li>
<p>ä¸€ä¸ªuint64_tç±»å‹çš„å˜é‡è®°å½•æœŸå¾…çš„åºåˆ—å·ï¼Œæ¯æ¬¡ç¼“å­˜æˆ–æ¨å…¥åªéœ€åŠ ä¸Šæœ¬æ¬¡å®é™…ç¼“å­˜æˆ–æ¨å…¥å­—èŠ‚çš„é•¿åº¦ç»´æŠ¤å¥½è¿™ä¸ªå˜é‡å³å¯ï¼›</p>
</li>
<li>
<p>è¶…å‡ºByteStreamå®¹é‡çš„åˆ†ç»„å¯ä»¥åˆ©ç”¨ä¸Šè¿°å˜é‡è¿›è¡Œåˆ†ç±»ï¼Œå°½å¿«æ‰¾å‡ºåº”å½“æŠ›å¼ƒçš„åˆ†ç»„ï¼Œå¹¶æŠŠç¼ºå¤±æ•°æ®ã€ç¬¦åˆæ¡ä»¶çš„æ•°æ®æ¨å…¥ç¼“å†²åŒºï¼›</p>
</li>
<li>
<p>æœ‰åºä¸”å”¯ä¸€çš„å­˜å‚¨æ•°æ®åˆ†ç»„ï¼š</p>
<p>è¿™éƒ¨åˆ†æ¯”è¾ƒå¤æ‚ï¼Œå¤ä¹ çš„æ—¶å€™ä¸€å®šè¦è¯¦ç»†é˜…è¯»ä»£ç å¹¶ç»“åˆç”»å›¾ã€‚</p>
<p>é¦–å…ˆè€ƒè™‘æ•°æ®ç»“æ„ï¼Œå› ä¸ºè¦é¢‘ç¹åœ°æ’å…¥åˆ é™¤ï¼Œæ‰€ä»¥æ•°ç»„é¦–å…ˆæ’é™¤ï¼Œå…¶æ“ä½œæˆæœ¬å¤ªé«˜ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬éœ€è¦æœ‰åºåœ°å­˜å‚¨æ•°æ®åˆ†ç»„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•°æ®ç»“æ„ï¼šmapã€setã€listï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åœ¨åŒºé—´[first_index, first_index + data.size]ä¸Šä¸æ–­åœ°æ¯”è¾ƒå¤§å°ä»¥æ‰¾åˆ°æ’å…¥çš„ä½ç½®ï¼Œç”±äºmapå’Œsetçš„æŸ¥æ‰¾ç®—æ³•ï¼ˆlower_boundå’Œupper_boundï¼‰éƒ½ä¸æ”¯æŒè‡ªå®šä¹‰è°“è¯ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨æ—¶é—´å¤æ‚åº¦O(n)æ”¯æŒè°“è¯çš„ç®—æ³•ï¼Œè€ƒè™‘åˆ°å…¶ç©ºé—´å¼€é”€å´æ¢æ¥O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œå†³å®šèˆå¼ƒï¼Œä½¿ç”¨ç®€å•çš„listå³å¯ã€‚</p>
<p>å…·ä½“æ“ä½œè¯·çœ‹ä»£ç ï¼Œè¿™é‡Œä¸ç»†è¯´ã€‚</p>
</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;byte_stream.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;list&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;string&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;tuple&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Reassembler</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Construct Reassembler to write into given ByteStream.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">explicit</span> Reassembler( ByteStream<span style="color:#000;font-weight:bold">&amp;&amp;</span> output ) <span style="color:#000;font-weight:bold">:</span> output_( std<span style="color:#000;font-weight:bold">::</span>move( output ) ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * Insert a new substring to be reassembled into a ByteStream.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *   `first_index`: the index of the first byte of the substring
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *   `data`: the substring itself
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *   `is_last_substring`: this substring represents the end of the stream
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *   `output`: a mutable reference to the Writer
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * The Reassembler&#39;s job is to reassemble the indexed substrings (possibly out-of-order
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * and possibly overlapping) back into the original ByteStream. As soon as the Reassembler
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * learns the next byte in the stream, it should write it to the output.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * If the Reassembler learns about bytes that fit within the stream&#39;s available capacity
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * but can&#39;t yet be written (because earlier bytes remain unknown), it should store them
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * internally until the gaps are filled in.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * The Reassembler should discard any bytes that lie beyond the stream&#39;s available capacity
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * (i.e., bytes that couldn&#39;t be written even if earlier gaps get filled in).
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * The Reassembler should close the stream after writing the last byte.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">insert</span>( <span style="color:#458;font-weight:bold">uint64_t</span> first_index, std<span style="color:#000;font-weight:bold">::</span>string data, <span style="color:#458;font-weight:bold">bool</span> is_last_substring );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// How many bytes are stored in the Reassembler itself?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">bytes_pending</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Access output stream reader
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  Reader<span style="color:#000;font-weight:bold">&amp;</span> reader() { <span style="color:#000;font-weight:bold">return</span> output_.reader(); }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> Reader<span style="color:#000;font-weight:bold">&amp;</span> reader() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> output_.reader(); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Access output stream writer, but const-only (can&#39;t write from outside)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">const</span> Writer<span style="color:#000;font-weight:bold">&amp;</span> writer() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> output_.writer(); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> push_bytes( <span style="color:#458;font-weight:bold">uint64_t</span> first_index, std<span style="color:#000;font-weight:bold">::</span>string data, <span style="color:#458;font-weight:bold">bool</span> is_last_substring );
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">cache_bytes</span>( <span style="color:#458;font-weight:bold">uint64_t</span> first_index, std<span style="color:#000;font-weight:bold">::</span>string data, <span style="color:#458;font-weight:bold">bool</span> is_last_substring );
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">flush_buffer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ByteStream output_; <span style="color:#998;font-style:italic">// the Reassembler writes to this ByteStream
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> nbytes_pending_ {};  <span style="color:#998;font-style:italic">// åœ¨é‡ç»„å™¨ç¼“å­˜ä¸­çš„å­—èŠ‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> expecting_index_ {}; <span style="color:#998;font-style:italic">// é‡ç»„å™¨æœŸå¾…çš„åºåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  std<span style="color:#000;font-weight:bold">::</span>list<span style="color:#000;font-weight:bold">&lt;</span>std<span style="color:#000;font-weight:bold">::</span>tuple<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">uint64_t</span>, std<span style="color:#000;font-weight:bold">::</span>string, <span style="color:#458;font-weight:bold">bool</span><span style="color:#000;font-weight:bold">&gt;&gt;</span> unordered_bytes_ {};
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;reassembler.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;algorithm&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">using</span> <span style="color:#000;font-weight:bold">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  æ§åˆ¶æ•°æ®æ’å…¥çš„æ–¹æ³•ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  1. ç­›é€‰ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®åˆ†ç»„ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - å­—èŠ‚æµå·²ç»å…³é—­å´è¿˜è¦å†™çš„åˆ†ç»„ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - å·²ç»æ²¡æœ‰ç©ºé—²ç©ºé—´è¿˜è¦å†™çš„åˆ†ç»„ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - first_indexä¸åœ¨æ¥å—èŒƒå›´å†…çš„åˆ†ç»„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  2. å¤„ç†æ•°æ®ï¼Œå¯¹äºæ•°æ®é•¿åº¦è¶…è¿‡äº†ç¼“å†²åŒºå®¹é‡çš„åˆ†ç»„ï¼Œå°†å…¶ååŠéƒ¨åˆ†æˆªæ–­å†å­˜å‚¨ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  3. æ ¹æ®first_indexåˆ†ç±»ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - first_index &gt; expecting_index_æ—¶ï¼Œè¯´æ˜è¿˜æœ‰ç¼ºå¤±æ•°æ®ï¼Œå°†è¯¥åˆ†ç»„ç¼“å­˜ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - å¦åˆ™ï¼Œå°†å…¶å‹å…¥å­—èŠ‚æµä¸­ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  4. æœ€åæ›´æ–°ç¼“å†²åŒºã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> Reassembler<span style="color:#000;font-weight:bold">::</span>insert( <span style="color:#458;font-weight:bold">uint64_t</span> first_index, string data, <span style="color:#458;font-weight:bold">bool</span> is_last_substring )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  Writer <span style="color:#000;font-weight:bold">&amp;</span>bytes_writer <span style="color:#000;font-weight:bold">=</span> output_.writer();
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// ç­›é€‰æ¡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> unacceptable_idx <span style="color:#000;font-weight:bold">=</span> expecting_index_ <span style="color:#000;font-weight:bold">+</span> bytes_writer.available_capacity();
</span></span><span style="display:flex;"><span>       bytes_writer.is_closed() <span style="color:#000;font-weight:bold">||</span> bytes_writer.available_capacity() <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">||</span> first_index <span style="color:#000;font-weight:bold">&gt;=</span> unacceptable_idx )
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">else</span> <span style="color:#900;font-weight:bold">if</span> ( first_index <span style="color:#000;font-weight:bold">+</span> data.size() <span style="color:#000;font-weight:bold">&gt;=</span> unacceptable_idx ) {
</span></span><span style="display:flex;"><span>    is_last_substring <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span>;
</span></span><span style="display:flex;"><span>    data.resize( unacceptable_idx <span style="color:#000;font-weight:bold">-</span> first_index );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( first_index <span style="color:#000;font-weight:bold">&gt;</span> expecting_index_ ) {
</span></span><span style="display:flex;"><span>    cache_bytes( first_index, move( data ), is_last_substring );
</span></span><span style="display:flex;"><span>  } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>    push_bytes( first_index, move( data ), is_last_substring );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  flush_buffer();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> Reassembler<span style="color:#000;font-weight:bold">::</span>bytes_pending() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> nbytes_pending_;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  å°†æ•°æ®æ¨å…¥å­—èŠ‚æµçš„é€»è¾‘å®ç°å‡½æ•°ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  1. first_index &lt; expecting_index_çš„åˆ†ç»„ï¼Œè¯´æ˜å…¶ä»expecting_index_å¼€å§‹å¾€åçš„æ‰€æœ‰å­—èŠ‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  éƒ½æ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œå¹¶ä¸”æ²¡æœ‰ç¼ºå¤±ï¼Œæ‰€ä»¥å°†å…¶å‰é¢ä»0å¼€å§‹æˆªå»expecting_index_ - first_index
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  ä¸ªå­—èŠ‚ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  2. ç›´æ¥å°†dataæ¨å…¥å­—èŠ‚æµä¸­ï¼Œç»´æŠ¤å¥½ç›¸å…³å˜é‡ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  3. å¯¹äºis_last_substringä¸ºtrueçš„åˆ†ç»„ï¼Œåœ¨å°†å…¶æ¨å…¥å­—èŠ‚æµååº”å…³é—­å­—èŠ‚æµå¹¶æ¸…ç©ºç¼“å†²åŒºã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> Reassembler<span style="color:#000;font-weight:bold">::</span>push_bytes( <span style="color:#458;font-weight:bold">uint64_t</span> first_index, string data, <span style="color:#458;font-weight:bold">bool</span> is_last_substring ) {
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( first_index <span style="color:#000;font-weight:bold">&lt;</span> expecting_index_ ) 
</span></span><span style="display:flex;"><span>    data.erase( <span style="color:#099">0</span>, expecting_index_ <span style="color:#000;font-weight:bold">-</span> first_index );
</span></span><span style="display:flex;"><span>  expecting_index_ <span style="color:#000;font-weight:bold">+=</span> data.size();
</span></span><span style="display:flex;"><span>  output_.writer().push( move(data) );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( is_last_substring ) {
</span></span><span style="display:flex;"><span>    output_.writer().close();
</span></span><span style="display:flex;"><span>    unordered_bytes_.clear();
</span></span><span style="display:flex;"><span>    nbytes_pending_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  ç¼“å­˜é€»è¾‘å®ç°å‡½æ•°ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  1. å…ˆè·å–å·¦å³åŒºé—´ä½ç½®ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  2. å¤„ç†å·¦åŒºé—´é‡å æƒ…å†µï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - æ–°çš„åˆ†ç»„æ•°æ®åŒ…å«åœ¨äº†åŸåºåˆ—ä¸­ï¼Œç›´æ¥è¿”å›ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - æ²¡æœ‰é‡å ï¼Œå¯¹æ–°æ•°æ®ä¸ä½œä»»ä½•æ“ä½œï¼Œæœ€åæ’å…¥åˆ°åˆé€‚ä¸ºæ­¢å³å¯ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - æœ‰é‡å ï¼Œæ ¹æ®å…·ä½“é‡å æƒ…å†µå¤„ç†ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  3. å¤„ç†å³åŒºé—´é‡å æƒ…å†µï¼Œå¯¹äºå¤„ç†å®Œå·¦ä¾§çš„æ•°æ®ï¼Œå½“å³ä¾§æœ‰é‡å æ—¶ï¼Œå°†å…¶ä¸å³ä¾§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  åŸæ•°æ®æ‹¼æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  4. ä»leftå¼€å§‹éå†ï¼Œåˆ é™¤åŒºé—´å†…æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œæ’å…¥æ–°çš„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> Reassembler<span style="color:#000;font-weight:bold">::</span>cache_bytes( <span style="color:#458;font-weight:bold">uint64_t</span> first_index, string data, <span style="color:#458;font-weight:bold">bool</span> is_last_substring ) {
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">auto</span> end <span style="color:#000;font-weight:bold">=</span> unordered_bytes_.end();
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// è·å–å·¦å³åŒºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">auto</span> left <span style="color:#000;font-weight:bold">=</span> lower_bound( unordered_bytes_.begin(), end, first_index, []( <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;&amp;</span> e, <span style="color:#458;font-weight:bold">uint64_t</span> idx ) <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#458;font-weight:bold">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> idx <span style="color:#000;font-weight:bold">&gt;</span> ( get<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#099">0</span><span style="color:#000;font-weight:bold">&gt;</span>( e ) <span style="color:#000;font-weight:bold">+</span> get<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">&gt;</span>( e ).size() );
</span></span><span style="display:flex;"><span>  } );
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">auto</span> right <span style="color:#000;font-weight:bold">=</span> upper_bound( left, end, first_index <span style="color:#000;font-weight:bold">+</span> data.size(), []( <span style="color:#458;font-weight:bold">uint64_t</span> idx, <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;&amp;</span> e ) <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#458;font-weight:bold">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> idx <span style="color:#000;font-weight:bold">&lt;</span> get<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#099">0</span><span style="color:#000;font-weight:bold">&gt;</span>( e );
</span></span><span style="display:flex;"><span>  } );
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å¤„ç†å·¦åŒºé—´æœ‰é‡å 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> next_index <span style="color:#000;font-weight:bold">=</span> first_index <span style="color:#000;font-weight:bold">+</span> data.size(); left <span style="color:#000;font-weight:bold">!=</span> end ) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;</span> [lpoint, str, _] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">*</span>left;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> rpoint <span style="color:#000;font-weight:bold">=</span> lpoint <span style="color:#000;font-weight:bold">+</span> str.size(); first_index <span style="color:#000;font-weight:bold">&gt;=</span> lpoint <span style="color:#000;font-weight:bold">&amp;&amp;</span> next_index <span style="color:#000;font-weight:bold">&lt;=</span> rpoint  )
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span> <span style="color:#900;font-weight:bold">if</span> ( next_index <span style="color:#000;font-weight:bold">&lt;</span> lpoint )
</span></span><span style="display:flex;"><span>      right <span style="color:#000;font-weight:bold">=</span> left;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span> <span style="color:#900;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">!</span>( first_index <span style="color:#000;font-weight:bold">&lt;=</span> lpoint <span style="color:#000;font-weight:bold">&amp;&amp;</span> next_index <span style="color:#000;font-weight:bold">&gt;=</span> rpoint ) ) {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">if</span> ( first_index <span style="color:#000;font-weight:bold">&lt;</span> lpoint ) {
</span></span><span style="display:flex;"><span>        data.resize( data.size() <span style="color:#000;font-weight:bold">-</span> ( next_index <span style="color:#000;font-weight:bold">-</span> lpoint ) );
</span></span><span style="display:flex;"><span>        data.append( str );
</span></span><span style="display:flex;"><span>      } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        data.insert( <span style="color:#099">0</span>, string_view( str.c_str(), str.size() <span style="color:#000;font-weight:bold">-</span> ( rpoint <span style="color:#000;font-weight:bold">-</span> first_index ) ) );
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      first_index <span style="color:#000;font-weight:bold">=</span> min( first_index, lpoint );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å¤„ç†å³åŒºé—´æœ‰é‡å 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> next_index <span style="color:#000;font-weight:bold">=</span> first_index <span style="color:#000;font-weight:bold">+</span> data.size(); right <span style="color:#000;font-weight:bold">!=</span> left <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">!</span>unordered_bytes_.empty() ) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;</span> [lpoint, str, _] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">*</span>prev( right );
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> rpoint <span style="color:#000;font-weight:bold">=</span> lpoint <span style="color:#000;font-weight:bold">+</span> str.size(); rpoint <span style="color:#000;font-weight:bold">&gt;</span> next_index ) {
</span></span><span style="display:flex;"><span>      data.resize( data.size() <span style="color:#000;font-weight:bold">-</span> ( next_index <span style="color:#000;font-weight:bold">-</span> lpoint ) );
</span></span><span style="display:flex;"><span>      data.append( str );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// åˆ é™¤åŒºé—´å†…çš„èŠ‚ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">for</span> ( ;left <span style="color:#000;font-weight:bold">!=</span> right; left <span style="color:#000;font-weight:bold">=</span> unordered_bytes_.erase( left ) ) {
</span></span><span style="display:flex;"><span>    nbytes_pending_ <span style="color:#000;font-weight:bold">-=</span> get<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">&gt;</span>( <span style="color:#000;font-weight:bold">*</span>left ).size();
</span></span><span style="display:flex;"><span>    is_last_substring <span style="color:#000;font-weight:bold">|=</span> get<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#099">2</span><span style="color:#000;font-weight:bold">&gt;</span>( <span style="color:#000;font-weight:bold">*</span>left );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  nbytes_pending_ <span style="color:#000;font-weight:bold">+=</span> data.size();
</span></span><span style="display:flex;"><span>  unordered_bytes_.insert( left, { first_index, move( data ), is_last_substring } );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  åˆ·æ–°ç¼“å†²åŒºé€»è¾‘å®ç°å‡½æ•°ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  ä¸€ç›´å°†å¯ä»¥pushçš„å­—èŠ‚pushæ‰å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> Reassembler<span style="color:#000;font-weight:bold">::</span>flush_buffer() {
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">while</span> ( <span style="color:#000;font-weight:bold">!</span>unordered_bytes_.empty() ) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;</span> [index, str, is_last] <span style="color:#000;font-weight:bold">=</span> unordered_bytes_.front();
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> ( index <span style="color:#000;font-weight:bold">&gt;</span> expecting_index_ )
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    nbytes_pending_ <span style="color:#000;font-weight:bold">-=</span> str.size();
</span></span><span style="display:flex;"><span>    push_bytes( index, move( str ), is_last );
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">!</span>unordered_bytes_.empty() )
</span></span><span style="display:flex;"><span>      unordered_bytes_.pop_front();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–å†™å®Œååœ¨<code>minnow</code>ç›®å½•ä¸‹æ‰§è¡Œ<code>cmake --build build --target check1</code>å³å¯å¼€å§‹æµ‹è¯•ï¼Œä¸‹é¢é™„ä¸ŠæˆåŠŸçš„ç»“æœï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Test project /home/sniffstherose/cs144/minnow/build
</span></span><span style="display:flex;"><span>      Start  1: compile with bug-checkers
</span></span><span style="display:flex;"><span> 1/17 Test  <span style="color:#998;font-style:italic">#1: compile with bug-checkers ........   Passed    1.84 sec</span>
</span></span><span style="display:flex;"><span>      Start  3: byte_stream_basics
</span></span><span style="display:flex;"><span> 2/17 Test  <span style="color:#998;font-style:italic">#3: byte_stream_basics ...............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  4: byte_stream_capacity
</span></span><span style="display:flex;"><span> 3/17 Test  <span style="color:#998;font-style:italic">#4: byte_stream_capacity .............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  5: byte_stream_one_write
</span></span><span style="display:flex;"><span> 4/17 Test  <span style="color:#998;font-style:italic">#5: byte_stream_one_write ............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  6: byte_stream_two_writes
</span></span><span style="display:flex;"><span> 5/17 Test  <span style="color:#998;font-style:italic">#6: byte_stream_two_writes ...........   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  7: byte_stream_many_writes
</span></span><span style="display:flex;"><span> 6/17 Test  <span style="color:#998;font-style:italic">#7: byte_stream_many_writes ..........   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start  8: byte_stream_stress_test
</span></span><span style="display:flex;"><span> 7/17 Test  <span style="color:#998;font-style:italic">#8: byte_stream_stress_test ..........   Passed    0.13 sec</span>
</span></span><span style="display:flex;"><span>      Start  9: reassembler_single
</span></span><span style="display:flex;"><span> 8/17 Test  <span style="color:#998;font-style:italic">#9: reassembler_single ...............   Passed    0.05 sec</span>
</span></span><span style="display:flex;"><span>      Start 10: reassembler_cap
</span></span><span style="display:flex;"><span> 9/17 Test <span style="color:#998;font-style:italic">#10: reassembler_cap ..................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 11: reassembler_seq
</span></span><span style="display:flex;"><span>10/17 Test <span style="color:#998;font-style:italic">#11: reassembler_seq ..................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 12: reassembler_dup
</span></span><span style="display:flex;"><span>11/17 Test <span style="color:#998;font-style:italic">#12: reassembler_dup ..................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 13: reassembler_holes
</span></span><span style="display:flex;"><span>12/17 Test <span style="color:#998;font-style:italic">#13: reassembler_holes ................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 14: reassembler_overlapping
</span></span><span style="display:flex;"><span>13/17 Test <span style="color:#998;font-style:italic">#14: reassembler_overlapping ..........   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 15: reassembler_win
</span></span><span style="display:flex;"><span>14/17 Test <span style="color:#998;font-style:italic">#15: reassembler_win ..................   Passed    0.29 sec</span>
</span></span><span style="display:flex;"><span>      Start 37: compile with optimization
</span></span><span style="display:flex;"><span>15/17 Test <span style="color:#998;font-style:italic">#37: compile with optimization ........   Passed    0.57 sec</span>
</span></span><span style="display:flex;"><span>      Start 38: byte_stream_speed_test
</span></span><span style="display:flex;"><span>             ByteStream throughput: 28.21 Gbit/s
</span></span><span style="display:flex;"><span>16/17 Test <span style="color:#998;font-style:italic">#38: byte_stream_speed_test ...........   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 39: reassembler_speed_test
</span></span><span style="display:flex;"><span>             Reassembler throughput: 11.44 Gbit/s
</span></span><span style="display:flex;"><span>17/17 Test <span style="color:#998;font-style:italic">#39: reassembler_speed_test ...........   Passed    0.13 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#099">0</span> tests failed out of <span style="color:#099">17</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#0086b3">time</span> <span style="color:#000;font-weight:bold">(</span>real<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span>   3.85 sec
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>::åœ¨åšè¿™ä¸ªå®éªŒçš„æ—¶å€™å‡ºç°äº†ä¸€ä¸ªéå¸¸æ“è›‹çš„å¤±è¯¯ï¼Œæˆ‘æŠŠä¸Šé¢.ccæ–‡ä»¶ä¸­105è¡Œ<code>data.resize( data.size() - ( next_index - lpoint ) );</code>çš„<code>data.size()</code>å†™æˆäº†<code>str.size()</code>ï¼ˆä½†è„‘å­é‡Œæƒ³çš„å°±æ˜¯data.size()ï¼‰å¯¼è‡´æµ‹è¯•ä¸é€šè¿‡ï¼ŒGDBå„ç§æ’æŸ¥ï¼Œæœ€ç»ˆæ’æŸ¥åˆ°äº†è¿™ä¸ªifè¯­å¥å†…ï¼Œä½†æ˜¯çœ‹äº†åŠå¤©ä¹Ÿæ²¡çœ‹å‡ºé€»è¾‘å“ªé‡Œä¸å¯¹æœ€åæ–­ç‚¹æ‰“åˆ°106è¡Œæ‰æ³¨æ„åˆ°è¿™ä¸ª<code>str.size()</code>ğŸ˜…ã€‚</p>
</blockquote>
<p>æœ€ågitæäº¤ä¸€ä¸‹å³å¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µğŸ˜ã€‚</p>
<h2 id="lab-2">lab 2</h2>
<p><a href="https://tryanel.github.io/Documents/check2.pdf">lab2æ–‡æ¡£</a></p>
<h3 id="overview">Overview</h3>
<p>æ¦‚è¿°éƒ¨åˆ†å‘Šè¯‰æˆ‘ä»¬å·²ç»å®ç°äº†æ§åˆ¶å­—èŠ‚æµæŠ½è±¡å’Œé‡ç»„å™¨ï¼Œæ¥ä¸‹æ¥éœ€è¦å®ç°TCPReceiverï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘ä»¬TCPReceiverä¼šé€šè¿‡<code>send()</code>æ–¹æ³•ç»™å‘é€æ–¹è¿”å›ä¸¤ä¸ªæ¶ˆæ¯ï¼šï¼ˆ1ï¼‰ACKï¼Œå³ç¡®è®¤å·ï¼›ï¼ˆ2ï¼‰window sizeï¼Œå³æ¥æ”¶æ–¹ç¼“å†²åŒºå¯ç”¨ç©ºé—´å¤§å°ã€‚æœ€åå‘Šè¯‰æˆ‘ä»¬å¤§éƒ¨åˆ†ç®—æ³•å·¥ä½œå·²ç»åœ¨å‰ä¸¤ä¸ªå®éªŒå®Œæˆäº†ï¼Œç°åœ¨æœ€éš¾çš„æ˜¯TCPå¦‚ä½•è¡¨ç¤ºæ¯ä¸ªå­—èŠ‚åœ¨æµä¸­çš„ä½ç½®ï¼ˆåºåˆ—å·ï¼‰ã€‚</p>
<h3 id="getting-started-1">Getting started</h3>
<p>è€æ ·å­äº†ï¼Œå…ˆmergeå½“å‰labçš„åˆ†æ”¯ï¼Œç„¶åset upä¸€ä¸‹build systemã€‚</p>
<h3 id="checkpoint-2-the-tcp-receiver">Checkpoint 2: The TCP Receiver</h3>
<p>åºŸè¯äº†ä¸€ä¸‹TCPçš„ç‰¹æ€§ï¼Œå¹¶è®²äº†è®²ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼ŒåŸºæœ¬å°±æ˜¯å›ç­”TCPä¸ºä»€ä¹ˆå¯é ã€‚</p>
<h4 id="translating-between-64-bit-indexes-and-32-bit-seqnos">Translating between 64-bit indexes and 32-bit seqnos</h4>
<p>è¿™é‡Œå‘Šè¯‰æˆ‘ä»¬è™½ç„¶é‡ç»„å™¨å†…ç”¨çš„éƒ½æ˜¯64bitï¼ˆ<code>uint64_t</code>ï¼‰çš„ç´¢å¼•è¡¨ç¤ºåºåˆ—ï¼Œä½†æ˜¯åœ¨å®é™…TCPä¸­ç”±äºç©ºé—´çš„å®è´µï¼Œéƒ½æ˜¯ä½¿ç”¨32bitçš„åºåˆ—å·æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é¢å¤–åšä¸€äº›å·¥ä½œï¼š</p>
<ol>
<li>æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸‹åºåˆ—çš„è¡¨ç¤ºã€‚è™½ç„¶TCPèƒ½å‘é€çš„æ•°æ®æ˜¯æ— é™çš„ï¼Œä½†æ˜¯32ä½çš„åºåˆ—å·æœ€å¤§ä¹Ÿå°±4GBçš„æ•°æ®ï¼Œå¦‚æœå¤§äº4GBçš„æ•°æ®æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±éœ€è¦å½“åºåˆ—å·ç´¯è®¡åˆ°äº†2^32 - 1æ—¶ä»0å¼€å§‹é‡æ–°å¾€ä¸Šå¢é•¿ã€‚</li>
<li>TCPåºåˆ—å·åº”ä»¥ä¸€ä¸ªéšæœºå€¼ä½œä¸ºå¼€å§‹ã€‚ä¸ºäº†å¥å£®æ€§ä»¥åŠé¿å…å’Œæ—§è¿æ¥æ··æ·†ï¼ŒTCPåºåˆ—å·éšæœºä¸€ä¸ª32ä½çš„æ•°å½“åšISNï¼ˆåˆå§‹åºåˆ—å·ï¼‰ï¼Œè¡¨ç¤ºä¸ºSYNï¼ˆæµçš„å¼€å§‹ï¼‰ï¼Œæ­¤åçš„åºåˆ—å·å°†é€’å¢ï¼Œæ¯”å¦‚çœŸæ­£æ•°æ®ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºï¼šISN + 1 mod 2^32ã€‚</li>
<li>ä¸€ä¸ªå­—èŠ‚æµçš„é€»è¾‘å¼€å¤´å’Œç»“å°¾åº”å½“æ ‡è¯†å‡ºæ¥ï¼Œæ‰€ä»¥è¿™ä¿©ä¹Ÿä¼šå ç”¨åºåˆ—å·ï¼Œå°±æ˜¯ç†ŸçŸ¥çš„SYNå’ŒFINæ ‡å¿—ä½ï¼Œè¿™ä¸¤ä¸ªä¸æ˜¯æµæœ¬èº«çš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯éœ€è¦è¾…åŠ©ä½œç”¨æˆ‘ä»¬æ·»åŠ çš„å¼€å§‹å’Œç»“æŸéƒ¨åˆ†ã€‚</li>
</ol>
<p>ä¸¾äº†ä¸ªä¾‹å­ï¼Œæ–¹ä¾¿æˆ‘ä»¬åŒºåˆ†åºåˆ—å·ã€ç»å¯¹åºåˆ—å·ï¼ˆå¯ä»¥ç†è§£ä¸ºä»0å¼€å§‹çš„é€»è¾‘ä¸Šçš„åºåˆ—ï¼‰ã€stream indexï¼Œå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²&quot;cat&quot;ï¼Œå¦‚æœå…¶ISNä¸º2^32 - 2åˆ™å…¶å„ä¸ªéƒ¨åˆ†å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="./imgs/image-20240927094656994.png" alt="image-20240927094656994"></p>
<p>ä¸‰è€…çš„å¯¹æ¯”ï¼š</p>
<p><img src="./imgs/image-20240927094748592.png" alt="image-20240927094748592"></p>
<p>å¯ä»¥çœ‹å‡ºæ¥åœ¨ç»å¯¹åºåˆ—å·å’Œstream indexä¹‹é—´çš„è½¬æ¢å¾ˆç®€å•ï¼Œåªéœ€åŠ å‡1ï¼Œä½†æ˜¯æƒ³æŠŠåºåˆ—å·è½¬æ¢ä¸ºstream indexéå¸¸æ£˜æ‰‹ï¼Œæ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬ä¸ºäº†ç³»ç»Ÿå¾—é¿å…æ··æ·†è¿™ä¸‰è€…å¯¼è‡´å‡ºç°bugï¼Œè¿™é‡Œä½¿ç”¨è‡ªå®šä¹‰ç±»å‹<code>Wrap32</code>æ¥è¡¨ç¤ºåºåˆ—å·ï¼Œå¹¶ä¸”å®ç°ä¸€ä¸ªä¸ç»å¯¹åºåˆ—å·è½¬æ¢çš„æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥å°±åˆ°<code>wrapping_integers.hh</code>å’Œ<code>wrapping_integers.cc</code>ä¸¤ä¸ªæ–‡ä»¶å®ç°ä»£ç ã€‚</p>
<p>æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬ï¼š</p>
<p><img src="./imgs/image-20240927153432583.png" alt="image-20240927153432583"></p>
<p>éœ€æ±‚åˆ†æï¼š</p>
<ol>
<li>åºåˆ—å·åˆ°è¾¾2^32 - 1æ—¶ä¸‹ä¸€ä¸ªåºåˆ—å·åº”å½“ä»0å¼€å§‹ï¼Œè¿™ä¸€ç‚¹ä¼šå› ä¸º64bitè½¬æ¢ä¸º32bitè‡ªåŠ¨è¿›è¡Œï¼›</li>
<li>32ä½çš„åºåˆ—å·è½¬æ¢æˆ64ä¸ºçš„ç»å¯¹åºåˆ—å·ã€‚</li>
</ol>
<p>ç¨‹åºå®ç°ï¼ˆå®ç°çš„è¿‡ç¨‹åˆ‡ä¸å¯å¤šæƒ³ï¼Œåªéœ€è¦è§£å†³åºåˆ—è½¬æ¢é—®é¢˜å³å¯ï¼Œåˆ«çš„å…ˆä¸ç®¡ï¼‰ï¼š</p>
<ol>
<li>
<p><code>wrap()</code>å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œæ ¹æ®ä¸Šé¢çš„å…³ç³»æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›´æ¥å°†ç»™å®šçš„zero_pointåŠ ä¸Šnå³å¯å¾—åˆ°ï¼›</p>
</li>
<li>
<p><code>unwrap()</code>å‡½æ•°æ¯”è¾ƒå¤æ‚ï¼š</p>
<p>å‚æ•°ç»™å®šä¸€ä¸ªzero_pointå’Œcheckpointï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯checkpointå‘¢ï¼Ÿcheckpointå…¶å®å°±æ˜¯ç›®å‰å·²ç»pushåˆ°äº†ByteStreamä¸­çš„å­—èŠ‚çš„ç»å¯¹åºåˆ—ï¼Œä¹Ÿå°±æ˜¯nbytes_pushed_ + 1ã€‚æˆ‘ä»¬è¦æ ¹æ®è¿™ä¸ªcheckpointæ±‚å¾—è·ç¦»checkpointæœ€è¿‘çš„ç»å¯¹åºåˆ—ï¼Œå…·ä½“çš„åŸå› ä¸Šè¿°æ–‡æ¡£ä¸­æœ‰æè¿°ã€‚æˆ‘ä»¬è¦æ±‚çš„ç»å¯¹åºåˆ—å®é™…ä¸Šåº”å½“æ˜¯å½“å‰æ¶ˆæ¯çš„ç»å¯¹åºåˆ—ï¼Œé‚£ä¸ºå•¥åˆè¦æ±‚è¿™ä¸ªå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¦è°ƒç”¨lab1çš„é‡ç»„å™¨æ¥é‡ç»„å¹¶pushï¼Œå®ƒéœ€è¦çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯first_indexï¼Œä¹Ÿå°±æ˜¯å½“å‰æ•°æ®åˆ†ç»„çš„stream indexï¼Œåœ¨ä¸Šé¢çš„è¡¨ä¸­å¯ä»¥çœ‹åˆ°å®ƒå¯ä»¥å’Œç»å¯¹åºåˆ—è¿›è¡ŒåŠ å‡1çš„è½¬æ¢ï¼Œæ‰€ä»¥éœ€è¦æ±‚å‡ºå½“å‰æ¶ˆæ¯çš„ç»å¯¹åºåˆ—ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨checkpointçš„æ¨¡å€¼æ±‚å¾—å…¶å’Œå½“å‰æ¶ˆæ¯æ¨¡å€¼çš„è·ç¦»ï¼Œç„¶åå°†è¿™ä¸ªè·ç¦»åŠ åˆ°åŸå§‹checkpointä¸Šï¼Œä¸è¿‡è¿™é‡Œæœ‰ä¸€äº›ç»†èŠ‚ï¼Œè¯¦è§è¿™ç¯‡æ–‡ç« ï¼š<a href="https://blog.csdn.net/Kovnt/article/details/135793894">CS144ï¼ˆ2024 Winterï¼‰Lab Checkpoint 2: the TCP receiver_cs144 lab2-CSDNåšå®¢</a></p>
</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// wrappint_integers.hh
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;cstdint&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * The Wrap32 type represents a 32-bit unsigned integer that:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *    - starts at an arbitrary &#34;zero point&#34; (initial value), and
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *    - wraps back to zero when it reaches 2^32 - 1.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Wrap32</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">explicit</span> Wrap32( <span style="color:#458;font-weight:bold">uint32_t</span> raw_value ) <span style="color:#000;font-weight:bold">:</span> raw_value_( raw_value ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/* Construct a Wrap32 given an absolute sequence number n and the zero point. */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">static</span> Wrap32 <span style="color:#900;font-weight:bold">wrap</span>( <span style="color:#458;font-weight:bold">uint64_t</span> n, Wrap32 zero_point );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * The unwrap method returns an absolute sequence number that wraps to this Wrap32, given the zero point
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * and a &#34;checkpoint&#34;: another absolute sequence number near the desired answer.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * There are many possible absolute sequence numbers that all wrap to the same Wrap32.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * The unwrap method should return the one that is closest to the checkpoint.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">unwrap</span>( Wrap32 zero_point, <span style="color:#458;font-weight:bold">uint64_t</span> checkpoint ) <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Wrap32 <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">+</span>( <span style="color:#458;font-weight:bold">uint32_t</span> n ) <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> Wrap32 { raw_value_ <span style="color:#000;font-weight:bold">+</span> n }; }
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">==</span>( <span style="color:#000;font-weight:bold">const</span> Wrap32<span style="color:#000;font-weight:bold">&amp;</span> other ) <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> raw_value_ <span style="color:#000;font-weight:bold">==</span> other.raw_value_; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">protected</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint32_t</span> raw_value_ {};
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// wrappint_integers.cc
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;wrapping_integers.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">using</span> <span style="color:#000;font-weight:bold">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Wrap32 Wrap32<span style="color:#000;font-weight:bold">::</span>wrap( <span style="color:#458;font-weight:bold">uint64_t</span> n, Wrap32 zero_point )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> zero_point <span style="color:#000;font-weight:bold">+</span> n;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> Wrap32<span style="color:#000;font-weight:bold">::</span>unwrap( Wrap32 zero_point, <span style="color:#458;font-weight:bold">uint64_t</span> checkpoint ) <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// 32bitçš„ä¸Šç•Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> upper <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">static_cast</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">uint64_t</span><span style="color:#000;font-weight:bold">&gt;</span>(UINT32_MAX) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// checkpoint + zero_point
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint32_t</span> checkpoint_mod <span style="color:#000;font-weight:bold">=</span> Wrap32<span style="color:#000;font-weight:bold">::</span>wrap( checkpoint, zero_point ).raw_value_;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å¦‚æœraw_value &lt; checkpoint_modï¼Œå› ä¸ºè¿™æ˜¯æ— ç¬¦å·å‡æ³•ï¼Œæ‰€ä»¥ç›¸å½“äºcheckpoint_mod - raw_value
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint32_t</span> distance <span style="color:#000;font-weight:bold">=</span> raw_value_ <span style="color:#000;font-weight:bold">-</span> checkpoint_mod;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å¦‚æœè·ç¦»å¤§äºä¸€èˆ¬æˆ–è€…åŠ èµ·æ¥è¶…è¿‡ç•Œé™äº†ï¼Œè¯´æ˜è¦æ±‚çš„ç»å¯¹åºåˆ—å°äºcheckpointçš„ï¼Œå‡å»ä¸€ä¸ª2^32
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span> ( distance <span style="color:#000;font-weight:bold">&lt;=</span> ( upper <span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#099">1</span> ) <span style="color:#000;font-weight:bold">||</span> checkpoint <span style="color:#000;font-weight:bold">+</span> distance <span style="color:#000;font-weight:bold">&lt;</span> upper )
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> checkpoint <span style="color:#000;font-weight:bold">+</span> distance;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> checkpoint <span style="color:#000;font-weight:bold">+</span> distance <span style="color:#000;font-weight:bold">-</span> upper;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="implementing-the-tcp-receiver">Implementing the TCP receiver</h4>
<p>è¿™éƒ¨åˆ†è®©æˆ‘ä»¬å®ç°TCPReceiverï¼Œè¿™ä¸ªç±»åšä¸¤ä¸ªå·¥ä½œï¼š</p>
<ol>
<li>æ¥æ”¶å¯¹ç­‰çš„å‘é€è€…å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨Reassembleré‡ç»„ByteStreamï¼›</li>
<li>åŒ…è£…è¿”å›ç»™å‘é€è€…çš„ä¿¡æ¯ï¼ŒåŒ…å«ç¡®è®¤å·ã€çª—å£å¤§å°ã€‚</li>
</ol>
<p>ç´§æ¥ç€ä»‹ç»äº†ä¸€ä¸‹&quot;sender message&quot;ï¼Œè¿™ä¸ªmessageæ˜¯ä»senderåˆ°receiverçš„æ¶ˆæ¯ï¼š</p>
<p><img src="./imgs/image-20240928145158805.png" alt="image-20240928145158805"></p>
<p>è¿˜æœ‰receiverçš„æ¶ˆæ¯ç»“æ„ä½“ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯receiverç”Ÿæˆå¹¶è¿”å›ç»™senderçš„ï¼š</p>
<p><img src="./imgs/image-20240928145247785.png" alt="image-20240928145247785"></p>
<p>æ³¨æ„æ–‡æ¡£çš„ç”¨è¯â€œpeer&rsquo;sâ€ï¼Œæ¥æ”¶æ–¹å’Œå‘é€æ–¹æ˜¯å¯¹ç­‰çš„ã€‚</p>
<p>è¿™éƒ¨åˆ†æ²¡æœ‰å¤ªå¤§éš¾ç‚¹ï¼Œä¸»è¦å°±æ˜¯codingé—®é¢˜äº†ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// tcp_receiver.hh
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;reassembler.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;tcp_receiver_message.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;tcp_sender_message.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TCPReceiver</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Construct with given Reassembler
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">explicit</span> TCPReceiver( Reassembler<span style="color:#000;font-weight:bold">&amp;&amp;</span> reassembler ) <span style="color:#000;font-weight:bold">:</span> reassembler_( std<span style="color:#000;font-weight:bold">::</span>move( reassembler ) ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * The TCPReceiver receives TCPSenderMessages, inserting their payload into the Reassembler
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   * at the correct stream index.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">receive</span>( TCPSenderMessage message );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// The TCPReceiver sends TCPReceiverMessages to the peer&#39;s TCPSender.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  TCPReceiverMessage <span style="color:#900;font-weight:bold">send</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Access the output (only Reader is accessible non-const)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">const</span> Reassembler<span style="color:#000;font-weight:bold">&amp;</span> reassembler() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> reassembler_; }
</span></span><span style="display:flex;"><span>  Reader<span style="color:#000;font-weight:bold">&amp;</span> reader() { <span style="color:#000;font-weight:bold">return</span> reassembler_.reader(); }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> Reader<span style="color:#000;font-weight:bold">&amp;</span> reader() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> reassembler_.reader(); }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> Writer<span style="color:#000;font-weight:bold">&amp;</span> writer() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> reassembler_.writer(); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  Reassembler reassembler_;
</span></span><span style="display:flex;"><span>  std<span style="color:#000;font-weight:bold">::</span>optional<span style="color:#000;font-weight:bold">&lt;</span>Wrap32<span style="color:#000;font-weight:bold">&gt;</span> ISN_ {};  <span style="color:#998;font-style:italic">// å› ä¸ºTCP SYN åºåˆ—æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå˜é‡æ¥ç»´æŠ¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>};
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// tcp_receiver.cc
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;tcp_receiver.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">using</span> <span style="color:#000;font-weight:bold">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  æ¥æ”¶æ¶ˆæ¯å¹¶è°ƒç”¨é‡ç»„å™¨ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  è¿™ä¸ªå‡½æ•°è¦å®ç°çš„åŠŸèƒ½ä¸»è¦æœ‰ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - è®¡ç®—stream index
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - æ’é™¤ä¸æ­£ç¡®çš„message
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  å®ç°æ€è·¯ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    1. stream indexå¯ä»¥æ ¹æ®absolute seqnoæ¥è®¡ç®—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆè®¡ç®—absolute seqnoï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    è¿™é‡Œå¯ä»¥ç”¨åˆ°wrapping_integersé‡Œå®ç°å¥½çš„Wrap32ç±»æ¥å®ç°ç›¸å…³è½¬æ¢ã€‚é¦–å…ˆæ‰¾åˆ°ä¸€ä¸ªcheck
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    -pointï¼Œç„¶ååªéœ€è¦è°ƒç”¨unwrapå‡½æ•°æ±‚å¾—å¯¹åº”çš„absolute seqnoå³å¯ï¼Œæ³¨æ„æœ€åæ’å…¥çš„æ—¶å€™
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    æˆ‘ä»¬è¦è€ƒè™‘SYNï¼Œæ‰€ä»¥åº”è¯¥æ’å…¥absolute seqno - 1ï¼ˆ0é™¤å¤–ï¼‰ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    2. è¦æ’é™¤ä¸æ­£ç¡®çš„messageï¼Œä¸»è¦æœ‰ä¸¤ç§æƒ…å†µï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      - åˆšæ¥æ”¶ä¸€ä¸ªSYNæŠ¥æ–‡ï¼Œä¸‹ä¸€ä¸ªåˆæ˜¯åºå·ä¸ºISNçš„ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      - è¿˜æœªæ¥æ”¶SYNæŠ¥æ–‡ï¼Œä½†æ˜¯æ¥çš„æ¶ˆæ¯ä¸æ˜¯SYNæŠ¥æ–‡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> TCPReceiver<span style="color:#000;font-weight:bold">::</span>receive( TCPSenderMessage message )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> checkpoint <span style="color:#000;font-weight:bold">=</span> reassembler_.writer().bytes_pushed() <span style="color:#000;font-weight:bold">+</span> ISN_.has_value();
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( message.RST ) {
</span></span><span style="display:flex;"><span>    reassembler_.reader().set_error();
</span></span><span style="display:flex;"><span>  } <span style="color:#000;font-weight:bold">else</span> <span style="color:#900;font-weight:bold">if</span> ( checkpoint <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> checkpoint <span style="color:#000;font-weight:bold">&lt;=</span> UINT32_MAX <span style="color:#000;font-weight:bold">&amp;&amp;</span> message.seqno <span style="color:#000;font-weight:bold">==</span> ISN_ ) 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">!</span>ISN_.has_value() ) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">!</span>message.SYN )
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    ISN_ <span style="color:#000;font-weight:bold">=</span> message.seqno;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> abso_seqno <span style="color:#000;font-weight:bold">=</span> message.seqno.unwrap( <span style="color:#000;font-weight:bold">*</span>ISN_, checkpoint );
</span></span><span style="display:flex;"><span>  reassembler_.insert( abso_seqno <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">?</span> <span style="color:#900;font-weight:bold">abso_seqno</span> : abso_seqno <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>, move( message.payload ), message.FIN );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  è¿”å›ç»™å‘é€æ–¹ç›¸å…³ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  è¿™ä¸ªå‡½æ•°ä¸»è¦å®ç°ä¸€ä¸ªå†…å®¹ï¼šè¿”å›ç¡®è®¤å·ã€æ¥æ”¶çª—å£å¤§å°ã€æ–­å¼€è¿æ¥æ ‡å¿—ä½ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  è¿™ä¸ªå‡½æ•°å®ç°æ¯”è¾ƒç®€å•ï¼Œå…·ä½“çœ‹ä»£ç å³å¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span>TCPReceiverMessage TCPReceiver<span style="color:#000;font-weight:bold">::</span>send() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> checkpoint <span style="color:#000;font-weight:bold">=</span> reassembler_.writer().bytes_pushed() <span style="color:#000;font-weight:bold">+</span> ISN_.has_value();
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> capacity <span style="color:#000;font-weight:bold">=</span> reassembler_.writer().available_capacity();
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint16_t</span> wnd_size <span style="color:#000;font-weight:bold">=</span> capacity <span style="color:#000;font-weight:bold">&gt;</span> UINT16_MAX <span style="color:#000;font-weight:bold">?</span> <span style="color:#900;font-weight:bold">UINT16_MAX</span> : capacity;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">!</span>ISN_.has_value() )
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> { {}, wnd_size, reassembler_.writer().has_error() };
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å¦‚æœå…³é—­äº†ï¼Œåˆ™å‘é€FINåŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">return</span>  { Wrap32<span style="color:#000;font-weight:bold">::</span>wrap( checkpoint <span style="color:#000;font-weight:bold">+</span> reassembler_.writer().is_closed(),  <span style="color:#000;font-weight:bold">*</span>ISN_),
</span></span><span style="display:flex;"><span>            wnd_size,
</span></span><span style="display:flex;"><span>            reassembler_.writer().has_error() };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤éƒ¨åˆ†éƒ½å®Œæˆååœ¨minnowç›®å½•ä¸‹æ‰§è¡Œ<code>cmake --build build --target check2</code>ï¼Œä¸‹é¢é™„ä¸Šé€šè¿‡ç»“æœï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Test project /home/sniffstherose/cs144/minnow/build
</span></span><span style="display:flex;"><span>      Start  1: compile with bug-checkers
</span></span><span style="display:flex;"><span> 1/29 Test  <span style="color:#998;font-style:italic">#1: compile with bug-checkers ........   Passed   16.22 sec</span>
</span></span><span style="display:flex;"><span>      Start  3: byte_stream_basics
</span></span><span style="display:flex;"><span> 2/29 Test  <span style="color:#998;font-style:italic">#3: byte_stream_basics ...............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  4: byte_stream_capacity
</span></span><span style="display:flex;"><span> 3/29 Test  <span style="color:#998;font-style:italic">#4: byte_stream_capacity .............   Passed    0.05 sec</span>
</span></span><span style="display:flex;"><span>      Start  5: byte_stream_one_write
</span></span><span style="display:flex;"><span> 4/29 Test  <span style="color:#998;font-style:italic">#5: byte_stream_one_write ............   Passed    0.05 sec</span>
</span></span><span style="display:flex;"><span>      Start  6: byte_stream_two_writes
</span></span><span style="display:flex;"><span> 5/29 Test  <span style="color:#998;font-style:italic">#6: byte_stream_two_writes ...........   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  7: byte_stream_many_writes
</span></span><span style="display:flex;"><span> 6/29 Test  <span style="color:#998;font-style:italic">#7: byte_stream_many_writes ..........   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start  8: byte_stream_stress_test
</span></span><span style="display:flex;"><span> 7/29 Test  <span style="color:#998;font-style:italic">#8: byte_stream_stress_test ..........   Passed    0.15 sec</span>
</span></span><span style="display:flex;"><span>      Start  9: reassembler_single
</span></span><span style="display:flex;"><span> 8/29 Test  <span style="color:#998;font-style:italic">#9: reassembler_single ...............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 10: reassembler_cap
</span></span><span style="display:flex;"><span> 9/29 Test <span style="color:#998;font-style:italic">#10: reassembler_cap ..................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 11: reassembler_seq
</span></span><span style="display:flex;"><span>10/29 Test <span style="color:#998;font-style:italic">#11: reassembler_seq ..................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 12: reassembler_dup
</span></span><span style="display:flex;"><span>11/29 Test <span style="color:#998;font-style:italic">#12: reassembler_dup ..................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 13: reassembler_holes
</span></span><span style="display:flex;"><span>12/29 Test <span style="color:#998;font-style:italic">#13: reassembler_holes ................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 14: reassembler_overlapping
</span></span><span style="display:flex;"><span>13/29 Test <span style="color:#998;font-style:italic">#14: reassembler_overlapping ..........   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 15: reassembler_win
</span></span><span style="display:flex;"><span>14/29 Test <span style="color:#998;font-style:italic">#15: reassembler_win ..................   Passed    0.28 sec</span>
</span></span><span style="display:flex;"><span>      Start 16: wrapping_integers_cmp
</span></span><span style="display:flex;"><span>15/29 Test <span style="color:#998;font-style:italic">#16: wrapping_integers_cmp ............   Passed    0.02 sec</span>
</span></span><span style="display:flex;"><span>      Start 17: wrapping_integers_wrap
</span></span><span style="display:flex;"><span>16/29 Test <span style="color:#998;font-style:italic">#17: wrapping_integers_wrap ...........   Passed    0.02 sec</span>
</span></span><span style="display:flex;"><span>      Start 18: wrapping_integers_unwrap
</span></span><span style="display:flex;"><span>17/29 Test <span style="color:#998;font-style:italic">#18: wrapping_integers_unwrap .........   Passed    0.01 sec</span>
</span></span><span style="display:flex;"><span>      Start 19: wrapping_integers_roundtrip
</span></span><span style="display:flex;"><span>18/29 Test <span style="color:#998;font-style:italic">#19: wrapping_integers_roundtrip ......   Passed    1.40 sec</span>
</span></span><span style="display:flex;"><span>      Start 20: wrapping_integers_extra
</span></span><span style="display:flex;"><span>19/29 Test <span style="color:#998;font-style:italic">#20: wrapping_integers_extra ..........   Passed    0.31 sec</span>
</span></span><span style="display:flex;"><span>      Start 21: recv_connect
</span></span><span style="display:flex;"><span>20/29 Test <span style="color:#998;font-style:italic">#21: recv_connect .....................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 22: recv_transmit
</span></span><span style="display:flex;"><span>21/29 Test <span style="color:#998;font-style:italic">#22: recv_transmit ....................   Passed    0.31 sec</span>
</span></span><span style="display:flex;"><span>      Start 23: recv_window
</span></span><span style="display:flex;"><span>22/29 Test <span style="color:#998;font-style:italic">#23: recv_window ......................   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 24: recv_reorder
</span></span><span style="display:flex;"><span>23/29 Test <span style="color:#998;font-style:italic">#24: recv_reorder .....................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 25: recv_reorder_more
</span></span><span style="display:flex;"><span>24/29 Test <span style="color:#998;font-style:italic">#25: recv_reorder_more ................   Passed    0.78 sec</span>
</span></span><span style="display:flex;"><span>      Start 26: recv_close
</span></span><span style="display:flex;"><span>25/29 Test <span style="color:#998;font-style:italic">#26: recv_close .......................   Passed    0.09 sec</span>
</span></span><span style="display:flex;"><span>      Start 27: recv_special
</span></span><span style="display:flex;"><span>26/29 Test <span style="color:#998;font-style:italic">#27: recv_special .....................   Passed    0.09 sec</span>
</span></span><span style="display:flex;"><span>      Start 37: compile with optimization
</span></span><span style="display:flex;"><span>27/29 Test <span style="color:#998;font-style:italic">#37: compile with optimization ........   Passed    1.76 sec</span>
</span></span><span style="display:flex;"><span>      Start 38: byte_stream_speed_test
</span></span><span style="display:flex;"><span>             ByteStream throughput: 28.69 Gbit/s
</span></span><span style="display:flex;"><span>28/29 Test <span style="color:#998;font-style:italic">#38: byte_stream_speed_test ...........   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 39: reassembler_speed_test
</span></span><span style="display:flex;"><span>             Reassembler throughput: 12.50 Gbit/s
</span></span><span style="display:flex;"><span>29/29 Test <span style="color:#998;font-style:italic">#39: reassembler_speed_test ...........   Passed    0.13 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#099">0</span> tests failed out of <span style="color:#099">29</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#0086b3">time</span> <span style="color:#000;font-weight:bold">(</span>real<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span>  22.72 sec
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>::è¿™éƒ¨åˆ†æŠ˜ç£¨æ­»æˆ‘äº†ï¼Œç‰¹åˆ«æ˜¯wrapå’Œunwrapï¼Œæ€»æ„Ÿè§‰è„‘è¢‹è½¬ä¸è¿‡æ¥ï¼Œæ¨¡è¿ç®—ä¸€ç”Ÿä¹‹æ•Œå•Šã€‚</p>
</blockquote>
<p>æœ€åè®°å¾—gitæäº¤ä¸€ä¸‹å³å¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µğŸ˜¢</p>
<h2 id="lab-3">lab 3</h2>
<p><a href="https://tryanel.github.io/Documents/check3.pdf">lab3æ–‡æ¡£</a></p>
<h3 id="overview-1">Overview</h3>
<p>è€æ ·å­ï¼Œå‘Šè¯‰æˆ‘ä»¬å‰é¢çš„å®éªŒåšäº†å•¥ã€‚è¿˜æœ‰è¿™æ¬¡å®éªŒè¦å®ç°TCPSenderï¼Œä½œä¸ºTCPè¿æ¥çš„å¦ä¸€ç«¯ã€‚è¿˜å‘Šè¯‰æˆ‘ä»¬lab4å°†æŠŠæ‰€æœ‰çš„å®ç°ç»“åˆèµ·æ¥ã€‚</p>
<h3 id="getting-started-2">Getting started</h3>
<p>è€æ ·å­ï¼Œmergeä¸€ä¸‹åˆå§‹ä»£ç ï¼Œåˆå§‹åŒ–build systemã€‚</p>
<h3 id="checkpoint-3-the-tcp-sender">Checkpoint 3: The TCP Sender</h3>
<p>æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬è¿™å‘¨å°†å®ç°TCPSenderï¼Œè´Ÿè´£ä»ByteStreamä¸­è¯»å–æ•°æ®å¹¶å°†æµè½¬æ¢ä¸ºæ®µç”¨äºå‘é€å‡ºå»ï¼ŒTCPSenderå°†ä¼šè´Ÿè´£è¿™å‡ ç‚¹ï¼š</p>
<p><img src="./imgs/image-20240929162752960.png" alt="image-20240929162752960"></p>
<p>è¿™éƒ¨åˆ†è®²äº†TCPSenderçš„æ ¸å¿ƒé€»è¾‘ï¼Œæ¶‰åŠè¶…æ—¶é‡ä¼ å’Œæ»‘åŠ¨çª—å£æœºåˆ¶ã€‚æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬TCPSenderçš„æ ¸å¿ƒæµç¨‹ï¼š</p>
<ol>
<li>è®°å½•æ¥æ”¶ç«¯å‘ŠçŸ¥çš„çª—å£å¤§å°ï¼ˆlab2å®ç°çš„window sizeï¼‰ï¼Œå¯ä»¥ä»TCPReceiverMessageä¸­è·å–ï¼›</li>
<li>åœ¨ByteStreamä¸­è¯»å–payloadï¼Œåœ¨çª—å£å¤§å°å…è®¸çš„æƒ…å†µä¸‹è¿½åŠ æ§åˆ¶ä½SYNå’ŒFINï¼Œå¡«å……æŠ¥æ–‡ç›´åˆ°çª—å£å·²æ»¡æˆ–æ²¡æœ‰ä¸œè¥¿å¯å‘é€ï¼›</li>
<li>è¿½è¸ªé‚£äº›æŠ¥æ–‡æœªæ”¶åˆ°ç¡®è®¤å·å›å¤ï¼Œè¿™éƒ¨åˆ†æŠ¥æ–‡ç§°ä¹‹ä¸ºâ€œæœªå®Œæˆçš„å­—èŠ‚â€ï¼›</li>
<li>æœªå®Œæˆçš„å­—èŠ‚åœ¨ä¸€å®šæ—¶é—´åä»æœªæ”¶åˆ°ç¡®è®¤å›å¤åˆ™é‡ä¼ ã€‚</li>
</ol>
<p>æ³¨æ„ï¼šsenderå‘é€æŠ¥æ–‡æ—¶SYNä¸€å®šä¸ºtrueçš„æƒ…å†µåªæœ‰ç¬¬ä¸€ä¸ªæŠ¥æ–‡éœ€è¦è¯·æ±‚è¿æ¥æ—¶ï¼Œåç»­çš„SYNä¸ä¸€å®šéœ€è¦ä¸ºtrueï¼Œéœ€è¦æ ¹æ®æƒ…å†µå†³å®šï¼ˆå¦‚æœæœªæ”¶åˆ°SYNåŒ…çš„ç¡®è®¤å·åˆ™SYNä¸ºtrueï¼‰ã€‚</p>
<p>è¶…æ—¶é‡ä¼ éƒ¨åˆ†ï¼Œæ–‡æ¡£ä¸­å‘Šè¯‰æˆ‘ä»¬TCPSenderä¼šå‘¨æœŸæ€§çš„è°ƒç”¨tick()æ–¹æ³•å‘ŠçŸ¥è·ç¦»ä¸Šæ¬¡è°ƒç”¨è¿‡äº†å¤šä¹…ï¼ˆmsï¼‰ã€‚å¦‚æœè¿™ä¸ªæ—¶é—´è¶…è¿‡äº†RTOï¼ˆé‡ä¼ æ—¶é—´é—´éš”ï¼‰ï¼Œåˆ™ç«‹å³é‡æ–°å‘é€<strong>æœ€æ—©æ²¡è¢«ç¡®è®¤</strong>çš„æŠ¥æ–‡ï¼Œå¹¶ä¸”åªå‘ä¸€æ¬¡ã€‚</p>
<h4 id="how-does-the-tcpsender-know-if-a-segment-was-lost">How does the TCPSender know if a segment was lost?</h4>
<p>è¿™éƒ¨åˆ†è¯¦ç»†è®²äº†TCPSenderçš„è‡ªåŠ¨é‡ä¼ åè®®ã€‚é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®æˆ‘ä»¬éœ€è¦é‡ä¼ å‘é€è¿‡çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¸€å®šè¦æœ‰ç¼“å­˜ï¼Œè€Œé‡ä¼ çš„æœºåˆ¶å°±æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œæ‰€ä»¥è€ƒè™‘ä½¿ç”¨queueå®ç°ã€‚</p>
<p>å› ä¸ºæŠ¥æ–‡ä¸­seqnoæ˜¯wrap32ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å†ç»´æŠ¤ä¸€ä¸ªuint64ç±»å‹çš„absolute seqnoç”¨æ¥è¡¨ç¤ºç¡®è®¤å·ç¡®è®¤åˆ°å“ªäº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨ç»´æŠ¤ï¼Œåªä¸è¿‡æ¯æ¬¡éƒ½å¾—è°ƒç”¨wrap32ä¸­çš„unwrapæ–¹æ³•ã€‚å½“ç„¶ï¼Œå½“å‰åˆšå‘é€çš„æˆ‘ä»¬ä¹Ÿéœ€è¦ç»´æŠ¤ä¸€ä¸ªå˜é‡ä¿å­˜ã€‚</p>
<ol>
<li>
<p>æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬TCPSenderä¼šå‘¨æœŸæ€§è°ƒç”¨tick()å‡½æ•°ï¼Œæ–‡æ¡£å¸Œæœ›æˆ‘ä»¬ä¸è¦ä½¿ç”¨time()æˆ–æ˜¯now()å‡½æ•°æ¥è·å–ç°å®æ—¶é—´ï¼Œåº”è¯¥ä½¿ç”¨ç»™å®šçš„å‚æ•°æ¥è·å–æ—¶é—´ä¿¡æ¯ï¼›</p>
</li>
<li>
<p>TCPSenderå¯¹è±¡æ„é€ æ—¶ä¼šæ¥å—ä¸€ä¸ªåˆå§‹å€¼ï¼Œç”¨ä½œåˆå§‹é‡ä¼ æ—¶é—´é—´éš”ï¼›</p>
</li>
<li>
<p>å…³äºè‡ªåŠ¨é‡ä¼ çš„è®¾è®¡ï¼Œæ–‡æ¡£å»ºè®®æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªè®¡æ—¶å™¨ç±»ï¼Œç”¨æ¥ä¿å­˜RTOï¼Œå¹¶ä¸”åœ¨ç´¯è®¡æ—¶é—´å¤§äºRTOåå°†è®¡æ—¶å™¨çŠ¶æ€è½¬ä¸ºâ€œå·²è¿‡æœŸâ€ï¼›</p>
</li>
<li>
<p>æ¯æ¬¡å‘é€é0é•¿æŠ¥æ–‡æ—¶å¦‚æœè®¡æ—¶å™¨æ²¡æœ‰å¯åŠ¨åˆ™éƒ½éœ€è¦å¯åŠ¨å®ƒï¼›</p>
</li>
<li>
<p>æ¥æ”¶ç¡®è®¤æŠ¥æ–‡æ—¶ï¼Œå¦‚æœæ‰€æœ‰çš„æœªå®Œæˆæ•°æ®éƒ½å·²ç»è¢«ç¡®è®¤ï¼Œåˆ™åœæ­¢è®¡æ—¶å™¨ï¼›</p>
<blockquote>
<p>å¦‚æœå¤ªå¤§äº†å¤§çš„ç¦»è°±ï¼Œæ¯”å¦‚æˆ‘è¿˜æ²¡å‘ä½ å…ˆç¡®è®¤äº†ã€‚ç©å‘¢ï¼Ÿè¿™ç§å°±å¾—ä¸¢å¼ƒï¼Œä¸äºˆç†ç¬ã€‚</p>
</blockquote>
</li>
<li>
<p>å¦‚æœè°ƒç”¨tick()æ—¶è®¡æ—¶å™¨è¿‡æœŸï¼š</p>
<ol>
<li>é‡å‘æœ€æ—©æœªè¢«ç¡®è®¤çš„æŠ¥æ–‡ï¼›</li>
<li>çª—å£å¤§å°ä¸ä¸º0ï¼š
<ol>
<li>é‡ä¼ æŠ¥æ–‡ï¼Œæ›´æ–°é‡ä¼ è®¡æ•°ï¼›</li>
<li>å°†RTOä¹˜ä»¥2ã€‚</li>
</ol>
</li>
<li>é‡ç½®è®¡æ—¶å™¨ã€‚</li>
</ol>
</li>
<li>
<p>æ¥æ”¶æ–¹ç¡®è®¤ï¼š</p>
<ol>
<li>å°†RTOé‡ç½®ï¼›</li>
<li>å¦‚æœsenderæ­¤æ—¶è¿˜æœ‰å·¥ä½œï¼Œé‡å¯è®¡æ—¶å™¨ç»§ç»­å·¥ä½œ</li>
<li>é‡ç½®é‡ä¼ è®¡æ•°å™¨</li>
</ol>
</li>
</ol>
<h4 id="implementing-the-tcp-sender">Implementing the TCP sender</h4>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ„‰å¿«çš„æ’¸ä»£ç ç¯èŠ‚äº†ï¼š</p>
<ol>
<li>
<p>push()æ–¹æ³•ï¼špushæ–¹æ³•è´Ÿè´£ä¸æ–­ä»ByteStreamä¸­è¯»å–å­—èŠ‚å¡«å……çª—å£ï¼Œç›´åˆ°æ²¡æœ‰æ–°çš„å­—èŠ‚å¯è¯»æˆ–è€…çª—å£å¡«æ»¡æˆ–è€…è¶…è¿‡äº†TCPConfigä¸­è§„å®šçš„ä¸Šé™ã€‚</p>
<p>æœ‰ä¸€ä¸ªç‰¹æ®Šç‚¹ï¼šå½“å¯¹æ–¹å‘Šè¯‰çª—å£å¤§å°ä¸º0æ—¶ï¼Œå‘é€æ–¹åº”è¯¥å‡è®¾å…¶çª—å£å¤§å°ä¸º1ï¼Œå‘é€ä¸€ä¸ªå¤§å°ä¸º1byteçš„è¯•æ¢æ•°æ®æŠ¥ï¼Œé˜²æ­¢æ­»é”ã€‚</p>
<p><img src="./imgs/image-20240930153122495.png" alt="image-20240930153122495"></p>
</li>
<li>
<p>receive()æ–¹æ³•ï¼šreceiveæ–¹æ³•è´Ÿè´£æ¥æ”¶å‘é€å‘çš„ç¡®è®¤æ¶ˆæ¯ï¼Œæ›´æ–°ç¼“å†²åŒºã€‚æ›´æ–°æ¡ä»¶ä¸ºï¼šacknoå¤§äºç¼“å†²åŒºé¦–æ®µæŠ¥æ–‡çš„æ‰€æœ‰å­—èŠ‚åºå·ï¼Œå¦‚æœåªæ˜¯å¤§äºéƒ¨åˆ†æˆ‘ä»¬ä¸äºˆç†ç¬ï¼Œæ–‡æ¡£ä¹Ÿå‘Šè¯‰æˆ‘ä»¬æ²¡å¿…è¦æˆªæ–­ã€‚</p>
<p><img src="./imgs/image-20240930153445744.png" alt="image-20240930153445744"></p>
</li>
<li>
<p>tick()æ–¹æ³•ï¼šç›´æ¥çœ‹æ–‡æ¡£</p>
<p><img src="./imgs/image-20240930154028822.png" alt="image-20240930154028822"></p>
</li>
<li>
<p>make empty message()æ–¹æ³•ï¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªé›¶é•¿æŠ¥æ–‡ï¼Œå…¶ç‰¹å¾å¦‚ä¸‹ï¼š</p>
<ol>
<li>SYNã€FINä¸ºfalseï¼›</li>
<li>payloadä¸ºç©ºï¼›</li>
<li>RSTç”±ByteStreamå†³å®š</li>
</ol>
</li>
</ol>
<p>æœ€åçœ‹çœ‹FAQSï¼š</p>
<p><img src="./imgs/image-20240930154347689.png" alt="image-20240930154347689"></p>
<p>ä»£ç å®ç°ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// tcp_sender.hh
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;byte_stream.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;tcp_receiver_message.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;tcp_sender_message.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;cstdint&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;functional&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;list&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;memory&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;optional&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;queue&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  è®¡æ—¶å™¨è¾…åŠ©ç±»ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  æˆå‘˜å˜é‡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - RTO
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - è¿‡å»äº†å¤šä¹…æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - æ˜¯å¦å¯ç”¨è®¡æ—¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  æˆå‘˜å‡½æ•°ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - is_expired()ï¼ˆæ˜¯å¦è¿‡æœŸï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - is_active()ï¼ˆæ˜¯å¦å¯ç”¨ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - active()ï¼ˆè®¾ç½®activeï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - timeout()ï¼ˆå°†RTOä¹˜2ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - reset()ï¼ˆé‡ç½®è®¡æ—¶å™¨ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - tick()ï¼ˆè¿”å›è·ç¦»ä¸Šæ¬¡è°ƒç”¨è¿‡äº†å¤šä¹…ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">RetransmissionTimer</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  RetransmissionTimer( <span style="color:#458;font-weight:bold">uint64_t</span> RTO ) <span style="color:#000;font-weight:bold">:</span> RTO_( RTO ) {}
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">is_expired</span>() <span style="color:#000;font-weight:bold">const</span> <span style="color:#000;font-weight:bold">noexcept</span> { <span style="color:#000;font-weight:bold">return</span> is_active_ <span style="color:#000;font-weight:bold">&amp;&amp;</span> time_passed_ <span style="color:#000;font-weight:bold">&gt;=</span> RTO_; }
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">is_active</span>() <span style="color:#000;font-weight:bold">const</span> <span style="color:#000;font-weight:bold">noexcept</span> { <span style="color:#000;font-weight:bold">return</span> is_active_; }
</span></span><span style="display:flex;"><span>  RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> active() <span style="color:#000;font-weight:bold">noexcept</span>;
</span></span><span style="display:flex;"><span>  RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> timeout() <span style="color:#000;font-weight:bold">noexcept</span>;
</span></span><span style="display:flex;"><span>  RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> reset() <span style="color:#000;font-weight:bold">noexcept</span>;
</span></span><span style="display:flex;"><span>  RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> tick( <span style="color:#458;font-weight:bold">uint64_t</span> ms_since_last_tick ) <span style="color:#000;font-weight:bold">noexcept</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint64_t</span> RTO_;
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint64_t</span> time_passed_ {};
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> is_active_ {};
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TCPSender</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/* Construct TCP sender with given default Retransmission Timeout and possible ISN */</span>
</span></span><span style="display:flex;"><span>  TCPSender( ByteStream<span style="color:#000;font-weight:bold">&amp;&amp;</span> input, Wrap32 isn, <span style="color:#458;font-weight:bold">uint64_t</span> initial_RTO_ms )
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span> input_( std<span style="color:#000;font-weight:bold">::</span>move( input ) ), isn_( isn ), initial_RTO_ms_( initial_RTO_ms ), timer_( initial_RTO_ms )
</span></span><span style="display:flex;"><span>  {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/* Generate an empty TCPSenderMessage */</span>
</span></span><span style="display:flex;"><span>  TCPSenderMessage <span style="color:#900;font-weight:bold">make_empty_message</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/* Receive and process a TCPReceiverMessage from the peer&#39;s receiver */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">receive</span>( <span style="color:#000;font-weight:bold">const</span> TCPReceiverMessage<span style="color:#000;font-weight:bold">&amp;</span> msg );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/* Type of the `transmit` function that the push and tick methods can use to send messages */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">using</span> TransmitFunction <span style="color:#000;font-weight:bold">=</span> std<span style="color:#000;font-weight:bold">::</span>function<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span>( <span style="color:#000;font-weight:bold">const</span> TCPSenderMessage<span style="color:#000;font-weight:bold">&amp;</span> )<span style="color:#000;font-weight:bold">&gt;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/* Push bytes from the outbound stream */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">push</span>( <span style="color:#000;font-weight:bold">const</span> TransmitFunction<span style="color:#000;font-weight:bold">&amp;</span> transmit );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/* Time has passed by the given # of milliseconds since the last time the tick() method was called */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">tick</span>( <span style="color:#458;font-weight:bold">uint64_t</span> ms_since_last_tick, <span style="color:#000;font-weight:bold">const</span> TransmitFunction<span style="color:#000;font-weight:bold">&amp;</span> transmit );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Accessors
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">sequence_numbers_in_flight</span>() <span style="color:#000;font-weight:bold">const</span>;  <span style="color:#998;font-style:italic">// How many sequence numbers are outstanding?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> <span style="color:#900;font-weight:bold">consecutive_retransmissions</span>() <span style="color:#000;font-weight:bold">const</span>; <span style="color:#998;font-style:italic">// How many consecutive *re*transmissions have happened?
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  Writer<span style="color:#000;font-weight:bold">&amp;</span> writer() { <span style="color:#000;font-weight:bold">return</span> input_.writer(); }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> Writer<span style="color:#000;font-weight:bold">&amp;</span> writer() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> input_.writer(); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Access input stream reader, but const-only (can&#39;t read from outside)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">const</span> Reader<span style="color:#000;font-weight:bold">&amp;</span> reader() <span style="color:#000;font-weight:bold">const</span> { <span style="color:#000;font-weight:bold">return</span> input_.reader(); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Variables initialized in constructor
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  ByteStream input_;  <span style="color:#998;font-style:italic">// æ¥å—æ¥æ”¶æ–¹æ¶ˆæ¯çš„ByteStream
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  Wrap32 isn_;
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint64_t</span> initial_RTO_ms_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  TCPSenderMessage <span style="color:#900;font-weight:bold">make_message</span>( <span style="color:#458;font-weight:bold">uint64_t</span> seqno, std<span style="color:#000;font-weight:bold">::</span>string payload, <span style="color:#458;font-weight:bold">bool</span> SYN, <span style="color:#458;font-weight:bold">bool</span> FIN <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span> ) <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    éœ€è¦æ·»åŠ çš„å˜é‡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - çª—å£å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - å·²ç¡®è®¤çš„åºåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - å¾…å‘é€çš„ä¸‹ä¸€å­—èŠ‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - æœªå®Œæˆå­—èŠ‚ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - SYNå’ŒFINæ ‡å¿—ä½ï¼Œä»¥åŠæ˜¯å¦å‘é€è¿‡SYNå’ŒFINçš„æ ‡å¿—ä½
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - è®¡æ—¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - é‡ä¼ æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    - æœªå®Œæˆçš„åºåˆ—å·æ€»æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">uint16_t</span> wnd_size_ { <span style="color:#099">1</span> }; <span style="color:#998;font-style:italic">// æ¥æ”¶æ–¹çª—å£å¤§å°ï¼Œåˆå§‹å€¼å‡å®š1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> acked_seqno_ {}; <span style="color:#998;font-style:italic">// ç¡®è®¤åˆ°å“ªäº†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> next_seqno_ {};  <span style="color:#998;font-style:italic">// å¾…å‘é€çš„ä¸‹ä¸€å­—èŠ‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">bool</span> syn_flag_ {}, fin_flag_ {}, sent_syn_ {}, sent_fin_ {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  std<span style="color:#000;font-weight:bold">::</span>queue<span style="color:#000;font-weight:bold">&lt;</span>TCPSenderMessage<span style="color:#000;font-weight:bold">&gt;</span> outstanding_bytes_ {}; <span style="color:#998;font-style:italic">// æœªå®Œæˆå­—èŠ‚ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  RetransmissionTimer timer_; <span style="color:#998;font-style:italic">// è®¡æ—¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> retransmission_cnt_ {};  <span style="color:#998;font-style:italic">// é‡ä¼ æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">uint64_t</span> nbytes_in_flight_ {};
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// tcp_sender.cc
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;tcp_sender.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;tcp_config.hh&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">using</span> <span style="color:#000;font-weight:bold">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> RetransmissionTimer<span style="color:#000;font-weight:bold">::</span>active() <span style="color:#000;font-weight:bold">noexcept</span> {
</span></span><span style="display:flex;"><span>  is_active_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> RetransmissionTimer<span style="color:#000;font-weight:bold">::</span>timeout() <span style="color:#000;font-weight:bold">noexcept</span> {
</span></span><span style="display:flex;"><span>  RTO_ <span style="color:#000;font-weight:bold">&lt;&lt;=</span> <span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> RetransmissionTimer<span style="color:#000;font-weight:bold">::</span>reset() <span style="color:#000;font-weight:bold">noexcept</span> {
</span></span><span style="display:flex;"><span>  time_passed_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RetransmissionTimer<span style="color:#000;font-weight:bold">&amp;</span> RetransmissionTimer<span style="color:#000;font-weight:bold">::</span>tick( <span style="color:#458;font-weight:bold">uint64_t</span> ms_since_last_tick ) <span style="color:#000;font-weight:bold">noexcept</span> {
</span></span><span style="display:flex;"><span>  time_passed_ <span style="color:#000;font-weight:bold">+=</span> is_active_ <span style="color:#000;font-weight:bold">?</span> <span style="color:#900;font-weight:bold">ms_since_last_tick</span> : <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> TCPSender<span style="color:#000;font-weight:bold">::</span>sequence_numbers_in_flight() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> nbytes_in_flight_;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">uint64_t</span> TCPSender<span style="color:#000;font-weight:bold">::</span>consecutive_retransmissions() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> retransmission_cnt_;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  æ¨é€å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  1. åˆå§‹åŒ–ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å—æ–¹çª—å£å¤§å°ï¼Œfinæ ‡å¿—ä½ç­‰ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  2. å¾ªç¯ä»ByteStreamä¸­è¯»å–æ•°æ®å¹¶ç»„è£…æ•°æ®åŒ…ç›´åˆ°è¾¾åˆ°çª—å£ä¸Šé™æˆ–æ²¡æœ‰æ•°æ®äº†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  æ³¨æ„å‘å‡ºFINåä¸å†å‘é€ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  3. å°è£…å¥½æ¶ˆæ¯ï¼Œåˆ¤æ–­èƒ½å¦å‘é€FINï¼Œè®¾ç½®ç›¸åº”çš„æ ‡å¿—ä½
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  4. å‘é€æ¶ˆæ¯ï¼Œå¯ç”¨è®¡æ—¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> TCPSender<span style="color:#000;font-weight:bold">::</span>push( <span style="color:#000;font-weight:bold">const</span> TransmitFunction<span style="color:#000;font-weight:bold">&amp;</span> transmit )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  Reader<span style="color:#000;font-weight:bold">&amp;</span> bytes_reader <span style="color:#000;font-weight:bold">=</span> input_.reader();
</span></span><span style="display:flex;"><span>  fin_flag_ <span style="color:#000;font-weight:bold">|=</span> bytes_reader.is_finished();  <span style="color:#998;font-style:italic">// åˆšå»ºç«‹å°±å…³é—­ï¼ˆè„‘å­åæ‰äº†å§ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span> ( sent_fin_ ) <span style="color:#998;font-style:italic">// å¦‚æœå·²ç»å‘é€è¿‡äº†finåˆ™åç»­ä¸å†å‘é€ä»»ä½•å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">const</span> size_t window_size <span style="color:#000;font-weight:bold">=</span> wnd_size_ <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">?</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">:</span> wnd_size_;  <span style="color:#998;font-style:italic">// åˆå§‹åŒ–æ¥æ”¶æ–¹çª—å£å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// å¾ªç¯ç»„è£…æ•°æ®æŠ¥ï¼Œå½“çª—å£è¾¾åˆ°ä¸Šé™æˆ–æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œå¹¶ä¸”å‘å‡ºFINåä¸ä¼šå†å°è¯•ç»„è£…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">for</span> ( string payload {}; nbytes_in_flight_ <span style="color:#000;font-weight:bold">&lt;</span> window_size <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">!</span>sent_fin_; payload.clear() ) {
</span></span><span style="display:flex;"><span>    string_view bytes_view <span style="color:#000;font-weight:bold">=</span> bytes_reader.peek();
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// æµä¸ºç©ºã€ä¸éœ€è¦å‘å‡ºFINã€å·²ç»å‘é€äº†è¿æ¥è¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> ( bytes_view.empty() <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">!</span>fin_flag_ <span style="color:#000;font-weight:bold">&amp;&amp;</span> sent_syn_ )
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// ä»æµä¸­è¯»å–æ•°æ®ï¼Œç»„è£…æŠ¥æ–‡ï¼Œç›´åˆ°è¾¾åˆ°æ–‡ä»¶é•¿åº¦é™åˆ¶æˆ–çª—å£ä¸Šé™
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">while</span> ( payload.size() <span style="color:#000;font-weight:bold">+</span> nbytes_in_flight_ <span style="color:#000;font-weight:bold">+</span> ( <span style="color:#000;font-weight:bold">!</span>sent_syn_ ) <span style="color:#000;font-weight:bold">&lt;</span> window_size
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&amp;&amp;</span> payload.size() <span style="color:#000;font-weight:bold">&lt;</span> TCPConfig<span style="color:#000;font-weight:bold">::</span>MAX_PAYLOAD_SIZE ) {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">if</span> ( bytes_view.empty() <span style="color:#000;font-weight:bold">||</span> fin_flag_ )  <span style="color:#998;font-style:italic">// æ²¡æœ‰æ•°æ®è¯»äº†æˆ–è€…å…³é—­äº†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">// å½“å‰åˆ†ç»„è¶…è¿‡é™åˆ¶åˆ™éœ€è¦æˆªæ–­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> available_size <span style="color:#000;font-weight:bold">=</span> min( TCPConfig<span style="color:#000;font-weight:bold">::</span>MAX_PAYLOAD_SIZE,
</span></span><span style="display:flex;"><span>           window_size <span style="color:#000;font-weight:bold">-</span> ( payload.size() <span style="color:#000;font-weight:bold">+</span> nbytes_in_flight_ <span style="color:#000;font-weight:bold">+</span> ( <span style="color:#000;font-weight:bold">!</span>sent_syn_ ) ) );
</span></span><span style="display:flex;"><span>           bytes_view.size() <span style="color:#000;font-weight:bold">&gt;</span> available_size )
</span></span><span style="display:flex;"><span>        bytes_view.remove_suffix( bytes_view.size() <span style="color:#000;font-weight:bold">-</span> available_size );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      payload.append( bytes_view );
</span></span><span style="display:flex;"><span>      bytes_reader.pop( bytes_view.size() );
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">// æ£€æŸ¥æµæ˜¯å¦å…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      fin_flag_ <span style="color:#000;font-weight:bold">|=</span> bytes_reader.is_finished();
</span></span><span style="display:flex;"><span>      bytes_view <span style="color:#000;font-weight:bold">=</span> bytes_reader.peek(); <span style="color:#998;font-style:italic">// è·å–ä¸‹ä¸€ç»„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å°è£…æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;</span> msg <span style="color:#000;font-weight:bold">=</span> outstanding_bytes_.emplace(
</span></span><span style="display:flex;"><span>    make_message( next_seqno_, move( payload ), sent_syn_ <span style="color:#000;font-weight:bold">?</span> <span style="color:#900;font-weight:bold">syn_flag_</span> : <span style="color:#0086b3">true</span>, fin_flag_ ) );
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// è‹¥å·²ç»å‘é€äº†synï¼Œåˆ™åç»­å¯èƒ½é‡å‘ä¹Ÿå¯èƒ½ä¸é‡å‘ï¼Œçœ‹syn_flag_
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">const</span> size_t margin <span style="color:#000;font-weight:bold">=</span> sent_syn_ <span style="color:#000;font-weight:bold">?</span> <span style="color:#900;font-weight:bold">syn_flag_</span> : <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å‘ä¸å‡ºå»FIN
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">if</span> ( fin_flag_ <span style="color:#000;font-weight:bold">&amp;&amp;</span> ( msg.sequence_length() <span style="color:#000;font-weight:bold">-</span> margin ) <span style="color:#000;font-weight:bold">+</span> nbytes_in_flight_ <span style="color:#000;font-weight:bold">&gt;</span> window_size )
</span></span><span style="display:flex;"><span>    msg.FIN <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">else</span> <span style="color:#900;font-weight:bold">if</span> ( fin_flag_ )  <span style="color:#998;font-style:italic">// å¦åˆ™å‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    sent_fin_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// æ³¨æ„è¿™é‡Œçš„ç»†èŠ‚ï¼Œç›¸å½“ç»†èŠ‚ï¼Œé˜²æ­¢æœ€ååŠ ä¸ŠSYNä¸å¯¹åŠ²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">const</span> size_t correct_size <span style="color:#000;font-weight:bold">=</span> msg.sequence_length() <span style="color:#000;font-weight:bold">-</span> margin;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  nbytes_in_flight_ <span style="color:#000;font-weight:bold">+=</span> correct_size;
</span></span><span style="display:flex;"><span>  next_seqno_ <span style="color:#000;font-weight:bold">+=</span> correct_size;
</span></span><span style="display:flex;"><span>  sent_syn_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>  transmit( msg );
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( correct_size <span style="color:#000;font-weight:bold">!=</span> <span style="color:#099">0</span> )
</span></span><span style="display:flex;"><span>    timer_.active();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TCPSenderMessage TCPSender<span style="color:#000;font-weight:bold">::</span>make_message( <span style="color:#458;font-weight:bold">uint64_t</span> seqno, string payload, <span style="color:#458;font-weight:bold">bool</span> SYN, <span style="color:#458;font-weight:bold">bool</span> FIN ) <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> {
</span></span><span style="display:flex;"><span>    .seqno <span style="color:#000;font-weight:bold">=</span> Wrap32<span style="color:#000;font-weight:bold">::</span>wrap( seqno, isn_ ),
</span></span><span style="display:flex;"><span>    .SYN <span style="color:#000;font-weight:bold">=</span> SYN,
</span></span><span style="display:flex;"><span>    .payload <span style="color:#000;font-weight:bold">=</span> move( payload ),
</span></span><span style="display:flex;"><span>    .FIN <span style="color:#000;font-weight:bold">=</span> FIN,
</span></span><span style="display:flex;"><span>    .RST <span style="color:#000;font-weight:bold">=</span> input_.reader().has_error()
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TCPSenderMessage TCPSender<span style="color:#000;font-weight:bold">::</span>make_empty_message() <span style="color:#000;font-weight:bold">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#900;font-weight:bold">make_message</span>( next_seqno_, {}, <span style="color:#0086b3">false</span> );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  æ¥æ”¶å‘é€æ–¹çš„ç¡®è®¤æ¶ˆæ¯ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  1. æ£€æŸ¥acknoæ˜¯å¦å­˜åœ¨æˆ–è€…è¶Šç•Œï¼Œè·å–window sizeçš„æƒ…å†µ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  2. æ ¹æ®ç¡®è®¤å·å¤„ç†æœªå®Œæˆç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  3. å¤„ç†è®¡æ—¶å™¨é‡ç½®é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> TCPSender<span style="color:#000;font-weight:bold">::</span>receive( <span style="color:#000;font-weight:bold">const</span> TCPReceiverMessage<span style="color:#000;font-weight:bold">&amp;</span> msg )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// åŸºæœ¬çš„é”™è¯¯æƒ…å†µ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  wnd_size_ <span style="color:#000;font-weight:bold">=</span> msg.window_size;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">!</span>msg.ackno.has_value() ) { <span style="color:#998;font-style:italic">// first package without ackno
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> ( wnd_size_ <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span> )
</span></span><span style="display:flex;"><span>      input_.set_error();
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å‘é€æ–¹æœŸå¾…çš„ä¸‹ä¸€å­—èŠ‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> excepting_seqno <span style="color:#000;font-weight:bold">=</span> msg.ackno<span style="color:#000;font-weight:bold">-&gt;</span>unwrap( isn_, next_seqno_ );
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( excepting_seqno <span style="color:#000;font-weight:bold">&gt;</span> next_seqno_ )  <span style="color:#998;font-style:italic">// è¿™è¿˜æ²¡å‘ä½ å°±ç¡®è®¤äº†ï¼Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// æ ‡è®°æ˜¯å¦æœ‰æ–°ç¡®è®¤çš„åºåˆ—å·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#458;font-weight:bold">bool</span> is_acknowledged <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// å¾ªç¯è·å–æœªå®Œæˆç¼“å†²åŒºçš„å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">while</span> ( <span style="color:#000;font-weight:bold">!</span>outstanding_bytes_.empty() ) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;</span> buffered_msg <span style="color:#000;font-weight:bold">=</span> outstanding_bytes_.front();
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// æœŸå¾…çš„ä¸‹ä¸€å­—èŠ‚ä¸è¶³ä»¥å°†è¿™æ¡æ¶ˆæ¯è¦†ç›–ï¼Œåˆ™ä¸å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> ( <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">uint64_t</span> final_seqno <span style="color:#000;font-weight:bold">=</span> acked_seqno_ <span style="color:#000;font-weight:bold">+</span> buffered_msg.sequence_length() <span style="color:#000;font-weight:bold">-</span> buffered_msg.SYN;
</span></span><span style="display:flex;"><span>         excepting_seqno <span style="color:#000;font-weight:bold">&lt;=</span> acked_seqno_ <span style="color:#000;font-weight:bold">||</span> excepting_seqno <span style="color:#000;font-weight:bold">&lt;</span> final_seqno )
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// èµ°åˆ°è¿™è¯´æ˜æœ‰æ–°çš„ç¡®è®¤åˆ°è¾¾
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    is_acknowledged <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>    nbytes_in_flight_ <span style="color:#000;font-weight:bold">-=</span> buffered_msg.sequence_length() <span style="color:#000;font-weight:bold">-</span> syn_flag_;
</span></span><span style="display:flex;"><span>    acked_seqno_ <span style="color:#000;font-weight:bold">+=</span> buffered_msg.sequence_length() <span style="color:#000;font-weight:bold">-</span> syn_flag_;
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// synæ˜¯å¦ç¡®è®¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    syn_flag_ <span style="color:#000;font-weight:bold">=</span> sent_syn_ <span style="color:#000;font-weight:bold">?</span> <span style="color:#900;font-weight:bold">syn_flag_</span> : excepting_seqno <span style="color:#000;font-weight:bold">&lt;=</span> next_seqno_;
</span></span><span style="display:flex;"><span>    outstanding_bytes_.pop();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( is_acknowledged ) {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// æ²¡æœ‰å¾…ç¡®è®¤çš„äº†ï¼Œåªé‡ç½®è®¡æ—¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> ( outstanding_bytes_.empty() )
</span></span><span style="display:flex;"><span>      timer_ <span style="color:#000;font-weight:bold">=</span> RetransmissionTimer( initial_RTO_ms_ );
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>      timer_ <span style="color:#000;font-weight:bold">=</span> move( RetransmissionTimer( initial_RTO_ms_ ).active() );
</span></span><span style="display:flex;"><span>    retransmission_cnt_ <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**tickå‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 1. è¶…æ—¶åˆ™é‡ä¼ 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 2. å¦‚æœwindow sizeä¸º0åˆ™åªé‡ç½®è®¡æ—¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 3. å¦åˆ™RTOå˜ä¸ºä¸¤å€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 4. å¢åŠ é‡ä¼ æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> TCPSender<span style="color:#000;font-weight:bold">::</span>tick( <span style="color:#458;font-weight:bold">uint64_t</span> ms_since_last_tick, <span style="color:#000;font-weight:bold">const</span> TransmitFunction<span style="color:#000;font-weight:bold">&amp;</span> transmit )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> ( timer_.tick( ms_since_last_tick ).is_expired() ) {
</span></span><span style="display:flex;"><span>    transmit( outstanding_bytes_.front() );
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> ( wnd_size_ <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span> )
</span></span><span style="display:flex;"><span>      timer_.reset();
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>      timer_.timeout().reset();
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">++</span>retransmission_cnt_;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›¸ä¿¡ä»¥åçš„æˆ‘çœ‹ä»£ç ä¹Ÿèƒ½çœ‹æ˜ç™½ï¼ŒæŠ½è±¡ç‚¹ç½¢äº†ï¼ŒåŠ æ²¹ã€‚</p>
<p>ä¸¤éƒ¨åˆ†éƒ½å®Œæˆååœ¨minnowç›®å½•ä¸‹æ‰§è¡Œ<code>cmake --build build --target check3</code>ï¼Œä¸‹é¢é™„ä¸Šé€šè¿‡ç»“æœï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Test project /home/sniffstherose/cs144/minnow/build
</span></span><span style="display:flex;"><span>      Start  1: compile with bug-checkers
</span></span><span style="display:flex;"><span> 1/36 Test  <span style="color:#998;font-style:italic">#1: compile with bug-checkers ........   Passed   23.90 sec</span>
</span></span><span style="display:flex;"><span>      Start  3: byte_stream_basics
</span></span><span style="display:flex;"><span> 2/36 Test  <span style="color:#998;font-style:italic">#3: byte_stream_basics ...............   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start  4: byte_stream_capacity
</span></span><span style="display:flex;"><span> 3/36 Test  <span style="color:#998;font-style:italic">#4: byte_stream_capacity .............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  5: byte_stream_one_write
</span></span><span style="display:flex;"><span> 4/36 Test  <span style="color:#998;font-style:italic">#5: byte_stream_one_write ............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  6: byte_stream_two_writes
</span></span><span style="display:flex;"><span> 5/36 Test  <span style="color:#998;font-style:italic">#6: byte_stream_two_writes ...........   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start  7: byte_stream_many_writes
</span></span><span style="display:flex;"><span> 6/36 Test  <span style="color:#998;font-style:italic">#7: byte_stream_many_writes ..........   Passed    0.10 sec</span>
</span></span><span style="display:flex;"><span>      Start  8: byte_stream_stress_test
</span></span><span style="display:flex;"><span> 7/36 Test  <span style="color:#998;font-style:italic">#8: byte_stream_stress_test ..........   Passed    0.18 sec</span>
</span></span><span style="display:flex;"><span>      Start  9: reassembler_single
</span></span><span style="display:flex;"><span> 8/36 Test  <span style="color:#998;font-style:italic">#9: reassembler_single ...............   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 10: reassembler_cap
</span></span><span style="display:flex;"><span> 9/36 Test <span style="color:#998;font-style:italic">#10: reassembler_cap ..................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 11: reassembler_seq
</span></span><span style="display:flex;"><span>10/36 Test <span style="color:#998;font-style:italic">#11: reassembler_seq ..................   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 12: reassembler_dup
</span></span><span style="display:flex;"><span>11/36 Test <span style="color:#998;font-style:italic">#12: reassembler_dup ..................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 13: reassembler_holes
</span></span><span style="display:flex;"><span>12/36 Test <span style="color:#998;font-style:italic">#13: reassembler_holes ................   Passed    0.05 sec</span>
</span></span><span style="display:flex;"><span>      Start 14: reassembler_overlapping
</span></span><span style="display:flex;"><span>13/36 Test <span style="color:#998;font-style:italic">#14: reassembler_overlapping ..........   Passed    0.06 sec</span>
</span></span><span style="display:flex;"><span>      Start 15: reassembler_win
</span></span><span style="display:flex;"><span>14/36 Test <span style="color:#998;font-style:italic">#15: reassembler_win ..................   Passed    0.29 sec</span>
</span></span><span style="display:flex;"><span>      Start 16: wrapping_integers_cmp
</span></span><span style="display:flex;"><span>15/36 Test <span style="color:#998;font-style:italic">#16: wrapping_integers_cmp ............   Passed    0.02 sec</span>
</span></span><span style="display:flex;"><span>      Start 17: wrapping_integers_wrap
</span></span><span style="display:flex;"><span>16/36 Test <span style="color:#998;font-style:italic">#17: wrapping_integers_wrap ...........   Passed    0.01 sec</span>
</span></span><span style="display:flex;"><span>      Start 18: wrapping_integers_unwrap
</span></span><span style="display:flex;"><span>17/36 Test <span style="color:#998;font-style:italic">#18: wrapping_integers_unwrap .........   Passed    0.01 sec</span>
</span></span><span style="display:flex;"><span>      Start 19: wrapping_integers_roundtrip
</span></span><span style="display:flex;"><span>18/36 Test <span style="color:#998;font-style:italic">#19: wrapping_integers_roundtrip ......   Passed    1.43 sec</span>
</span></span><span style="display:flex;"><span>      Start 20: wrapping_integers_extra
</span></span><span style="display:flex;"><span>19/36 Test <span style="color:#998;font-style:italic">#20: wrapping_integers_extra ..........   Passed    0.31 sec</span>
</span></span><span style="display:flex;"><span>      Start 21: recv_connect
</span></span><span style="display:flex;"><span>20/36 Test <span style="color:#998;font-style:italic">#21: recv_connect .....................   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 22: recv_transmit
</span></span><span style="display:flex;"><span>21/36 Test <span style="color:#998;font-style:italic">#22: recv_transmit ....................   Passed    0.30 sec</span>
</span></span><span style="display:flex;"><span>      Start 23: recv_window
</span></span><span style="display:flex;"><span>22/36 Test <span style="color:#998;font-style:italic">#23: recv_window ......................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 24: recv_reorder
</span></span><span style="display:flex;"><span>23/36 Test <span style="color:#998;font-style:italic">#24: recv_reorder .....................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 25: recv_reorder_more
</span></span><span style="display:flex;"><span>24/36 Test <span style="color:#998;font-style:italic">#25: recv_reorder_more ................   Passed    0.81 sec</span>
</span></span><span style="display:flex;"><span>      Start 26: recv_close
</span></span><span style="display:flex;"><span>25/36 Test <span style="color:#998;font-style:italic">#26: recv_close .......................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 27: recv_special
</span></span><span style="display:flex;"><span>26/36 Test <span style="color:#998;font-style:italic">#27: recv_special .....................   Passed    0.09 sec</span>
</span></span><span style="display:flex;"><span>      Start 28: send_connect
</span></span><span style="display:flex;"><span>27/36 Test <span style="color:#998;font-style:italic">#28: send_connect .....................   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 29: send_transmit
</span></span><span style="display:flex;"><span>28/36 Test <span style="color:#998;font-style:italic">#29: send_transmit ....................   Passed    0.44 sec</span>
</span></span><span style="display:flex;"><span>      Start 30: send_retx
</span></span><span style="display:flex;"><span>29/36 Test <span style="color:#998;font-style:italic">#30: send_retx ........................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 31: send_window
</span></span><span style="display:flex;"><span>30/36 Test <span style="color:#998;font-style:italic">#31: send_window ......................   Passed    0.15 sec</span>
</span></span><span style="display:flex;"><span>      Start 32: send_ack
</span></span><span style="display:flex;"><span>31/36 Test <span style="color:#998;font-style:italic">#32: send_ack .........................   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 33: send_close
</span></span><span style="display:flex;"><span>32/36 Test <span style="color:#998;font-style:italic">#33: send_close .......................   Passed    0.08 sec</span>
</span></span><span style="display:flex;"><span>      Start 34: send_extra
</span></span><span style="display:flex;"><span>33/36 Test <span style="color:#998;font-style:italic">#34: send_extra .......................   Passed    0.12 sec</span>
</span></span><span style="display:flex;"><span>      Start 37: compile with optimization
</span></span><span style="display:flex;"><span>34/36 Test <span style="color:#998;font-style:italic">#37: compile with optimization ........   Passed    2.60 sec</span>
</span></span><span style="display:flex;"><span>      Start 38: byte_stream_speed_test
</span></span><span style="display:flex;"><span>             ByteStream throughput: 25.20 Gbit/s
</span></span><span style="display:flex;"><span>35/36 Test <span style="color:#998;font-style:italic">#38: byte_stream_speed_test ...........   Passed    0.11 sec</span>
</span></span><span style="display:flex;"><span>      Start 39: reassembler_speed_test
</span></span><span style="display:flex;"><span>             Reassembler throughput: 15.39 Gbit/s
</span></span><span style="display:flex;"><span>36/36 Test <span style="color:#998;font-style:italic">#39: reassembler_speed_test ...........   Passed    0.14 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#099">0</span> tests failed out of <span style="color:#099">36</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#0086b3">time</span> <span style="color:#000;font-weight:bold">(</span>real<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span>  32.52 sec
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€ågitæäº¤ä¸€ä¸‹ä»£ç ï¼Œå³å¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µğŸ˜ã€‚</p>

    </div>
    
    

    

</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=">
            

        </a>

        <a href="//tryanel.github.io/days/" target="_blank">
            
            æ˜å¤©ï¼Œæˆ‘ä»¬ä¼šæ›´å¥½
            
        </a>
    </div>

    <div class="info">
        <a href="https://github.com/Tryanel/Tryanel.github.io">Copyright</a> Â© 2023 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style=""></div>
    </body>
</html>
