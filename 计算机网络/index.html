<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="计算机网络 - https://Tryanel.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
    <meta name="author" content="马花花 - https://Tryanel.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>计算机网络</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css" />
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" />
    
    <link rel="stylesheet" href="https://Tryanel.github.io/style.min.6bbccf0916939df698171c34d30f896276712c30bd56be0d7fd8023e1b00c3d9.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="cool-before" style="background: url('/imgs/bg/Snipaste_2023-12-09_21-22-04.png') center center/cover no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">
    
    
    <div class="right">
        
        <h1 class="title">计算机网络</h1>
    
        
            
            <div id="toc">📜</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2023-12-13&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2023-12-13&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            46478 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            93 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/%E8%AE%A1%E7%A7%91">计科</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#第一章-概述">第一章 概述</a>
      <ul>
        <li><a href="#1-计算机网络在信息时代的作用">1 计算机网络在信息时代的作用</a></li>
        <li><a href="#2-互联网概述">2 互联网概述</a></li>
        <li><a href="#3-互联网的组成">3 互联网的组成</a></li>
        <li><a href="#4-计算机网络在我国的发展略">4 计算机网络在我国的发展（略）</a></li>
        <li><a href="#5-计算机网络的类别">5 计算机网络的类别</a></li>
        <li><a href="#6-计算机网络的性能">6 计算机网络的性能</a></li>
        <li><a href="#7-计算机网络体系结构">7 计算机网络体系结构</a></li>
      </ul>
    </li>
    <li><a href="#第二章-物理层">第二章 物理层</a>
      <ul>
        <li><a href="#1-物理层的基本概念">1 物理层的基本概念</a></li>
        <li><a href="#2-数据通信的基础知识">2 数据通信的基础知识</a></li>
        <li><a href="#3-物理层下面的传输媒体">3 物理层下面的传输媒体</a></li>
        <li><a href="#4-信道复用技术">4 信道复用技术</a></li>
        <li><a href="#5-数字传输系统">5 数字传输系统</a></li>
        <li><a href="#6-宽带接入技术">6 宽带接入技术</a></li>
      </ul>
    </li>
    <li><a href="#第三章-数据链路层">第三章 数据链路层</a>
      <ul>
        <li><a href="#1-数据链路层概述">1  数据链路层概述</a></li>
        <li><a href="#2-三个基本问题三个基本问题">2  三个基本问题三个基本问题</a></li>
        <li><a href="#3-点对点协议-ppp">3  点对点协议 PPP</a></li>
        <li><a href="#4使用广播信道的数据链路层">4  使用广播信道的数据链路层</a></li>
        <li><a href="#5-扩展的以太网">5  扩展的以太网</a></li>
        <li><a href="#6-高速以太网">6  高速以太网</a></li>
      </ul>
    </li>
    <li><a href="#第四章-网络层">第四章 网络层</a>
      <ul>
        <li><a href="#一网络层的几个重要概念">一、网络层的几个重要概念</a></li>
        <li><a href="#二网际协议-ip">二、网际协议 IP</a></li>
        <li><a href="#三ip-层转发分组的过程"> 三、IP 层转发分组的过程</a></li>
        <li><a href="#四网际控制报文协议-icmp重点">四、网际控制报文协议 ICMP（重点）</a></li>
        <li><a href="#五ipv6">五、IPv6</a></li>
        <li><a href="#六互联网的路由选择协议">六、互联网的路由选择协议</a></li>
        <li><a href="#七ip-多播">七、IP 多播</a></li>
        <li><a href="#八虚拟专用网-vpn-和网络地址转换-nat">八、虚拟专用网 VPN 和网络地址转换 NAT</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="第一章-概述">第一章 概述</h2>
<blockquote>
<p>Ø 计算机网络在信息时代的作用（了解就行）<br>
Ø 互联网概述<br>
Ø 互联网的组成<br>
Ø 计算机网络在我国的发展（了解就行）<br>
Ø 计算机网络的类别<br>
Ø 计算机网络的性能<br>
Ø 计算机网络的体系结构</p>
</blockquote>
<h3 id="1-计算机网络在信息时代的作用">1 计算机网络在信息时代的作用</h3>
<p>21 世纪的一些重要特征就是数字化、网络化和信息化，、它是一个以网络为核心的信息时代。</p>
<p>当然大家熟悉的三大类网络：</p>
<p><img src="./imgs/65716b998652933a4289fec5eb8235e0.png" alt=""></p>
<h3 id="2-互联网概述">2 互联网概述</h3>
<h4 id="21-互联网具有的两个重要的基本特点">2.1 互联网具有的两个重要的基本特点：</h4>
<p>连通性（connectivity）: 使上网用户之间可以非常便捷、非常经济地交换各种信息好像这些用户终端都彼此直接连通一样。</p>
<p>共享性（sharing）: 所谓共享就是指资源共享，即实现信息共享、软件共享、硬件共享。</p>
<h4 id="22-网络互连网-和-互联网因特网">2.2 网络、互连网 和 互联网（因特网）</h4>
<p>计算机网络（简称为网络）：由若干节点（node) 和 连接这些节点的链路（link）组成。</p>
<blockquote>
<p>内容补充：网络中的 节点 可以是计算机、集线器、交换机或路由器等（在后续会逐一介绍）</p>
</blockquote>
<p>这里我给出一张 (图 a) 具有四个节点和三条链路的简单网络（三台计算机通过三条链路连接到一个集线器上）</p>
<p><img src="./imgs/348e757efcd2bbc62545abef7f7913d7.png" alt=""></p>
<p>又如图 b，有多个网络通过一些路由器相互连接起来，构成了一个覆盖范围更大的计算机网络，这样的网络称为：互连网，从图中可以看出互连网也可以被有趣的理解为 “网络中的网络”。因此全球最大的互连网又叫互联网（因特网 Internet）</p>
<blockquote>
<p>内容补充：用一朵云表示一个网络的好处，就是可以先不考虑每一个网络中的细节，而是集中精力讨论与这个互连网有关的问题。</p>
</blockquote>
<p>⚠️ 当我们用一朵云来表示网络时，可能会遇到两种不同的情况：</p>
<p><img src="./imgs/86f99da89c943054f7ed103bb3c912c8.png" alt=""></p>
<p>有时用云表示的网络已经包含了和网络相连的计算机（如图 a），但有时为了讨论问题的方便 (例如，要讨论几个计算机之间如何进行通信)，也可以把有关的计算机画在云的外面 (如图 c)。习惯上，与网络相连的计算机常称为主机 (host)。这样，用云表示的互连网里面就只剩下许多路由器和连接这些路由器的链路了。</p>
<p>总结：网络把许多计算机连接在一起，而互联网则把许多网络通过一些路由器连接在一起。与网络相连的计算机常称为主机（一般智能手机和智能电视机也行）</p>
<h4 id="23-互联网基础结构发展的三个阶段">2.3 互联网基础结构发展的三个阶段</h4>
<blockquote>
<p>internet(互连网) 是一个通用名词，它泛指由多个计算机网络互连而成的计算机网络（这些网络之间的通信协议可以任意选择，不一定非要使用 TCP/IP 协议）<br>
Internet(互联网，或因特网) 则是一个专有名词，它指当前全球最大、最开放、由众多网络相互连接而成的特点互连网，它采用 TCP/IP 协议族作为通信的规则，且其前身是美国的 ARPANET</p>
</blockquote>
<p><img src="./imgs/71d1cc45242845bbe2b074230b8246da.png" alt=""></p>
<blockquote>
<p>第一阶段：1969 – 1990<br>
☆ 1969 年美国国防部创建的 ARPANET 最初只是一个单个的分组交换网，不是一个互连 网。<br>
☆ 1983 年，TCP/IP 协议成为 ARPANET 上的标准协议，使得所有使用 TCP/IP 协议的计 算机都能利用互连网相互通信。<br>
☆ 人们把 1983 年作为互联网的诞生时间。<br>
☆ 1990 年，ARPANET 正式宣布关闭</p>
</blockquote>
<p><img src="./imgs/30ce10e102f359a2363431711e5e8583.png" alt=""></p>
<blockquote>
<p>第三阶段：1993 – 现在<br>
☆ 从 1993 年开始，由美国政府资助的 NSFNET 逐渐被若干个商用的互联网主干网替代， 政府机构不再负责互联网的运营。互联网服务提供者 ISP (InternetService Provider) 成为互联网的运营主体。<br>
☆ 多层次 ISP 结构：<br>
• 主干 ISP、地区 ISP 和本地 ISP；<br>
• 本地 ISP 提供接入到互联网的服务，并收取一定的费用；<br>
• 不同层次的 ISP 覆盖面积大小和拥有的 IP 地址数目不同（互联网上的主机都必须有 IP 地址才能上网）。</p>
</blockquote>
<p>这里我给出具有三层 ISP 结构的互联网概念图：</p>
<p><img src="./imgs/6488e991439f4d89ad9333c4815f9e02.png" alt=""></p>
<blockquote>
<p>补充：互联网交换点 IXP 的主要作用就是允许两个 ISP 网络直接相连并交换分组，而不需要再通过第三个网络来转发分组。<br>
内容提供者 是在互联网上向所有用户提供视频文件的公司，这种公司和前面的 ISP 不同，因为他们并不会向用户提供互联网的转接服务，而是提供视频内容的服务。<br>
互联网服务提供者 ISP ，可以是中国电信、中国移动、中国联通。<br>
所谓的上网 就是指通过某 ISP 获取所需 IP 地址 ，以通过该 ISP 接入互联网。</p>
</blockquote>
<h4 id="24-互联网的标准化工作">2.4 互联网的标准化工作</h4>
<p><img src="./imgs/63730df65ee05d1fb6c6e30b9c6ada3e.png" alt=""></p>
<blockquote>
<p>☆ 互联网的标准化工作对因特网的发展起到了非常重要的作用<br>
☆ 互联网在制订其标准上一个很大特点是 面向公众<br>
• 互联网所有的 RFC 技术文档都可以从互联网上免费下载<br>
• 任何人都可以随时用电子邮件发表对某个文档的意见或建议<br>
☆ 互联网协会（ISOC）是一个国际性组织，它负责对互联网进行全面管理，以及在世界范围内促进其 发展和使用<br>
☆ 制订互联网的正式标准经过以下 三个阶段<br>
• 互联网草案（在这个阶段还不是 RFC 文档）<br>
• 建议标准（从这个阶段开始就成为 RFC 文档）<br>
• 互联网标准 （一个互联网标准可以和多个 RFC 文档关联）</p>
</blockquote>
<h3 id="3-互联网的组成">3 互联网的组成</h3>
<p>从其工作方式上看，可以划分为以下两大块：</p>
<p>【1】边缘部分：由所有连接在互联网上的主机组成。这部分是用户直接使用的，用来进行通信（传输数据、音频或视频）和资源共享。</p>
<p>【2】核心部分：由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的（提供连通性和交换）。</p>
<p><img src="./imgs/67de7ee33be8463fe121d83044507ed5.png" alt=""></p>
<h4 id="31-互联网边缘部分重点知识">3.1 互联网边缘部分重点知识：</h4>
<p>☆ 主机 A 和主机 B 通信，实际上是指：<br>
主机 A 的某个进程和主机 B 上的另一个进程进行通信（&ldquo;进程&rdquo; 就是 &ldquo;运行着的程序&rdquo;）。<br>
☆ 主机之间的两种通信方式：</p>
<p><img src="./imgs/179e4c86a87fe6ec67dbb888fa7445ff.png" alt=""></p>
<ul>
<li>客户 / 服务器方式（C/S 方式） 参考左图</li>
</ul>
<p>客户 (client) 和服务器 (server) 都是指通信中所涉及的两个应用进程。客户 / 服务器方式所描 述的是进程之间服务和被服务的关系。</p>
<p>客户是服务的请求方，服务器是服务的提供方。</p>
<ul>
<li>对等连接方式（P2P 方式） 参考右图</li>
</ul>
<p>主机之间通信时不区分服务请求方和服务提供方，只要都运行了 P2P 软件，就可以进行对 等连接通信。</p>
<p>对等连接方式从本质上看仍然使用客户 / 服务器方式，只是对等连接中的每一台主机既是 客户又是服务器。</p>
<h4 id="32-互联网核心部分重点知识">3.2 互联网核心部分重点知识：</h4>
<p>☆ 核心部分向边缘部分中的大量主机提供连通性，使边缘部分中的任何一台主机都能够与其 他主机通信。</p>
<p>☆ 核心部分的关键设备是路由器 (router)，其任务是进行分组交换 (packet switching) ， 这是核心部分最重要的功能。</p>
<p>☆ 数据交换方式主要有以下三种（讲的比较细，知道的可以直接看后面三者的区别）：</p>
<ul>
<li>电路交换 (CircuitSwitching)</li>
</ul>
<p>电话交换机接通电话线的方式称为电路。</p>
<p>从通信资源的分配角度来看，交换就是按照某种方式动态地分配传输线路的资源。</p>
<p>电路交换：整个报文的比特流连续地从源点直达终点，好像在一个管道中传送。</p>
<p><img src="./imgs/d04733b1fd73b84c77b0d41e391c1af9.png" alt=""></p>
<p>当电话机的数量增多时，就要使用很多彼此连接起来的交换机来完成全网的交换任务。用这样的方法，就构成了覆盖全世界的电信网。</p>
<p>电路交换的过程分为三个阶段：</p>
<p>① 建立连接：建立一条专用的物理通路（占用通信资源）。</p>
<p>② 通话：主叫和被叫双方互相通电话（一直占用通信资源）。</p>
<p>③ 释放连接：释放刚才使用的专用的物理通路（归还通信资源）。</p>
<p>电路交换的一个重要特点就是在通话的全部时间内，通话的两个用户始终占用端到端的通信资源。</p>
<p>缺点：计算机数据具有突发性，这导致使用电路交换传送数据时，通信线路的利用率很低，真正用来传送数据的时间往往不到 10%，甚至不到 1%。已被用户占用的通信线路资源在绝大部分时间里都是空闲的。所以计算机网络不采用电路交换，而是采用分组交换。</p>
<p>⚠️ 这种必须经过 “建立连接（占用通信资源）、通话（一直占用通信资源）、释放连接（归还通信资源）” 三个步骤的交换方式称为电路交换。</p>
<ul>
<li>分组交换 (PacketSwitching)</li>
</ul>
<p>分组交换采用存储转发技术。</p>
<p>把要发送的整块数据称为一个报文 (message)。在发送报文之前，先把较长的报文划分成为一个个更小的等长数据段。在每一个数据段前面，加上一些由必要的控制信息组成的首部 (header) 后，就构成了一个分组 (packet)。分组是在互联网中传送的数据单元。</p>
<p>① 发送端将所有分组连续地发送出去，直至发送完毕。</p>
<p><img src="./imgs/e056313d5fb65d6fa543ee0f1dc22bac.jpeg" alt=""></p>
<p>② 假定分组在传输过程中没有出现差错，在转发时也没有被丢弃。接收端收到分组后剥去首部，还原成原来的报文。</p>
<p>路由器对分组的处理——&gt;</p>
<p>通过多个路由器的 “接力” 传输，分组最终会到达目的主机。</p>
<p><img src="./imgs/3029972c45d08eab1d04e72969537cd4.png" alt=""></p>
<p>1、路由器采用存储转发技术先暂时存储收到的分组，然后根据首部中包含的目的地址等重要 控制信息查找转发表进行转发。</p>
<p>2、各路由器之间定期交换各自掌握的路由信息，以创建和动态维护转发表。</p>
<p>3、每一个分组在互联网中独立选择传输路径，位于网络核心部分的路由器负责转发分组，即 进行分组交换。</p>
<p>分组交换的注意事项（以 H1 向 H5 发送分组为例）——&gt;</p>
<p><img src="./imgs/7fbdd8a47ae0d89e6429f7dcac4ff961.png" alt=""></p>
<p>每个分组独立选择传输路径，由于链路状态不断变化，分组路径也会动态变化！</p>
<p>注意 1：H1 先将分组连续地发往与它直接相连的路由器 A，而不是等第一个分组到达 H5 后再发送下一个分组；</p>
<p>注意 2：每个分组独立选择传输路径；</p>
<p>注意 3：单个分组经过多个路由器 “接力”，最终到达目的主机 H5；</p>
<p>注意 4：单个分组对通信资源是逐段占用的，只有当分组在链路上发送时才占用该链路，发送完毕即释放该链路。</p>
<p>注意 5：所有分组到达目的主机 H5 后，即可还原出原来的报文。</p>
<p>分组交换的优、缺点 ——&gt;</p>
<p><img src="./imgs/527df76129bc804d9cee2289f626b7fd.png" alt=""></p>
<ul>
<li>报文交换 (MessageSwitching)</li>
</ul>
<p>既然已经谈论了分组交换，那报文交换就看起来非常简单了（一个分组，一个整体）</p>
<p>1、将整块数据作为一个报文，采用存储转发模式的数据交换方式叫做报文交换。</p>
<p>2、报文交换的时延较长，现在已经很少使用这种交换方式了。</p>
<p>☆ 电路交换、报文交换和分组交换的主要区别：</p>
<p><img src="./imgs/a4134f8fd5cc77e4dbcdf884a557ca14.png" alt=""></p>
<p>1、若要连续传送大量的数据，且其传送时间远大于连接建立时间，则电路交换的传输速率较快。</p>
<p>2、报文交换和分组交换不需要预先分配传输带宽，在传送突发数据时可提高整个网络的信道利用率。</p>
<p>3、由于一个分组的长度往往远小于整个报文的长度，因此分组交换比报文交换的时延小，同时也具有更好的灵活性。</p>
<h3 id="4-计算机网络在我国的发展略">4 计算机网络在我国的发展（略）</h3>
<h3 id="5-计算机网络的类别">5 计算机网络的类别</h3>
<p>根据不同的分类标准，计算机网络可以分为不同的类别：</p>
<h4 id="51-按照网络的作用范围进行分类">5.1 按照网络的作用范围进行分类</h4>
<p>广域网 WAN (WideArea Network) ：</p>
<p>通常为几十到几千公里，是互联网的核心部分。</p>
<p>城域网 MAN (MetropolitanArea Network) ：</p>
<p>作用范围一般是一个城市，作用距离约为 5~50 公里。</p>
<p>局域网 LAN (LocalArea Network) ：</p>
<p>局限在较小的范围（如 1 公里左右）。通常采用高速通信线路。</p>
<p>个人区域网 PAN (PersonalArea Network) ：</p>
<p>范围很小，大约在 10 米左右。有时也称为无线个人区域网 WPAN(Wireless PAN)。</p>
<h4 id="52-按照网络的使用者进行分类">5.2 按照网络的使用者进行分类</h4>
<p>公用网 (publicnetwork) ：</p>
<p>按电信公司的规定交纳费用的人都可以使用的网络。</p>
<p>专用网 (privatenetwork) ：</p>
<p>某部门为满足本单位的特殊业务需要而建造的网络，不向本单位以外的个人提供服务。</p>
<h4 id="53-按拓扑结构分类">5.3 按拓扑结构分类</h4>
<p><img src="./imgs/8cf94c0efd2338aa878df26eb279cf0b.png" alt=""></p>
<p>• 总线型</p>
<p>用单根传输线把计算机连接起来。</p>
<p>优点：建网容易，增减节点方便，节省线路。</p>
<p>缺点：重负载时通信效率不高，任意一处出现故障后全网瘫痪。</p>
<p>• 环型</p>
<p>将所有计算机网络结构连接成一个环，环可以是单环或者双环，环中信号是单向传输的。</p>
<p>优点，缺点和总线型差不太多。</p>
<p>• 星形</p>
<p>将每个计算机都以单独的线路与中央设备相连。中央设备现在一般是交换机。</p>
<p>优点：便于网络的集中控制和管理。</p>
<p>缺点：成本高，中央设备对故障敏感。</p>
<p>• 树形</p>
<p>树形网络也叫多星级型网络。树形网络是由多个层次的<a href="https://baike.baidu.com/item/%E6%98%9F%E5%9E%8B%E7%BB%93%E6%9E%84/8606231?fromModule=lemma_inlink">星型结构</a>纵向连接而成，树的每个节点都是都是计算机或转接设备。一般来说，越靠近树的根部，节点设备的性能就越好。与星型网络相比，树形网络总长度短，成本较低，节点易于扩充，但是树形网络复杂，与节点相连的链路由故障时，对整个网络的影响较大</p>
<p>优点：易于扩展，故障隔离较容易</p>
<p>缺点：各个节点对根的依赖性太大。</p>
<p>• 网状</p>
<p>每个节点至少由两条路径与其它节点相连接，多用在广域网中。</p>
<p>这里就不详细阐述了，以后会详细介绍。</p>
<p>以上结构都可以任意组合成复杂有效的复合型结构。</p>
<h3 id="6-计算机网络的性能">6 计算机网络的性能</h3>
<h4 id="61-速率">6.1 速率</h4>
<p>速率指的是数据的传送速率，也称为数据率 (datarate) 或比特率 (bitrate)，是计算机网络中最重要的一个性能指标。当提到网络的速率时，往往指的是额定速率或标称速率。</p>
<p>速率的单位是 bit/s（或 b/s、bps），当数据率较高时，就在前面加上 k、M、G 等表示数量的字母。</p>
<p>把速率和数据量区分一下</p>
<p><img src="./imgs/4fdc3ff38d43822a0353a660b2fd3e9b.png" alt=""></p>
<h4 id="62-带宽">6.2 带宽</h4>
<p>带宽有以下两种不同的含义：</p>
<p>1、带宽本来是指某个信号具有的频带宽度，即该信号所占据的频率范围。例如模拟电话信号 的频率范围是 300 Hz 到 3.4 kHz，标准带宽是 3.1 kHz。</p>
<p>• 单位是赫（或千赫、兆赫、吉赫等）。</p>
<p>• 某信道允许通过的信号频带范围称为该信道的带宽（或通频带）。</p>
<p>2、在计算机网络中，带宽用来表示网络中某通道传送数据的能力，因此网络带宽表示在单位时间内网络中的某信道所能通过的 “最高数据库”。</p>
<p>• 在本专栏中，提到 “带宽” 时，主要指这个意思。</p>
<p>• 这种意义的带宽单位就是数据率的单位 bit/s，是 “比特每秒”。</p>
<blockquote>
<p>补充：1、在 “带宽” 的上述两种表述中，前者为 “频域” 称谓，而后者为 “时域” 称谓。<br>
2、上述两种表述 本质上是相同的。<br>
3、一条通信链路的 “带宽” 越宽，其所能传输的 “最高数据率” 也 越高。</p>
</blockquote>
<h4 id="63-吞吐量">6.3 吞吐量</h4>
<p>吞吐量表示在单位时间内通过某个网络（或信道、接口）的实际数据量。</p>
<p>吞吐量受网络的带宽或网络的额定速率的限制。</p>
<h4 id="64-时延">6.4 时延</h4>
<p>指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间。</p>
<p>网络中的时延由以下 4 个部分组成：</p>
<p>（1）发送时延</p>
<p>发送时延是主机或路由器发送数据所需要的时间，也就是从发送数据的第一个比特算起，到发送完该数据的最后一个比特为止所需的时间。</p>
<p><img src="./imgs/f17eb8b5191ce9555ae4e5f8fda5e88f.png" alt=""></p>
<p>（2）传播时延</p>
<p>传播时延是电磁波在信道中传播一定的距离需要花费的时间。电磁波在自由空间的传播速率是 3.0ⅹ10^5km/s，在铜线电缆中的传播速率约为 2.3ⅹ10^5km/s，在光纤中的传播速率约为 2.0ⅹ10^5km/s</p>
<p><img src="./imgs/aa79d44674c1c0ce11a28261131dae4a.png" alt=""></p>
<p>⚠️ 发送时延和传播时延有本质上的不同，发送时延发生在机器内部的发送器上（一般是发生在网络适配器上）与传输信道的长度（信号传送的距离）没有任何关系。</p>
<p>而传播时延发生在机器外部的传输信道媒体上，与信号的发送速率无关，信号传送的距离越远，传播时延就越大。</p>
<p>（3）处理时延</p>
<p>主机或路由器在收到分组时，为处理分组（例如分析首部、提取数据、差错检验或查找转发表等）所花费的时间。</p>
<p>（4）排队时延</p>
<p>分组在进入路由器后要先在输入队列中排队等待处理，在确定了转发接口后还要在输出队列中排队等待转发，这就产生了排队时延。</p>
<p>总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延</p>
<p>这里给出几种时延产生的地方，方便理解它们。</p>
<p><img src="./imgs/cd579a395c575580a5d4a98a70ad2832.png" alt=""></p>
<blockquote>
<p>补充：1、在总时延中，究竟哪一种时延占主导地位，必须具体分析。<br>
例如，不是发送速率越高，其传送的总时延就越小，要综合考虑。<br>
2、容易产生的错误概念 ：<br>
“在高速链路（或高带宽链路）上，比特的传播速度会更快些”。<br>
对于高速网络链路，我们提高的仅仅是数据的发送速率，而不是比特在链路上的传播速率。<br>
3、提高数据的发送速率只是减小了数据的发送时延</p>
</blockquote>
<h4 id="65-时延带宽积">6.5 时延带宽积</h4>
<p>把以上讨论的网络性能的两个度量，即传播时延和带宽相乘，就得到了另一个很有用的度量：传播时延带宽积。</p>
<p><img src="./imgs/594dd111a21138c9d4902a074ee343aa.png" alt=""></p>
<p>这里从这张图可以看出：</p>
<p>1、链路的时延带宽积表示这样的链路可以容纳多少个比特，因此又称为以比特为单位的链路长度。</p>
<p>2、管道中的比特数表示从发送端发出但尚未到达接收端的比特数。</p>
<h4 id="66-往返时间-rtt">6.6 往返时间 RTT</h4>
<p>往返时间 RTT(Round-TripTime) 表示从发送方发送完数据到发送方收到接收方的确认所经过的时间。</p>
<p>闲谈：这种重要的性能指标出现，是因为在许多情况下，互联网上的信息不仅仅单向传输而是双向交互的。因此我们有时很需要知道双向交互一次的时间。</p>
<p>举例分析：结点 A 要将一个 100MB 数据以 100Mbit/s 的速率发送给结点 B，B 正确收完该数据后，就立即向 A 发送确认。假定 A 只有在收到 B 的确认信息后，才能继续向 B 发送数据，且确认信息很短，可忽略 B 发送确认的发送时延。如果 RTT= 2s，计算 A 向 B 发送数据的有效数据率 ？。</p>
<p><img src="./imgs/94cdce1fa0149a89a9d6c50d15350cda.png" alt=""></p>
<p>可以发现比原来的数据率 100Mbit/s 小了不少，因此有时也把 RTT 称为往返时延（强调发送方至少要经过这样多时间，才能知道自己所发送的数据是否被对方接收了）</p>
<h4 id="67-利用率">6.7 利用率</h4>
<p>利用率有信道利用率和网络利用率两种。</p>
<p>信道利用率：</p>
<p>• 某信道有百分之几的时间是被利用的（即有数据通过）。</p>
<p>• 完全空闲的信道的利用率是零。</p>
<p>网络利用率：</p>
<p>• 全网络的信道利用率的加权平均值。</p>
<p>⚠️ 信道利用率并非越高越好。根据排队论，当某信道的利用率增大时，该信道的时延会迅速增加。</p>
<p><img src="./imgs/9ae56af3a06e852c3b134ddd55fe03b1.png" alt=""></p>
<p>从图中可以看出：</p>
<ul>
<li>
<p>当网络利用率达到 50% 时，时延就要加倍。</p>
</li>
<li>
<p>当网络利用率超过 50% 时，时延就急剧增加。</p>
</li>
<li>
<p>当网络利用率接近 100% 时，时延就趋于无穷大。</p>
</li>
</ul>
<p>总结：信道利用率或网络利用率过高就会产生非常大的时延，因此一般要控制信道利用率不超过 50%，如果超过了，就要准备扩容，增大线路的宽度。</p>
<p>丢包率即分组丢失率，是指在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的比率。</p>
<p>由于这个性能不需要掌握，就不多阐述了，感兴趣的朋友可以查资料了解~</p>
<p>当然计算机网络还有非性能特征：1、费用 2、质量 3、标准化 4、可靠性 5、可扩展性和升级性 6、易于管理和维护等</p>
<h3 id="7-计算机网络体系结构">7 计算机网络体系结构</h3>
<p>计算机网络的各层及其协议的集合，就是网络的体系结构 (architecture) 。</p>
<blockquote>
<p>在网络中交换数据，必须遵守相关的网络协议。<br>
网络协议 (network protocol)，简称为协议，是为进行网络中的数据交换而建立的规则、标准或约定。<br>
网络协议主要由以下三个要素组成：<br>
语法：数据与控制信息的结构或格式；<br>
语义：需要发出何种控制信息，完成何种动作，做出何种响应；<br>
同步：事件实现顺序的详细说明</p>
</blockquote>
<p><img src="./imgs/5b655794b86152c1cf5f5419998a837d.png" alt=""></p>
<p>这里的五层协议体系结构是原理上的五层协议，这种结构的出现只是为了方便我们更为详细和方便的学习。</p>
<p>接下来对于各层的简介，也主要是这个五层协议的体系结构。</p>
<h4 id="71-五层协议的体系结构">7.1 五层协议的体系结构</h4>
<p>① 应用层</p>
<p>任务：通过应用进程的交互来完成特定网络应用。（这里的” 进程 “就是指主机中正在运行 的程序）</p>
<p>交互的数据单元：报文。</p>
<p>常用协议：域名系统 DNS ， 支持万维网应用的 HTTP 协议 、 支持电子邮件的 SMTP 协议。</p>
<p>⚠️ 应用层协议定义的是应用进程间通信和交互的规则，对于不同的网络应用需要有不同的应用层协议。</p>
<p>② 运输层</p>
<p>任务：为两台主机中进程之间的通信提供通用的数据传输服务。（这里的” 通用 “是指并不 针对某个特定网络应用，而是多种应用可以使用同一个运输层服务）</p>
<p>功能：复用（多个应用层可同时使用下面运输层的服务）</p>
<p>分用（运输层把收到的信息分别交付上面的应用层中的相应过程）</p>
<p>主要协议：传输控制协议 TCP（提供面向连接的、可靠的数据传输服务，其数据传输的单元 是报文段）。</p>
<p>用户数据报协议 UDP（提供无连接的尽最大努力的数据传输服务，但不保证数 据传输的可靠性，其数据传输的单元是用户数据报）</p>
<p>③ 网络层</p>
<p>任务：负责为分组交换网上的不同主机提供通信服务。</p>
<p>数据单元：”分组 “或” 数据报“。</p>
<p>常用协议：网际协议 IP 和许多种路由选择协议。</p>
<p>④ 数据链路层</p>
<p>任务：在两个相邻节点之间传送数据帧（将网络层下来的 IP 数据报组装成帧，每一帧包括数 据和必要的控制信息）。</p>
<p>常用协议：PPP、CSMA/CD 等。</p>
<p>如发现有差错，就简单地丢弃出错的帧。如果要纠错就要采用可靠的传输协议，这样会使数据链路层的协议更复杂。</p>
<p>⑤ 物理层</p>
<p>任务：实现比特（0 或 1）的传输。</p>
<p>数据单元：比特。</p>
<p>⚠️</p>
<ul>
<li>
<p>确定表示数据的电压（代表 1 和 0）以及连接电缆的插头应当有多少根引脚，各引脚应如何连接等。</p>
</li>
<li>
<p>传递信息的物理媒体，如双绞线、同轴电缆、光缆、无线信道等，并不在物理层协议之内，而是在物理层协议的下面。</p>
</li>
</ul>
<p>这里给出两台主机通过一台路由器进行的数据在各层之间的传递过程的图示：</p>
<p><img src="./imgs/138e2f5435da5d5bd60fed90c050eb65.png" alt=""></p>
<p>上述过程一定要有一个清楚的认知（H 和 T 都是每层所加上的控制信息）。</p>
<p>就好比：有一封信从最高层向下传，每经过一层就包上一个新的的信封，写上必要的地址信息。包有多个信封的信件传送到目的站后，从第一层起，每层拆开一个信封后就把信封中的信交给它的上一层，传到最高层后，取出发信人所发的信，交给收信人。</p>
<h4 id="72-协议实体服务和服务访问点">7.2 协议、实体、服务和服务访问点</h4>
<p>实体 ：表示任何可发送或接收信息的硬件或软件进程。</p>
<p>对等实体：通信双方相同层次中的实体。</p>
<p>协议：控制两个对等实体进行通信的规则的集合。</p>
<ul>
<li>
<p>在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。</p>
</li>
<li>
<p>要实现本层协议，还需要使用下层所提供的服务。</p>
</li>
</ul>
<p>协议和服务的区别：</p>
<p><img src="./imgs/0848fa29de757b751ad00ce0af4fe09c.png" alt=""></p>
<p>服务原语：上层使用下层所提供的服务必须通过与下层交换一些命令。</p>
<p>服务访问点 SAP：</p>
<ul>
<li>
<p>在同一系统中相邻两层的实体进行交互（即交换信息）的地方，通常称为服务访问点 SAP (ServiceAccess Point)。</p>
</li>
<li>
<p>SAP 是一个抽象的概念，它实际上就是一个逻辑接口。</p>
</li>
</ul>
<p><img src="./imgs/86b3277e706b9364d74a06ce3c863af3.png" alt=""></p>
<h4 id="73-tcpip-体系结构">7.3 TCP/IP 体系结构</h4>
<p>TCP/IP 的四层协议体系结构与其他体系结构各层对比。</p>
<p><img src="./imgs/63d53539ff59f935cc2cb4d460243d75.png" alt=""></p>
<p>TCP/IP 最下面的网络接口层并没有属于 TCP/IP 体系的具体协议，目的是为了允许任何形式的网络接口使用 TCP/IP 协议。</p>
<p>TCP/IP 四层协议的主机间的信息交换和五层协议异曲同工。</p>
<p><img src="./imgs/af95424ff4c710d5d7364f9ccb2090ba.png" alt=""></p>
<p>值得注意的是随着技术的发展，TCP/IP 体系结构并不严格遵循分层的概念，某些应用程序可以直接使用 IP 层，甚至直接使用最下面的网络接口层。</p>
<p><img src="./imgs/df04bd0afc15c0bff2e9253443e753df.png" alt=""></p>
<p>当然还有另外一种方法用来表示 TCP/IP 协议族，他的特点是上下两头大而中间小：应用层和网络接口层都有多种协议，而中间的 IP 层很小，上层的各种协议都向下汇集到 IP 协议中</p>
<p><img src="./imgs/e090ba763e9e540db34aaf6e8e16cf49.png" alt=""></p>
<blockquote>
<p>补充：<br>
☆ IP 层可以支持多种运输层协议，这里只是画出来最主要的两种。<br>
☆ 从图中我们可以看出 IP 协议在互联网中的核心作用。<br>
☆ 此图的设计理念反映了网络的核心部分越简单越好，一切复杂的部分让网络的边缘部分去实现。</p>
</blockquote>
<h2 id="第二章-物理层">第二章 物理层</h2>
<blockquote>
<p>本章复习内容： ₍ᐢ..ᐢ₎♡<br>
Ø 物理层的基本概念<br>
Ø 数据通信的基础知识<br>
Ø 物理层下面的传输媒体<br>
Ø 信道复用技术（难点）<br>
Ø 数字传输系统<br>
Ø 宽带接入技术</p>
</blockquote>
<p><img src="./imgs/6ce5529c63f041a9f5fe386852a6dfb1.png" alt=""></p>
<h3 id="1-物理层的基本概念">1 物理层的基本概念</h3>
<p>物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。</p>
<p>物理层的作用是：尽可能屏蔽掉不同传输媒体和通信手段的差异，有助于数据链路层。</p>
<p>物理层的主要任务为确定与传输媒体的接口有关的一些特性，即：</p>
<ul>
<li>机械特性：指明接口的形状和尺寸、连接线数目和排列、固定装置等。</li>
</ul>
<p>e.g : 全球通用的水晶头 。</p>
<ul>
<li>电气特性：指明在接口的各条连接线上出现的电压的范围。</li>
</ul>
<p>e.g : 如 5V ~ 10V 的电压范围 。</p>
<ul>
<li>功能特性：指明某条连接线上出现的某电压的意义。</li>
</ul>
<p>e.g : 如高低电平含义，高电平代表 1，低电平代表 0 。</p>
<ul>
<li>过程特性：指明对于不同功能的各种可能事件的出现顺序。（比如在发送数据比特流之前是否要进行时钟同步）</li>
</ul>
<p>e.g : 不同功能的的事件顺序描述，如信号 1100 代表同步等 。</p>
<h3 id="2-数据通信的基础知识">2 数据通信的基础知识</h3>
<p>数据通信的常用术语：</p>
<p>通信的目的：传送消息 (message)。话音、文字、图像、视频等都是消息。</p>
<p>数据：运送消息的实体，比如 11001001001100111101011011001110……</p>
<p><img src="./imgs/4d679ae148c5411378a81e4343cc477b.png" alt=""></p>
<h4 id="21-数据通信系统的模型">2.1 数据通信系统的模型</h4>
<p>一个数据通信系统可分为三大部分：源系统（或发送端、发送方）、传输系统（或传输网络）和 目的系统（或接收端、接收方）。</p>
<p><img src="./imgs/0986b77027372503d23c4f2f05941ebc.png" alt=""></p>
<p>解释：</p>
<p>源点：源点设备产生要传输的数据。</p>
<p>发送器：通常源点产生的数字比特流要通过发送器编码后才能够在传输系统中进行传输。而典型的发送器就是调制器。</p>
<p>接收器：接收传输系统传送过来的信号，并把它转换为能够被目的设备处理的信号。而典型的接收器就是解调器。</p>
<p>终点：终点设备从接收器获取传送来的数字比特流，并将信息输出。</p>
<h4 id="22-信道的几个基本概念">2.2 信道的几个基本概念</h4>
<p>信道表示某一个方向上的信息通道（或某一个方向传送信息的媒体）。一条通信线路往往包含两条信道（发送信道和接收信道）。</p>
<p>信息交互的方式：</p>
<ul>
<li>
<p>单向通信（单工通信）：只有一个方向的通信而没有反方向的交互。一条线路，一个信道</p>
</li>
<li>
<p>双向交替通信（半双工通信）：通信的双方都可以发送信息，但不能双方同时发送（当然也就不能同时接收）。一条线路，两个信道</p>
</li>
<li>
<p>双向同时通信（全双工通信）：通信的双方可以同时发送和接收信息。两条线路，两个信道（传输效率最高）</p>
</li>
</ul>
<blockquote>
<p>⚠️ ⚠️ ⚠️<br>
1、 信道和通信线路并不是同一个概念。<br>
2、 收音机的无线电广播是单工通信，对讲机工作时使用半双工通信，电话、计算机通信都 是全双工通信。<br>
3、 半双工通信是指通信双方只使用一条通信线路，数据可以沿两个方向传送（所以是两个信道）但同一时刻只能有一个方向的通信。若要改变传输方向，需由开关进行切换。半双工方式要求收发两端都有发送装置和接收装置。由于这种方式要频繁切换方向，故效率低，但可以节约传输线路。</p>
</blockquote>
<p>从源点发出的信号（像计算机输出的代表各种文件或图像文件的数据信号）常称为基带信号（即基本频带信号）。基带信号往往包含较多的低频成分和直流成分，必须进行调制（modulation）才能在许多信道中传输。</p>
<p>调制分为两大类。</p>
<ul>
<li>
<p>一类是基带调制，即仅对基带信号的波形进行变换，把数字信号转换为另一种形式的数字信号。这种过程又称为编码 (coding)，变换后的信号仍是基带信号。</p>
</li>
<li>
<p>另一类是带通调制，即使用载波 (carrier) 进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号。经过载波调制后的信号称为带通信号（即仅在一段频率范围内能够通过信道）。</p>
</li>
</ul>
<h4 id="23-数字信号常用的编码方式">2.3 数字信号常用的编码方式</h4>
<p><img src="./imgs/12df733caa043e05c0197d621c5438d5.png" alt=""></p>
<p>不归零制：正电平代表 1，负电平代表 0。</p>
<p>归零制：正脉冲代表 1，负脉冲代表 0。</p>
<p>曼彻斯特编码：位周期中心的向上跳变代表 0，位周期中心的向下跳变代表 1。</p>
<p>差分曼彻斯特编码：在每一位的中心处始终都有跳变。位开始边界有跳变代表 0，而位开始边界没有跳变代表 1。</p>
<blockquote>
<p>从信号频率中可以看出：<br>
§ 曼彻斯特编码和差分曼彻斯特编码产生的信号频率比不归零制高。<br>
从 自同步能力中可以看出：<br>
§ 不归零制不能从信号波形本身中提取信号时钟频率（即没有自同步能力）。<br>
§ 归零制、曼彻斯特编码和差分曼彻斯特编码具有自同步能力。</p>
</blockquote>
<h4 id="24-基本的带通调制方式">2.4 基本的带通调制方式</h4>
<p><img src="./imgs/9f45a23a7390bd099e542cce9fb86875.png" alt=""></p>
<p>§ 调幅 (AM)：载波的振幅随基带数字信号而变化。</p>
<p>§ 调频 (FM)：载波的频率随基带数字信号而变化。</p>
<p>§ 调相 (PM)：载波的初始相位随基带数字信号而变化。</p>
<p>一般为了达到更高的信息传输速率，必须采用技术上更为复杂的多元制的振幅相位混合调制方法。例如：正交振幅调制 QAM 。</p>
<h4 id="25-信道的极限容量">2.5 信道的极限容量</h4>
<p>任何实际的信道都不是理想的，都不可能以任意高的速率进行传送。</p>
<p>码元传输的速率越高、信号传输的距离越远、噪声干扰越大或传输媒体质量越差，在接收端的波形的失真就越严重。</p>
<p><img src="./imgs/c14090661eb6e1dae79c5a1c1bdecb12.png" alt=""></p>
<p>码间串扰：具体的信道所能通过的频率范围总是有限的。信号中的许多高频分量往往不能通过信道。如果信号中的高频分量在传输时受到衰减，那么在接收端收到的波形前沿和后沿就变的不那么陡峭了，每一个码元所占的时间界限也不再是很明确的，而是前后都拖了 “尾巴”。这样，在接收端收到的信号波形就失去了码元之间的清晰界限。这种现象叫做码间串扰。</p>
<p>为了避免码间串扰，1924 年，奈奎斯特 (Nyquist) 就推导出了著名的奈氏准则。他给出了在假定的理想条件下，为了避免码间串扰，码元的传输速率的上限值。</p>
<p>奈氏准则：在带宽为 W (Hz) 的低通信道中，若不考虑噪声影响，则码元传输的最高速率是 2W Baud(码元 / 秒)。传输速率超过此上限，就会出现严重的码间串扰的问题，使接收端对码元的判决（即识别）成为不可能。</p>
<blockquote>
<p>⚠️ ⚠️ ⚠️<br>
1、这里的单位是 码元 / 秒 ，即 Baud(波特)。因为波特（Baud）和 比特（bit）是两个不同的概念。<br>
2 、 可通过编码的方法让每一个码元携带更多比特的信息量，但这样做会增加码元的种数， 在实际有噪声干扰的信道中，大大增加了解码的难度。</p>
</blockquote>
<p>信噪比 ：</p>
<ul>
<li>
<p>实际的信道都是有噪声的，但噪声的影响是相对的。如果信号相对较强，则噪声的影响就相对较小。</p>
</li>
<li>
<p>信噪比就是信号的平均功率和噪声的平均功率之比，常记为 S/N。若以分贝 (dB) 为单位，则信噪比 (dB)= 10 log10(S/N)(dB) 。例如当 S/N =1000 时，信噪比为 30dB 。</p>
</li>
</ul>
<p>香农公式 ：</p>
<p>在带宽受限且有高斯噪声干扰的信道中，信道的极限信息传输速率 C = W·log2(1+S/N)(bit/s)</p>
<p>• W 为信道的带宽，单位是 Hz；</p>
<p>• S 为信道内所传信号的平均功率；</p>
<p>• N 为信道内部的高斯噪声功率。</p>
<p>• 信道的带宽或信道中的信噪比越大，则信道的极限信息传输速率就越高。</p>
<p>• 注意单位是 bit/s , 不是码元 / 秒。</p>
<p>奈氏准则和香农公式的意义 ：</p>
<blockquote>
<p>奈氏准则：适用于理想低通信道；激励工程人员不断探索更加先进的编码技术，使每一个码元携带更多比特的信息量；<br>
香农公式：适用于真实信道；告诫工程人员，在实际有噪声的信道上，不论采用多么复杂的编码技术，都不可能突破信息传输速率的上限。</p>
</blockquote>
<p>随堂练习：若某低通信道在无噪声情况下的极限数据传输速率不小于其在信噪比为 30 dB 条件下的极限数据传输速率，则信号状态数至少是多少个 ？</p>
<p>解：设低通信道的带宽为 W(Hz)，由奈氏准则可知，码元传输速率的上限是 2W(码元 / s)。假设一码元携带的信息量为 n(bit)，则极限数据传输速率为 2nW(bit/s)。</p>
<p>由 30=10log10(S/N) 可得 S/N=1000，由香农公式可知极限信息传输速率为 W·log21001(bit/s)。令 2nW ≥ W·log21001，可得 2n ≥ log21001，并注意到 n 为整数，于是 n 的最小值为 5，信号状态数为<img src="./imgs/e87c11f162e08bdbc41eb748a4da65f3.png" alt=""> =32 。</p>
<h3 id="3-物理层下面的传输媒体">3 物理层下面的传输媒体</h3>
<p>传输媒体可分为两大类：</p>
<ul>
<li>导引型传输媒体：电磁波被导引沿着固体媒体（铜线或光纤）传播。</li>
</ul>
<p>1、双绞线</p>
<p><img src="./imgs/87f67558b4caedc84a68a3fe05d4413b.png" alt=""></p>
<p>2、同轴电缆</p>
<p><img src="./imgs/f1e941639799c03fb37822bd71a00409.png" alt=""></p>
<p>3、光缆</p>
<p><img src="./imgs/fe0685e892adc3195dd6fdc666668965.png" alt=""></p>
<ul>
<li>非导引型传输媒体：指自由空间。在非导引型传输媒体中电磁波的传输常称为无线传输。</li>
</ul>
<p><img src="./imgs/b780e3bf42ff441ba1c7cf2b09995e13.png" alt=""></p>
<h3 id="4-信道复用技术">4 信道复用技术</h3>
<p>复用 (multiplexing) 是指多个用户使用一个共享信道进行通信。</p>
<p><img src="./imgs/546a83b1cf41871f3f1e370b202865f9.png" alt=""></p>
<h4 id="频分复用-fdmfrequency-division-multiplexing">频分复用 FDM(Frequency Division Multiplexing)</h4>
<p>概念：将整个带宽分为多份。用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。</p>
<p>所有用户在同样的时间占用不同的带宽（即频带）资源。（这里的带宽是频率带宽不是数据的发送速率）</p>
<p>通过频分复用共享信道也叫作频分多址 FDMA(FrequencyDivision MultipleAccess)。</p>
<p><img src="./imgs/3f460fee0d914761adff0d8a4ad4fe27.png" alt=""></p>
<h4 id="时分复用-tdmtime-division-multiplexing">时分复用 TDM(Time Division Multiplexing)</h4>
<p>概念：将时间划分为一段段等长的时分复用帧（TDM 帧）。每一个用户在每一个 TDM 帧中占用固定序号的时隙。（这里的帧和数据链路层的帧是完全不同的概念）</p>
<p>每一个用户所占用的时隙周期性地出现，其周期就是 TDM 帧的长度。所有用户是在不同的时间占用同样的频带宽度。</p>
<p>通过时分复用共享信道也叫作时分多址 TDMA(TimeDivision Multiple Access)。</p>
<p><img src="./imgs/45bc80672ee3f0fb1c05c247b30c18d0.png" alt=""></p>
<p>从下面图解不难看出时分复用可能会造成线路资源的浪费。</p>
<p>原因：使用时分复用系统传送计算机数据时，由于计算机数据的突发性质，用户对分配到的子信道的利用率一般是不高的。</p>
<p><img src="./imgs/3869c00c796671934e3a4157fa603579.png" alt=""></p>
<p>为了能提高线路资源的利用率，就对时分复用进行了改进。</p>
<h4 id="统计时分复用-stdmstatistictdm">统计时分复用 STDM(StatisticTDM)</h4>
<ul>
<li>
<p>STDM 帧并不是固定分配时隙的，而是按需动态的分配时隙，因此统计时分复用可以提高线路的利用率</p>
</li>
<li>
<p>每一个 STDM 帧中的时隙数小于用户数。</p>
</li>
<li>
<p>当一个帧的数据放满了，就发送出去。</p>
</li>
<li>
<p>一个用户所占用的时隙并不是周期性的出现。</p>
</li>
</ul>
<p><img src="./imgs/7d5c655000e2bdfd388c79907edbb3e0.png" alt=""></p>
<h4 id="波分复用-wdmwavelengthdivision-multiplexing">波分复用 WDM(WavelengthDivision Multiplexing)</h4>
<p>波分复用就是光的频分复用。使用一根光纤来同时传输多个载波信号。</p>
<p><img src="./imgs/5ef10577af07d4547406246ccbf9cbdf.png" alt=""></p>
<h4 id="码分复用-cdmcodedivision-multiplexing">码分复用 CDM(CodeDivision Multiplexing)</h4>
<p>通过码分复用共享信道也叫作码分多址 CDMA (CodeDivision Multiple Access)。</p>
<p>优势：各个用户使用经过特殊挑选的不同码型，因此彼此之间不会造成干扰, 因此广泛使用在移动通信中，特别是在无线局域网中。</p>
<p>工作原理：</p>
<p>在 CDMA 中，每一个比特时间被划分为 m 个短的间隔，每一个间隔称为一个码片 (chip)。通常 m 的值是 64 或 128，但为了讲述方便，下文取 m=8。</p>
<p>使用 CDMA 的每一个站被指派一个唯一的 m bit 码片序列：</p>
<ul>
<li>
<p>若发送比特 1，则发送自己的 m bit 码片序列；</p>
</li>
<li>
<p>若发送比特 0，则发送该码片序列的二进制反码。</p>
</li>
</ul>
<p>例如，S 站的 8 bit 码片序列是 00011011。</p>
<p>• 发送比特 1 时，就发送序列 00011011；</p>
<p>• 发送比特 0 时，就发送序列 11100100。</p>
<blockquote>
<p>⚠️ ⚠️ ⚠️<br>
一般为了运算的方便，将码片中的 0 写为 - 1，将 1 写为 + 1.<br>
则 S 站的码片序列向量为：(–1–1 –1 +1 +1 –1 +1 +1)。</p>
</blockquote>
<p>既然是为了运算方便，那这些码片序列有什么联系吗？</p>
<p>CDMA 系统的一个重要特点就是：每个站的码片序列各不相同，并且两两正交。</p>
<p>公式说明：</p>
<p>令向量 S 表示站 S 的码片向量，令 T 表示其他任何站的码片向量。两个不同站的码片序列正交，就是向量 S 和 T 的规格化内积 (inner product) 为 0：</p>
<p><img src="./imgs/84cc4166b52bba928d01b84160c1b63d.png" alt=""></p>
<p>光看公式是不行的，要手动计算一下才行。</p>
<p>例如：向量 S 为 (–1–1 –1 +1 +1 –1 +1 +1)，向量 T 为 (–1–1 +1 –1 +1 +1 +1 –1)。</p>
<p>把数据带入公式中，S*T=[1+1-1-1+1-1+1-1] /8 = 0 , 所有 S 和 T 正交。</p>
<p>通过正交关系这一个重要的特性，我们还能推出其他重要关系：</p>
<p>1、任何一个码片向量和该码片向量自己的规格化内积值都是 1。</p>
<p><img src="./imgs/a861a9bceeee02fabad3e042dfaa1eaa.png" alt=""></p>
<p>2、一个码片向量和该码片反码的向量的规格化内积值都是 - 1。</p>
<p>3、如果一个 “码片向量 S” 和 另一个 “码片向量 T” 是正交，那么就会有如下重要的性质：</p>
<ul>
<li>
<p>S 和 T 正交</p>
</li>
<li>
<p>S 和 “T 的反码” 正交</p>
</li>
<li>
<p>“S 的反码” 和 T 正交</p>
</li>
<li>
<p>“S 的反码”和 “T 的反码” 正交</p>
</li>
</ul>
<p>这些性质都是十分重要的，这里给出实际样例图阐述~</p>
<p><img src="./imgs/a0807893ab6cb8f57263703329624122.png" alt=""></p>
<p>解释：</p>
<p>那么，在接收端要想得到 S 站的数据码元，就要规格化内积 S * (Sx + Tx) 。</p>
<p>而 S * (Sx + Tx) = S * Sx + S * Tx = S * Sx + 0 = S * Sx 。</p>
<p>根据前面的性质，S 和 Tx 规格化为 0，如果 Sx 是 S 的反码，则规格化为 - 1，对应 “0” 比特。如果 Sx 和 S 相同，则规格化为 +1，对应 “1” 比特。</p>
<p>用实际数据在来计算一下，不然光讲可能不太懂~</p>
<blockquote>
<p>S:(-1-1 -1 +1 +1 -1 +1 +1),<br>
Sx:(-1 -1 -1 +1 +1 -1 +1 +1),(-1 -1 -1 +1 +1 -1 +1 +1),(+1 +1 +1 -1 -1 +1 -1 -1),<br>
Tx:(-1 -1 +1 -1 +1 +1 +1 -1),(-1 -1 +1 -1+1 +1 +1 -1),(+1 +1 -1 +1 -1 -1 -1 +1),<br>
Sx+Tx:(-2-2 0 0 +2 0 +2 0),(-2 -2 0 0 +2 0 +2 0),(+2 +2 0 0 -2 0-2 0),<br>
S*(Sx+Tx) : 1 , 1 , -1 , 所以发送的数据是 1 , 1 , 0</p>
</blockquote>
<p>同理如果你要想得到 T 站的数据码元，就要规格化 T *（Sx + Tx）。</p>
<p>随堂练习：</p>
<p><img src="./imgs/c4252d97cb4e4d4beeeaaa2052535cb7.png" alt=""></p>
<p>解：</p>
<p>（A * R）/ 8 = 1；A 发送 1</p>
<p>（B * R）/ 8 = -1; B 发送 0</p>
<p>（C * R） / 8 = 0; C 没发送任何数据</p>
<p>（D * R）/ 8 = 1; D 发送了 1</p>
<h3 id="5-数字传输系统">5 数字传输系统</h3>
<p>早期数字传输系统的缺点：</p>
<ol>
<li>
<p>速率标准不统一</p>
</li>
<li>
<p>不是同步传输</p>
</li>
</ol>
<p>现代的传输网络的传输媒体：光纤。</p>
<p>最初的在数字传输系统中使用的传输标准是脉冲调制 PCM。现在高速的数字传输系统使用同步光纤网 SONET（美国标准）或 同步数字系列 SDH（国际标准）。</p>
<p>同步光纤网络 (SONET)：是数据在光学媒介上同步传输的 ANSI 标准。与 SONET 相当的国际标准是同步数字层次 (SDH)。它们制定了一个标准，这样国际数字网络就可以互联，现有的传统传输系统也可以利用光学媒介的优点。</p>
<h3 id="6-宽带接入技术">6 宽带接入技术</h3>
<p>从宽带接入的媒体来看，可分为两大类：</p>
<ul>
<li>
<p>有线宽带接入（这里只探究这个）</p>
</li>
<li>
<p>无线宽带接入（过于复杂，后续讨论）</p>
</li>
</ul>
<p>用户到互联网的宽带接入方法有这三种：</p>
<p>【1】ADSL 技术：</p>
<p>非对称数字用户线 ADSL(Asymmetric Digital Subscriber Line) 技术是用数字技术对现有模拟电话的用户线进行改造，使它能够承载宽带数字业务。</p>
<p>§ 标准模拟电话信号的频带在 300~3400 Hz 的范围内，而用户线本身实际可通过的信号频率超过 1 MHz。</p>
<p>§ ADSL 技术就把 0~4kHz 低端频谱留给传统电话使用，而把原来没有被利用的高端频谱留给用户上网使用。</p>
<blockquote>
<p>ADSL 的特点：<br>
1、非对称：下行（从 ISP 到用户）带宽远大于上行（从用户到 ISP）带宽。<br>
2、 需要在用户线的两端各安装一个 ADSL 调制解调器。</p>
</blockquote>
<p>DMT 调制技术：</p>
<p>DMT 调制技术采用频分复用的方法，把 40 kHz 以上一直到 1.1 MHz 的高端频谱划分为许多的子信道，其中 25 个子信道用于上行信道，而 249 个子信道用于下行信道，并使用不同的载波进行调制。</p>
<p>每个子信道占据 4 kHz 带宽，并使用不同的载波（即不同的音调）进行数字调制。</p>
<p><img src="./imgs/539e3ce2e526bf15f23a4461828cd488.png" alt=""></p>
<p>ADSL 调制解调器又称为接入端接单元 ATU (Access Termination Unit)。ATU-C (C 代表端局 Central Office)、ATU-R (R 代表远端 Remote) 都是调制解调器，只是所在地不同。</p>
<p>ADSL 最大的好处就是可以利用现有电话网中的用户线，而不需要重新布线。</p>
<p>第二代 ADSL：</p>
<p>得到了更高的数据率，采用无缝速率自适应技术，可在运营中不中断通信和不产生误码的情况下，自适应的调整数据率。</p>
<p>【2】光纤同轴混合网 (HFC 网)</p>
<p>1、HFC(Hybrid Fiber Coax) 网是在目前覆盖面很广的有线电视网的基础上开发的一种居民宽带接入网。</p>
<p>2、HFC 网利用已经有相当大的覆盖面的有线电视网，除可传送电视节目外，还能提供电话、数据和其他宽带业务。</p>
<p>3、早期的有线电视网是树形拓扑结构的同轴电缆网络，对电视节目进行单向传输。通过将原有线电视网中的同轴电缆主干部分改换为光纤，变成了现在的光纤同轴混合网。</p>
<p>4、HFC 网具有双向传输功能。</p>
<p>HFC 网的结构图解：</p>
<p>光纤从头端连接到光纤节点 (fiber node)，在光纤节点光信号被转换为电信号，然后通过同轴电缆传送到每个用户家庭。</p>
<p><img src="./imgs/65bc09a5075b71d93f3af56286e3b688.png" alt=""></p>
<p><img src="./imgs/540f3fa4b04b15a6bb043234a91f47f1.png" alt=""></p>
<p>HFC 网用户端需要使用的设备：</p>
<p>1、机顶盒（set-topbox）</p>
<p>• 使现有的模拟电视机能够接收数字电视信号。</p>
<p>• 连接在同轴电缆和用户的电视机之间。</p>
<p>2、电缆调制解调器（cablemodem）</p>
<p>• 使用户计算机能够利用 HFC 网接入互联网。</p>
<p>• 连接在同轴电缆和用户计算机之间。</p>
<p>• 不需要成对使用，只需安装在用户端。</p>
<p>• 可以集成在机顶盒里面。</p>
<p>【3】FTTx 技术</p>
<p>§ FTTx 表示 FiberTo The…（光纤到…），字母 x 代表不同的光纤接入地点，也就是光电进行转换的地方。</p>
<p>§ 光纤到户 FTTH (Fiber To The Home)：光纤一直铺设到用户家庭。</p>
<p>§ 光纤到大楼 FTTB (Fiber To The Building)：光纤进入大楼后就转换为电信号，然后用电缆或双绞线分配到各用户。</p>
<p>另外还有 FTTC、FTTZ、FTTF、FTTO、FTTD 等不同形式。</p>
<p>无源光网络 PON：为有效利用光纤资源，在光纤干线和用户之间使用无源光网络 PON。无源光网络无须配备电源，长期运行和管理成本低。</p>
<p>最流行的无源光网络是以太网无源光网络 EPON 和吉比特无源光网络 GPON。</p>
<blockquote>
<p>宽带接入技术这里讲的有点多，但部分学校又不会考察太多，甚至不会考察，这里就当扩充下课外知识吧。</p>
</blockquote>
<h2 id="第三章-数据链路层">第三章 数据链路层</h2>
<h3 id="1-数据链路层概述">1  数据链路层概述</h3>
<p><strong>数据链路层使用的信道主要有以下两种类型：</strong></p>
<ul>
<li><strong>点对点信道</strong>：这种信道使用一对一的点对点通信方式。</li>
<li><strong>广播信道</strong>：这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。</li>
</ul>
<p><img src="./imgs/image-20240108182515014.png" alt="image-20240108182515014"></p>
<p>在复习之前，先看一下互联网进行通信时数据链路层所处的位置（两台主机之间）</p>
<p><img src="./imgs/5dc4db7daf084719a02604953c780f86.png" alt="">数据链路和帧   数据链路和帧</p>
<h4 id="数据链路和帧">数据链路和帧</h4>
<p><strong>链路：</strong></p>
<ul>
<li>从一个节点到相邻节点的物理线路。</li>
<li>链路只是一条通信路径的组成部分。</li>
</ul>
<p><strong>数据链路</strong> <strong>：</strong></p>
<ul>
<li>要传送数据，除了物理线路外，还必须有通信协议来控制数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。</li>
<li>现在最常用的方法是使用网络适配器 (即网卡，既有硬件也包括软件) 来实现这些协议。一般的适配器都包括了数据链路层和物理层这两层的功能。</li>
</ul>
<p>**帧：**数据链路层的协议数据单元</p>
<p>图示：</p>
<p><img src="./imgs/49027e7544fc451394385090f3ae2559.png" alt=""></p>
<h3 id="2-三个基本问题三个基本问题">2  三个基本问题三个基本问题</h3>
<p>在点对点信道的数据链路层进行传输时，我们需要考虑以下三个基本问题。</p>
<h4 id="封装成帧"><strong>封装成帧</strong> ：</h4>
<p><strong>封装成帧：</strong> 就是在一段数据的前后分别添加 首部 和 尾部 ，把它构成一 个 帧。发送帧时，从首部开始发送。</p>
<blockquote>
<ol>
<li>首部和尾部的一个重要作用就是帧定界（确定帧的界限）。</li>
<li>首部和尾部还包括许多必要的控制信息。不同数据链路层协议，首部和尾部的格式不同。</li>
<li>每一种数据链路层协议都规定了所能传送的数据部分长度上限，即最大传送单元 MTU</li>
<li>帧定界一般使用特殊的控制字符 SOH（Start Of Header）和 EOT</li>
</ol>
<p><img src="./imgs/1bc526fd043c410c9253c55e622e5fb8.png" alt=""></p>
</blockquote>
<p>若忽略与<strong>帧定界无关的控制信息</strong>，则帧可表示如下：</p>
<p><img src="./imgs/6c21cb2b438e4b418ca1b7edbb6f2fbb.png" alt=""></p>
<p>容易出现的相关问题：</p>
<blockquote>
<p>(1) 假设发送端由于故障发送中断，故障消除后又重新开始发送。由于使用了帧定界符，接收端就会知道前面收到的数据是个不完整的帧（只有 SOH 而没有 EOT），而对于不完整的帧，会直接丢弃。<img src="./imgs/f8e496ef9e8540b98a359dc81ee83c48.png" alt="">(2)  如果数据中的某个字节的二进制代码恰好和 SOH （00000001）或 EOT （00000100）一样，数据链路层就会错误地 “找到帧的边界”，导致发生错误。<img src="./imgs/b9f0d4d3bddf48fa83bf6c94dd7ffa0c.png" alt=""></p>
</blockquote>
<h4 id="透明传输">透明传输</h4>
<p>**透明传输：**是指无论什么样的数据，都能够不受阻碍地进行传输。</p>
<p>而上面提到的第二个问题显然不是 “透明传输” ，而为了解决透明传输的问题，就要采用<strong>字节填充</strong>的方法**：**</p>
<blockquote>
<p><strong>原理解释：</strong></p>
<ol>
<li>发送端的数据链路层在数据中出现的控制字符SOH 或 EOT 的前面插入一个转义字符 ESC；</li>
<li>接收端的数据链路层遇到 ESC 后，会跳过检测下一个字节，并将 ESC 删去。这样在数据中就不会检测到SOH 或 EOT，并能将插入的ESC 删去；</li>
<li>如果 ESC 也出现在数据当中，为了避免被误删，在 ESC 前面也插入一个转义字符。这样，前面的 ESC 被删去，后面的 ESC 因跳过检测而被保留。</li>
</ol>
<p><img src="./imgs/60002cf3374c4770b3aedb54f7bd2ecb.png" alt=""></p>
<p>注意：MTU 指的是帧中原始数据的最大长度，不包括填充的数据。</p>
</blockquote>
<h4 id="差错检测重点">差错检测（重点）</h4>
<p>现实的通信链路都不会是理想的，这就是说：比特在传输过程中可能会产生比特差错：1 可能会变成 0 而 0 也可能变成 1。</p>
<blockquote>
<ul>
<li>比特差错是传输差错的一种，另一种是【帧丢失、帧重复、帧失序】（很复杂，本章不讲，后续会讲）</li>
<li>在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER 。</li>
<li>误码率不可能下降到零，为了保证数据传输的可靠性，必须采用差错检测措施。</li>
<li>“无比特差错”和 “无传输差错” 是不同的概念。在数据链路层使用 CRC 检验，能够实现无比特差错的传输，但这还不是<strong>可靠传输</strong>。要做到可靠传输还必须再加上编号、确认和重传机制。</li>
</ul>
</blockquote>
<p>在数据链路层传送的帧中，广泛使用了 <strong>循环冗余检验 CRC</strong> 的检错技术 。</p>
<blockquote>
<p>大概过程：</p>
<p><img src="./imgs/4766dd9dcde441b99e85f4716567199f.png" alt=""></p>
<ol>
<li><strong>假定发送端的原始数据为 <em>k</em> 个比特。</strong></li>
<li><strong>对原始数据进行 CRC 运算，产生 n 位冗余码供差错检测使用。</strong></li>
<li><strong>将原始数据和冗余码构成帧发送出去。</strong></li>
<li><strong>接收端检验。</strong></li>
</ol>
</blockquote>
<p>重点：<strong>冗余码的计算</strong> （必考）</p>
<blockquote>
<p><img src="./imgs/be3001355d554ef38d3ba8204d85d356.png" alt=""></p>
<p>计算演示：</p>
<p><img src="./imgs/d4a58ccd7b3d47e9b6b0fc54ea7c5c9e.png" alt=""></p>
<p>用模 2 运算进行加法运算时不进位，例如：1111+1010 = 0101。减法和加法一样，按加法规则运算。</p>
<p>其实你也可以理解为， 二进制数进行按位 “异或” 运算，即相同为 0，不相同为 1。</p>
</blockquote>
<p><strong>接收端检验</strong>：</p>
<blockquote>
<p><img src="./imgs/dde7cb0ebb4d4764b8bd4bf0badbc318.png" alt=""></p>
<p>你可以自行带入上面那段计算演示，进行检验，很容易理解的。</p>
</blockquote>
<p>只要经过严格的挑选，并使用位数足够多的除数 <em>P</em>，那么出现检测不到的差错（即出现误码后接收端校验余数仍为零）的概率就很小很小。</p>
<p>可以用多项式来表示循环冗余检验的除数，如用多项式 P(X) = X3 + X2 + 1 表示 1101。这种多项式叫做生成多项式。</p>
<h3 id="3-点对点协议-ppp">3  点对点协议 PPP</h3>
<blockquote>
<p><img src="./imgs/de8b97d7a6e84f09a74e69348ab4f67d.png" alt=""> 对于点对点链路，目前使用得最广泛的数据链路层协议是<strong>点对点协议</strong> <strong>PPP。</strong></p>
<p>用户通过 ISP 接入互联网时，用户计算机和 ISP 进行通信时所使用的数据链路层协议就是    PPP 协议 。</p>
</blockquote>
<p>从 PPP 协议设计需求上，理解它的功能。</p>
<blockquote>
<ol>
<li>简单：不要求可靠传输；</li>
<li>封装成帧：规定特殊的字符作为帧定界符；</li>
<li>透明性：解决透明传输的问题；</li>
<li>多种网络层协议：能够同时支持多种网络层协议；</li>
<li>多种类型链路：能够在多种类型的链路上运行；</li>
<li>差错检测：能够对收到的帧进行检测，并立即丢弃有差错的帧；</li>
<li>检测连接状态：能够及时自动检测出链路是否处于正常工作状态；</li>
<li>最大传送单元：对每一种类型的点对点链路设置最大传送单元   MTU 的标准默认值（1500 字节）；</li>
<li>网络层地址协商：提供一种机制使通信的两个网络层实体能够通过协商知道或能够配置彼此的网络层地址；</li>
<li>数据压缩协商：提供一种方法来协商使用数据压缩算法。</li>
</ol>
</blockquote>
<h4 id="ppp-协议的组成"><strong>PPP 协议的组成：</strong></h4>
<p>主要以下三大部分：</p>
<blockquote>
<p>(1) 对各种协议数据报的封装方法（封装成帧）。<br>
(2) 链路控制协议 (Link Control Protocol, LCP)，LCP 协议是 PPP 协议的一部分。它用于建立、配置、测试数据链路的连接。<br>
(3) 一套网络控制协议 (Network Control Protocol, NCP)，NCPs 是一系列协议，用于建立和配置不同的网络层协议。每个 NCP 协议都支持不同的网络层协议，比如 IP 协议，OSI 的网络层，苹果的 Appple Talk 等。</p>
</blockquote>
<h4 id="ppp-协议的帧格式"><strong>PPP 协议的帧格式</strong></h4>
<p><strong>各字段的意义：（注意不要和后面的 MAC 帧格式混为一谈）</strong></p>
<blockquote>
<p><img src="./imgs/d89b44ce63dd48a1aac1319d6961027a.png" alt=""></p>
<p>PPP 帧的首部和尾部分别为四个字段和两个字段。</p>
<ul>
<li>首部的第一个字段和尾部的最后一个字段都是标志字段 F (Flag)，规定为 0x7E（符号 “0x” 表示它后面的字符是用 16 进制表示的，0x7E 的二进制形式：01111110 ）。标志字段就是 PPP 帧的定界符，连续两帧之间只需要用一个标志字段（如果出现连续两个标志字段，就表示这是一个空帧，应丢弃）。</li>
<li>地址字段 A 规定为 0xFF（11111111），控制字段 C 规定为 0x03（00000011）。这两个字段没有实际意义，并没有携带 PPP 帧的信息。</li>
<li>协议字段（2 字节）指明信息部分的类别，当协议字段为 0x0021 时， PPP 帧的信息字段 就是 IP 数据报，当为 0xC021，则信息字段是 PPP 链路控制协议 LCP 的数据，当为 0x8021，表示这是网络层的控制数据&hellip;&hellip;&hellip;.. 。</li>
<li>信息字段长度可变，不超过 1500 字节。</li>
<li>尾部的第一个字段 (2 字节) 是使用 CRC 的帧检验序列 <strong>FCS</strong> 。</li>
</ul>
</blockquote>
<p>如果信息字段中出现 0x7E 这样的比特序列，会被误认为是 “标志” 字段，必须采取一定的方法解决这个问题，这也是之前我们提到的<strong>实现透明传输</strong>。</p>
<p>这里我们会从更深层角度探讨实现透明传输，即字节填充和零比特填充。</p>
<p><strong>字节填充</strong></p>
<blockquote>
<p><strong>当 PPP 使用异步传输（以字节为单位）时，采用字节填充的方法实现透明传输，转义符定义为 0x7D：</strong></p>
</blockquote>
<p>具体做法：</p>
<ul>
<li>将信息字段中出现的每一个 0x7E 字节转变为 2 字节序列：0x7D 0x5E。</li>
<li>若信息字段中出现 0x7D 字节, 则将其转变为 2 字节序列：0x7D 0x5D。</li>
<li>若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面加入一个 0x7D 字节，同时将该字符的第 5 位取反 (即加上 0x20)。(<strong>解释</strong>：例如出现 0x03(00000011）【在控制字符中是 “传输结束”ETX】就要把它的第五位‘0’取反为‘1’ ，变为 00100011（0x23）所以就转变成了：0x7D , 0x23)</li>
</ul>
<p>总结：</p>
<ol>
<li>发送数据时在需要转义的字节前面插入转义符 0x7D，并把需要转义的字节的第 5 位取反。</li>
<li>在接收端，每检测到一个 0x7D 字节，就把它删掉，并把紧接着的下一个字节的第 5 位取反即可还原出原来的数据。</li>
</ol>
<blockquote>
<p>⚠️⚠️⚠️</p>
<p>异步传输以字节为单位，一个字节是 8 个二进制位。</p>
<p>字节的最右边是最低位，即第 0 位</p>
</blockquote>
<p><strong>零比特填充</strong></p>
<blockquote>
<p>当 PPP 使用同步传输（连续比特流传送）时，采用零比特填充的方法实现透明传输：</p>
</blockquote>
<p>具体做法：</p>
<ul>
<li>在发送端，只要发现有 5 个连续的 1，则立即填入一个 0，以保证不会在信息字段中出现 6 个连续的 1。</li>
<li>在接收端，先找到标志字段 F 以确定帧的边界，然后对其中的比特流进行扫描，每当发现 5 个连续的 1 时，就把这 5 个连续的 1 后的一个 0 删除，以还原成原来的信息比特流。</li>
</ul>
<p><img src="./imgs/70fd5de435674304ab9de08cb4447ab0.png" alt=""> ppp 协议的工作状态</p>
<p><strong><a href="https://blog.csdn.net/cainv89/article/details/50634483?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=ppp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%8A%B6%E6%80%81&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-50634483.142%5Ev80%5Einsert_down38,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&amp;spm=1018.2226.3001.4187" title="PPP协议的工作状态（点这）">PPP 协议的工作状态（点这）</a></strong></p>
<h3 id="4使用广播信道的数据链路层">4  使用广播信道的数据链路层</h3>
<h4 id="局域网的数据链路层">局域网的数据链路层</h4>
<p>广播信道可以进行一对多的通信，下面讨论的局域网使用的就是广播信道。</p>
<p>局域网最主要的<strong>特点</strong>是：网络为一个单位所拥有，且地理范围和主机数目均有限。</p>
<p>局域网主要有以下<strong>优点</strong>：</p>
<ol>
<li>具有广播功能，从一台主机可以很方便地访问全网。局域网上的主机可共享连接在同一个局域网上的各种硬件和软件资源。</li>
<li>便于系统的扩展 和逐渐演变，各设备的位置可灵活调整和改变。</li>
<li>提高了系统的可靠性、可用性和生存性</li>
</ol>
<p><strong>局域网中的拓扑结构：</strong></p>
<p><img src="./imgs/5845f4d87cdb4c778e0e51cdb1ce7145.png" alt=""></p>
<blockquote>
<p>⚠️⚠️⚠️</p>
<p>局域网覆盖范围有限，而且局域网中的节点主要是主机，所以局域网无法形成网状结构。</p>
</blockquote>
<p><strong>局域网使用的传输媒体：</strong></p>
<ul>
<li>双绞线：最便宜最常用；</li>
<li>光纤：高数据率、长距离传输时使用。</li>
</ul>
<p><strong>信道共享的</strong>方法主要有两类：</p>
<ol>
<li><strong>静态</strong>划分<strong>信道，又称为信道复用</strong>（代价较高）：</li>
</ol>
<p>•  频分复用</p>
<p>•  时分复用</p>
<p>•  波分复用</p>
<p>•  码分复用</p>
<p>2. 动态媒体接入控制，又称为多点接入：</p>
<p>•  随机接入 ：所有的用户可随机地发送信息；需要有解决碰撞的机制。</p>
<p>•  受控接入： 用户不能随机地发送信息而必须服从一定的控制（目前在局域网中使用较少）。</p>
<h4 id="适配器">适配器</h4>
<p>既然谈到了局域网，那么计算机是怎样连接到局域网上的呢？</p>
<p>计算机与外界局域网的连接是通过<strong>适配器</strong>。</p>
<p>适配器：是一个接口转换器，它可以是一个独立的硬件接口设备，允许硬件或电子接口与其它硬件或电子接口相连，也可以是信息接口。</p>
<p>适配器本来是主机箱内插入的一块网络接口板（又称为” 网络接口卡 NIC“，简称” 网卡 “），但是现在的计算机主板上就已经嵌入了这种适配器，不在使用单独的网卡了，因此现在的计算机上的适配器不是独立的。</p>
<p>注意：计算机的硬件地址（在后续的以太网的 MAC 层讨论）就在适配器的 ROM 中，而计算机的软件地址—— IP 地址（在网络层会讲）则在计算机的存储器中。</p>
<p>适配器的作用</p>
<ol>
<li>
<p>要进行数据串行传输和并行传输的转换。</p>
</li>
<li>
<p>对数据进行缓存。</p>
</li>
<li>
<p>实现以太网协议。</p>
</li>
<li>
<p>管理该适配器的设备驱动程序安装在计算机的操作系统。</p>
</li>
</ol>
<h4 id="csmacd-协议重点csmacd">CSMA/CD 协议（重点）CSMA/CD</h4>
<p>现在以太网已成为了局域网的代名词。以太网采用的是<strong>随机接入</strong>的方式。</p>
<p>最初的以太网是将许多计算机都连接到一根总线上。如图：</p>
<blockquote>
<p><img src="./imgs/387e2fe283a44688bfaaf71d4cfcdc40.png" alt=""></p>
<ul>
<li>总线上的每一台计算机都能检测到计算机B 发送的数据。</li>
<li>每一台计算机的网卡都有一个全球唯一的硬件地址。计算机B在发送数据帧时，在帧的首部写明计算机D的硬件地址。</li>
<li>只有计算机的硬件地址与数据帧首部的目的地址一致时才会接收这个帧，因此只有计算机D接收这个数据帧。</li>
<li>其他所有的计算机（A、C和E）检测到不是发送给它们的数据帧就丢弃。</li>
</ul>
<p>⚠️⚠️⚠️</p>
<ol>
<li><strong>以太网提供的服务是不可靠的交付，即尽最大努力的交付。</strong></li>
<li>当目的主机收到有比特差错的数据帧时，就把帧丢弃，其他什么也不做，是否需要重传则由高层协议来决定。</li>
</ol>
</blockquote>
<p><strong>以太网发送的数据信号使用曼彻斯特编码。</strong></p>
<p>如图：曼彻斯特编码的编码方法是把每个码元分成两个相等的间隔（每一个码元都被调成两个电平）。码元 1 前一个间隔为低电压（也可采用相反的约定），后一个间隔为高电压，码元 0 则相反。这样就保证了在每个比特的正中间出现一次电压的转换，而接收端就能利用这种电压的转换很方便的把<strong>位同步信息</strong>（<strong>比特同步信号</strong>）提取出来（优点）。</p>
<p>当然我们还能提取出更重要的信息：曼彻斯特编码所占的频带宽度比原始的基带信号增加了一倍（<strong>每秒传输的码元数加倍了</strong>），所以<strong>数据传输速率（bit/s）只有调制速率的 1/2(码元 / s) 。</strong>（这也是它的缺点所在）。</p>
<p>原因：比如说在一个时间内，要发送一个比特 1，使用一个高电平就可以了，而使用曼彻斯特编码，它需要一个高和一个低电压，这个时候<strong>传输的码元（波形）就加倍</strong>了，因此频带宽度就加倍了，导致传输等量的数据所需的带宽增大了一倍  ，最后<strong>曼彻斯特编码的效率只可达到 50% 左右</strong>。（关于编码和调制，可以复习<a href="https://blog.csdn.net/m0_74215326/article/details/129599155?spm=1001.2014.3001.5502" title="之前的物理层">之前的物理层</a>）。</p>
<p><img src="./imgs/5d07ad879af04f8fa9b271994bdf2fe9.png" alt=""></p>
<p><strong>下面介绍 CSMA/CD 协议的要点：——&gt;</strong></p>
<p>当多台计算机同时发送数据时，会产生碰撞，导致发送失败。以太网使用 <strong>CSMA/CD</strong> <strong>协议</strong>来解决这一问题。</p>
<p><strong>CSMA/CD (Carrier</strong> <strong>Sense Multiple Access with Collision</strong> <strong>Detection)</strong> **意思是****载波监听多点接入** <strong>/</strong> <strong>碰撞检测**</strong>。**</p>
<ol>
<li><strong>多**<strong>点*</strong>*接入**</strong>：就是说明*<strong>*这是总线型网络**</strong>，许多*<strong>*计算机以多点接入的方式连接在一根总线上。</strong></li>
<li><strong>载波监听**</strong>：****每**<strong>一台计算机在*</strong>*发送数据之前要先检测一下总线上是否有其他计算机在发送**<strong>数                         据。如果*</strong>*有，则****暂时先不发送数据，等到信道空闲时再发送。**</li>
<li><strong>碰撞检测**</strong>：计算机****边发送数据边检测信道上的信号**<strong>电压的变化情况，以*</strong>*便判断是否与其他计                     算机发生****碰撞。**</li>
</ol>
<ul>
<li>当多台计算机同时在总线上发送数据时，总线上的信号电压变化幅度将会增大（互相叠加）。</li>
<li>当计算机检测到信号电压变化幅度超过一定的门限值时，就认为总线上至少有两台计算机同时在发送数据，即产生了碰撞。</li>
<li>所谓 “碰撞” 就是发生了冲突。因此 “碰撞检测” 也称为“冲突检测”。</li>
<li>任何一台正在发送数据的计算机，一旦发现总线上出现了碰撞，就要立即停止发送以免浪费网络资源，然后等待一段随机时间后再次发送。</li>
</ul>
<p>那么问题来了：既然每一台计算机在发送数据之前已经监听到信道为空闲，那么为什么还会出现碰撞呢？</p>
<p>答：因为电磁波在总线上的传播速率是有限的，当某台计算机监听到总线空闲而发送数据时，可能已经有其他计算机在发送数据了，只是因为传播时延还没有到达该计算机那里。</p>
<p><strong>传播时延对载波监听的影响：</strong></p>
<p><img src="./imgs/14b770f7cee74c7884f865a0a0cbbae0.gif" alt=""></p>
<p>对上述图解，详细解释一下。</p>
<p><img src="./imgs/e8c0c5667cf04cb081285677feb2a6e2.png" alt=""></p>
<p>最终，A 和 B 发送数据均失败，它们都要推迟一段时间再重新发送。</p>
<blockquote>
<p>从上述我们不难看出;</p>
<ul>
<li><strong>使用</strong> <strong>CSMA/CD</strong> <strong>协议的以太网不能进行全双工通信而**<strong>只能进行双向交替通信*</strong>*（半双工通信）。</strong>(一个站不能同时进行发送和接收，但可以边发送边监听信道)</li>
<li>**每台计算机在****发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。**</li>
<li><strong>16 字总结：先听后发，边听边发，冲突停止，延迟重发。</strong></li>
</ul>
</blockquote>
<p>根据上图，一台计算机在发送数据帧后<strong>最多</strong>经过时间 2t 就可知道自己所发送的数据帧是否遭受了   碰撞。（一台计算机在发送数据后，经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞）</p>
<p>因此为了尽可能减少重传时再次发生冲突的概率，规避算法有如下具体的规定：</p>
<blockquote>
<ol>
<li>基本规避时间为 2t (2t 称为争用期或碰撞窗口),  以太网规定具体的争用期时间为 <strong>51.2µs</strong> <strong>（<strong>这也是为什么 25.6*10^-6 * 2.0*10^8 = 5120m【实际上并没有这么远】局域网覆盖范围有上限的原因吧</strong>）</strong>，对于 10Mbit/s 以太网也可以说争用期是 512 比特时间，1 比特时间就是发送 1 比特需要的时间。例如：争用期是 512 比特，即争用期是发送 512 比特所需时间。</li>
<li>发生碰撞的计算机在停止发送数据后，等待信道空闲后不是立即发送而是要推迟（即退避）一个随机的时间才能再发送数据。具体的<strong>截断二进制指数退避算法</strong>如下： §  规 定 基本退避 时间为争用 期 2 t ； §  定义参数 k ， k = Min[ 重传次数 , 10 ] ； §  从整数集合 [0 , 1, …, (2^ k - 1)] 中随机地取出一个数，记为 r 。 重传应推后的时间就是 r 倍的基本退避时间。 §  当 重传达 16 次 仍不能成功 时则丢弃 该帧，并向高层报告 。</li>
</ol>
</blockquote>
<p><strong>最短有效帧长</strong></p>
<p>如果一个帧太短，发送方很快就能发送完毕而检测不到碰撞，但这个帧却有可能在到达目的主机的途中与其他主机发送的帧发生碰撞。由于不再监听信道，发送方无法知道这个帧发生了碰撞。</p>
<p>因此：</p>
<ol>
<li>对于 10 Mbit/s 的传统以太网，在争用期内可发送 512 bit，即 64 字节。若前 64 字节未发生碰撞，则后续发送的数据就一定不会发生碰撞。</li>
<li>以太网规定最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是无效帧。如果要发送的数据非常少，则必须加入一些填充字节，使帧长不小于 64 字节。</li>
</ol>
<blockquote>
<p>关于涉及最短帧长的考点：</p>
<p>需要理解最短帧长的概念及计算公式， 最短帧长就是要求<strong>发送方在数据的传播过程中仍然不停地发送数据帧，即争用时间内发出的数据总数。</strong>  在 CSMA/CD 协议中，只有收到大于最短帧长的数据帧且经过争用期这段时间还没有检测到碰撞，才认为未检测到数据冲突。</p>
<p>最小数据帧长度 = 2 _ 传播时延 _ 数据传输率</p>
<p>因此当最短数据帧长度减小时，根据公式，如果保持数据传输率不变，传播时延就必须要减少，而传播时延等于站点间距离除于数据的传播速率，从而站点间距离就必须要减少。</p>
</blockquote>
<p><strong>帧间最小间隔</strong></p>
<p>以太网还规定帧间最小间隔为 9.6 <strong>µs</strong> 。一台计算机在检测到总线开始空闲后，还要等待 9.6 <strong>µs</strong>  才能再次发送数据。</p>
<p>这样做是为了使刚刚收到数据帧的计算机的接收缓存来得及清理 ，为接收下一帧做好 准备。</p>
<h4 id="使用集线器的星形拓扑">使用集线器的星形拓扑  </h4>
<p>传统以太网（10 Mbit/s）使用的传输媒体一直在变，从粗同轴电缆到细同轴电缆再到现在流行的<strong>双绞线。</strong></p>
<p>使用双绞线的以太网往往采用星形拓扑，在星形的中心使用一种可靠性非常高的设备，叫做<strong>集线器</strong></p>
<p><img src="./imgs/d592ebc13dc3457ba96b4e94910d511a.png" alt=""></p>
<p>我们谈论这个肯定有它的意义：</p>
<blockquote>
<ul>
<li>这种使用双绞线的星形以太网又叫 10BASE-T 以太网。“10” 代表 10 Mbit/s 的数据率，BASE 表示连接线上的信号是基带信号，T 代表双绞线。</li>
<li>10BASE-T 以太网的通信距离稍短，每个站到集线器的距离不超过 100 m。</li>
<li>10BASE-T 以太网是局域网发展史上的一个非常重要的里程碑，它奠定了以太网在局域网中的统治地位。</li>
</ul>
</blockquote>
<p>当然还有一个重要知识点，就是学习<strong>集线器</strong></p>
<ol>
<li>集线器使用电子器件来模拟实际电缆线的工作。使用集线器的以太网在物理上是一个星形网，但在逻辑上仍是一个总线网，各主机使用的还是 CSMA/CD 协议（更具体来说，是各主机中适配器执行 CSMA/CD 协议），并共享逻辑上的总线。</li>
<li>一个集线器有许多端口，每个端口通过 RJ-45 插头用两对双绞线与一台计算机的适配器相连。</li>
<li>集线器工作在物理层，它的每个接口仅简单地转发比特，不进行碰撞检测。</li>
</ol>
<p><img src="./imgs/5469bed6cc924b8bbcc0664044e97329.png" alt=""></p>
<p>当然我这里只讲了一些重要的概念，还有许多细节的地方没有过多阐述了，感兴趣的可以自行查找资料。（大概了解就行了）</p>
<h4 id="以太网的信道利用率">以太网的信道利用率</h4>
<p>若一个 10Mbps（Mbit/s）  的以太网<strong>同时</strong>有 10 个站工作，每个站所能发送数据的平均速率并不是 1 Mbps 。因为多个站在以太网上同时工作就可能发生碰撞。发生碰撞时信道资源被浪费<br>
扣除这些浪费，以太网的信道利用率不可能达到 100%。</p>
<p><strong>一个</strong> <strong>帧经过若干次碰撞最终发送成功所</strong> <strong>需</strong> <strong>的时间</strong> <strong>：</strong></p>
<p><img src="./imgs/ea92f63336d34a52bb463d6342152009.png" alt=""></p>
<p>解释：上图就是以太网的信道被占用的情况。一个站在发送帧时出现了碰撞。经过一个争用期 2t 后（t 是以太网单程端到端的传播时延），可能又出现了碰撞。这样经过若干个争用期后，一个站就发送成功了，假定发送帧所需要的时间是 To （它等于帧长（bit）除以发送速率）</p>
<p>⚠️⚠️⚠️ 成功发送出一个帧后，需要占用信道的时间实际上是：To + t （t 是以太网单程端到端的传播时延），这里要多一个 t , 实际上不难理解，<strong>这是因为发送的最后一个比特还要</strong>再<strong>经过时间</strong> <strong>t</strong> <strong>才能在</strong>信道上传送完。就好像火车过一个隧道，**To **就等于一个火车完全进入隧道，可能它的头部已经出隧道了，但只有尾部彻底出来隧道（再经过 t），才真正通过。</p>
<p>从上图可以看出，要提高以太网的信道利用率，就必须  <strong>减小</strong> <strong>t 与 T0</strong> <strong>之比</strong>。在以太网中定义参数 a 为 t 与 T0 之比：</p>
<p><img src="./imgs/dfec5462255d4b268f89908abe22ba4f.png" alt=""></p>
<blockquote>
<ul>
<li>a→0 表示 t 非常小，只要一发生碰撞就立即可以检测出来，并立即停止发送，因而信道利用率很高。</li>
<li>a 越大，表明争用期所占的比例越大，每发生一次碰撞浪费的信道资源就越多，信道利用率就越低。</li>
</ul>
<p><strong>解决方法：</strong></p>
<p>a 的值应当尽可能小些，这就要求 t 的数值小些而 T0 的数值大些：</p>
<ol>
<li><strong>以太网</strong>的连线的**长度不能太长，**否则 <strong>t</strong> <strong>的数值会太</strong>大。</li>
<li><strong>以太网的帧长不能太短，否则</strong> T0的值会太小。</li>
</ol>
</blockquote>
<p><strong>信道利用率的最大值</strong></p>
<p>假定以太网上的 各主机发送数据都不会产生碰撞，并且总线 一旦空闲就有某主机立即发送数据 。在这种理想情况 下，发送 一帧占用线路的时间是 T 0 + t ，而帧本身的发送时间是 T 0 ， 于是极限 信道利用率 S max 为：</p>
<p><img src="./imgs/895bd9b41c1448ce8bfb98dcf1893668.png" alt=""></p>
<p>实际上，据统计，当以太网的利用率达到 30% 时就已经处于重载的情况，很多的网络容量被网上的碰撞消耗掉了。</p>
<h4 id="以太网的-mac-层">以太网的 MAC 层</h4>
<p>在局域网中，硬件地址又称为物理地址，或 MAC 地址 (因为这种地址用在 MAC 帧中)，长度为 48 位（ip 地址：32 位）。以太网中的数据帧又叫 MAC 帧。</p>
<p>适配器从网络上每收到一个 MAC 帧就先用硬件检查 MAC 帧中的目的地址。如果是<strong>发往本站的帧</strong>则收下，然后再进行其他的处理；否则就将此帧丢弃，不再进行其他的处理。</p>
<p>“发往本站的帧” 包括以下三种帧：</p>
<ol>
<li><strong>单播</strong>帧（一对一），即帧的目的 <strong>MAC</strong> <strong>地址与本站的硬件地址相同。</strong></li>
<li><strong>广播</strong>帧（一对全体），即发送给本局域网上所有站点的帧，此时帧的目的MAC地址为全1（0xFFFFFFFFFFFF）。</li>
<li><strong>多播</strong>帧（一对多），即发送给本局域网上一部分站点（包含本站在内）的帧。</li>
</ol>
<p><strong>MAC 帧的格式</strong></p>
<p>常用的以太网 MAC 帧格式有两种标准，一种是 <strong>DIX Ethernet V2 标准 （即以太网 V2 标准</strong>），另一种是 <strong>IEEE 的 802.3 标准 。</strong>（但大家也常常把以太网 V2 称为 IEEE802.3 标准的 MAC 帧，其实并不严格区分二者，区别一点都不大，详细请见：P99 下面那段话）</p>
<blockquote>
<p>⚠️⚠️⚠️MAC 帧是<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%B8%A7/10571824?fromModule=lemma_inlink" title="数据帧">数据帧</a>的一种。而所谓数据帧，就是<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/4329290?fromModule=lemma_inlink" title="数据链路层">数据链路层</a>的<a href="https://baike.baidu.com/item/%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83/8226389?fromModule=lemma_inlink" title="协议数据单元">协议数据单元</a>，它包括三部分：帧头，数据部分，帧尾。其中，帧头和帧尾包含一些必要的<a href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E4%BF%A1%E6%81%AF/12652206?fromModule=lemma_inlink" title="控制信息">控制信息</a>，比如<a href="https://baike.baidu.com/item/%E5%90%8C%E6%AD%A5%E4%BF%A1%E6%81%AF/5925963?fromModule=lemma_inlink" title="同步信息">同步信息</a>、地址信息、差错控制信息等；数据部分则包含<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%B1%82/4329439?fromModule=lemma_inlink" title="网络层">网络层</a>传下来的数据，比如 ip 数据报。</p>
<p>在发送端，<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/4329290?fromModule=lemma_inlink" title="数据链路层">数据链路层</a>把网络层传下来得<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85/4760226?fromModule=lemma_inlink" title="数据封装">数据封装</a><a href="https://baike.baidu.com/item/%E6%88%90%E5%B8%A7/5921505?fromModule=lemma_inlink" title="成帧">成帧</a>，然后发送到链路上去；在接收端，数据链路层把收到的帧中的数据取出并交给网络层。不同的<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E5%8D%8F%E8%AE%AE/23135815?fromModule=lemma_inlink" title="数据链路层协议">数据链路层协议</a>对应着不同的帧，所以，帧有多种，比如 <strong>PPP 帧</strong>、<strong>MAC 帧</strong>等，其具体格式也不尽相同。</p>
<p><strong>不要和之前讲的使用点对点信道的 PPP 帧格式（广域网范畴）混为一谈！！！！</strong></p>
</blockquote>
<p>如图，这里只介绍使用最多的以太网 V2 的 MAC 帧格式   （假定网络层使用的是 IP 协议，实际上其他的也行）</p>
<p><img src="./imgs/5756b2a3ef7a47a69f01fbff9de5cb9e.png" alt=""></p>
<blockquote>
<ol>
<li>
<p>从图中可以看出，以太网 V2 的 MAC 帧由五个字段组成，前两个字段分别为 6 字节长的目的地址和源地址字段。第三个字段是 2 字节长的类型字段（用来标志上一层使用的是什么协议，以便把收到的 MAC 帧的数据上交给上一层的这个协议【例如：当类型字段的值是 0x0800 时，就表示上层协议是 IP 协议】） ，第四个字段是数据字段（最小长度 64 字节 - 18 字节的首部和尾部 = 数据字段的最小长度 ）， 最后一个字段是 4 字节的帧检验序列 FCS（使用 CRC 检验）。</p>
</li>
<li>
<p>若数据字段的长度小于 46 字节，封装成帧时就会在数据字段的后面加入整数字节的<strong>填充字段</strong>，以保证以太网的 MAC 帧长不小于 64 字节。</p>
</li>
<li>
<p>MAC 帧的首部并没有指出数据字段的长度是多少。在有填充字段的情况下，接收端的数据链路层在剥去首部和尾部后就把数据字段和填充字段一起交给上层协议。但这完全不必担心，上层协议具有识别有效的数据字段长度的功能。例如，当上层使用 IP 协议时，其首部就有一个 “总长度” 字段。</p>
</li>
<li>
<p><strong>MAC 帧中没有帧结束定界符</strong>。由于以太网使用<strong>曼彻斯特编码</strong>，当 MAC 帧发送完毕后，适配器的接口上就不再有电压变化，接收方可以很容易地找到 MAC 帧的结束位置。</p>
</li>
<li>
<p><strong>插入的 8</strong> <strong>字节比特流</strong>由两个字段构成，第一个字段占 7 个字节，叫做<strong>前同步码</strong>，用来使接收端适配器在接收 MAC 帧时迅速实现位同步。第二个字段是<strong>帧开始定界符</strong>，表示后面的信息就是 MAC 帧。（从<strong>数据链路层向下传到物理层时</strong>需要在帧的前面插入 8 字节比特流）。</p>
</li>
<li>
<p>由于 MAC 帧之间有一定的间隔，因此接收端只要找到帧开始定界符，其后连续到达的比特流就都属于同一个 MAC 帧。所以<strong>以太网不需要使用帧结束定界符</strong>，也不需要使用字节填充来保证透明传输。</p>
</li>
</ol>
</blockquote>
<p><strong>以下为无效的 MAC 帧：</strong></p>
<ul>
<li><strong>帧的长度不是整数个字节</strong></li>
<li><strong>用帧检验序列</strong> <strong>FCS</strong> <strong>查出有差错</strong></li>
<li>帧的数据字段的长度不在 46 ~ 1500 字节之间（有效的 MAC 帧长度为64 ~ 1518 字节之间）</li>
</ul>
<p><strong>接收方</strong> <strong>对于</strong> <strong>检查出的无效</strong> <strong>MAC</strong> <strong>帧就简单地丢弃</strong> <strong>。</strong></p>
<h3 id="5-扩展的以太网">5  扩展的以太网</h3>
<p>在许多情况下，我们希望把以太网的覆盖范围扩展。</p>
<h4 id="在物理层扩展以太网">在物理层扩展以太网</h4>
<p>现在，扩展以太网和集线器之间的距离的一种简单方法就是使用光纤和一对光纤调制解调器。</p>
<p><img src="./imgs/81a7869b864b4edfbeebf31ca51448c1.png" alt=""></p>
<p>注：光纤调制解调器的作用是进行电信号和光信号的转换。</p>
<p>当以此为基础，使用多个集线器，就可以构成覆盖范围更大的多级星形结构的以太网。</p>
<p><img src="./imgs/6947e3af0a71495daf2e1405664448df.png" alt=""></p>
<blockquote>
<p><strong>用集线器扩展以太网的优点</strong></p>
<ol>
<li>使不同系的以太网上的计算机能够进行跨系的通信。</li>
<li>扩大了以太网覆盖的地理范围。</li>
</ol>
<p><strong>用集线器扩展以太网的缺点</strong></p>
<ol>
<li>扩展后网络的带宽并未提高，但网络中主机的数目增加，使每台主机分到的带宽降低。</li>
<li>如果不同系的以太网使用不同的数据率，那么就不能用集线器将它们互连起来。</li>
</ol>
<p>注：</p>
<p><strong>碰撞域又称为冲突域</strong>。<strong>在任一时刻，一个碰撞域中只能有一个站在发送数据。（之前讲的 CSMA/CD 协议里面就有碰撞检测）</strong></p>
</blockquote>
<h4 id="在数据链路层扩展以太网">在数据链路层扩展以太网</h4>
<p>扩展以太网更常用的方法是在数据链路层进行。最初人们使用的是 <a href="https://blog.csdn.net/qq_42248536/article/details/118927515?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168100800516800192233385%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168100800516800192233385&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-118927515-null-null.142%5Ev82%5Einsert_down38,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&amp;utm_term=%E7%BD%91%E6%A1%A5&amp;spm=1018.2226.3001.4187" title=" 网桥 ">网桥</a>  （需要了解点击），但后续交换式集线器（以太网交换机或第二层交换机）的问世，很快就淘汰了网桥，因此这里就介绍以太网交换机就 Ok 了。</p>
<blockquote>
<ol>
<li>以太网交换机实质上就是一个多端口的网桥，通常都有十几个或更多的端口。</li>
<li>以太网交换机的每个端口都直接与一台主机或另一个以太网交换机相连，并且一般都工作在全双工方式。</li>
<li>以太网交换机具有并行性，能同时连通多对接口，使多对主机能同时通信（而网桥只能一次分析和转发一个帧）。相互通信的主机都是独占传输媒体，无碰撞地传输数据，同时不再使用 CSMA/CD 协议。</li>
<li>交换机连接的两个主机可以是不同网络号，因此也可以连接到不同的多个路由器上。</li>
</ol>
</blockquote>
<p>和之间的在物理层用集线器扩展对比，以太网交换机逐渐占据它的市场。</p>
<blockquote>
<p>例如：</p>
<p>对于传统的 10 Mbit/s 的 共享式 以太网，若共有 N 个用户，则每个用户占有的平均带宽只有总 带宽的 1 / N 。 使用以太网交换机时 ， 假如 每个 接口到主机的带宽还是 10 Mbit/s ，由于每一 个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽， 因此每个用户的带宽还是 10 Mbit/s 。这正是交换机的最大优点 。 <strong>以太网</strong> <strong>交换机</strong> <strong>的每个接口都是一个碰撞域</strong> <img src="./imgs/b946023552364c2db0ea60f8a00cdbb6.png" alt=""> ⚠️⚠️⚠️：这里集线器的出现只是为了说明   以太网 交换机 的每个接口都是一个碰撞域，上述那个【例如】的例子成立是建立在以太网交换机每个端口直接和主机连接，中间可没有集线器，不要因为看到这张图而与上面的在物理层 使用集线器扩展以太网的情况混淆了哦 ~</p>
</blockquote>
<p><strong>以太网交换机的自学习功能</strong></p>
<p>以太网交换机是一种即插即用设备，其内部的帧交换表（又叫地址表）是通过自学习算法自动地逐渐建立起来的。</p>
<ol>
<li>
<p><strong>开始时，以太网交换机里面的交换表是空的。</strong><img src="./imgs/756ebd7b399f4fa19eda9942f51d6fc0.png" alt=""></p>
</li>
<li>
<p><strong>交换机</strong>收到一个帧<strong>后先进行</strong>自学习：查找<strong>交换表</strong>中有没有与收到的帧****的****源地址相匹配的项目。** <strong>。如没有，就在交换表中增加一</strong> <strong>个新项目：将源地址写入</strong> <strong>MAC</strong> <strong>地址列，将进入</strong> <strong>的</strong> <strong>接口写入接口列，并设置有效时间。</strong> <strong>。如有，则把原有的项目进行更新</strong> <strong>（接口</strong> <strong>和</strong> <strong>有效时间</strong> <strong>）</strong> <strong>。</strong></p>
<p>3.  <strong>然后转发这个帧：查找交换表中有没有与收到的帧的目的地址相匹配的项目。</strong></p>
</li>
</ol>
<p>。 <strong>如</strong> <strong>没有，则</strong> <strong>向</strong> <strong>除</strong> <strong>进入接口外</strong> <strong>的所有</strong> <strong>其他</strong> <strong>接口转发这个帧。</strong></p>
<p>。 <strong>如有</strong> <strong>，则还要判断项目中给出的接口是否是该帧进入交换机的接口。如果不是，则按项目中</strong> <strong>给出的接口进行</strong> <strong>转发；若是，则应丢弃</strong> <strong>这个帧（因为这时不</strong> <strong>需要交换机转发）。</strong></p>
<p>总结上述过程：</p>
<p><img src="./imgs/303721ab4f464681b71b84906497b048.png" alt=""></p>
<p>以太网交换机中的 MAC 地址和接口很好理解，那这个有效时间的作用是什么呢？</p>
<p><img src="./imgs/3b399d99601549158ef38340c651f0a7.png" alt=""></p>
<p><strong>随堂练习：</strong></p>
<p><img src="./imgs/658a7bae189849a0afbd26ac2cc6e373.jpeg" alt=""></p>
<p>扩充知识（补充了解，不需要掌握）：</p>
<p>为了避免单点故障，以太网中往往会增加一些冗余的链路。此时，自学习的过程就可能导致以太网帧在网络的某个环路中无限制地兜圈子。</p>
<p>为了解决这种兜圈子的问题，IEEE 的 802.1D 标准制定了一个生成树协议 STP(Spanning Tree Protocol)。</p>
<p>STP 不改变网络的实际拓扑结构，但在逻辑上则切断某些链路以消除网络中的环路，使网络在逻辑上变成树状拓扑，从而消除了兜圈子的现象。一旦出现单点故障， STP 会检测到网络拓扑结构的变化，此时 STP 会恢复冗余的链路并重新生成一个无环路的树状结构。</p>
<p>从总线以太网到星形以太网：</p>
<p>总线以太网使用 CSMA/CD 协议，以半双工方式通信。但以太网交换机不使用共享总线，没有碰撞问题，因此不使用 CSMA/CD 协议，而是以全双工方式工作。既然连以太网的重要协议 CSMA/CD 都没有，为什么还叫作以太网呢？</p>
<p>原因就是它的帧结构未改变，仍然采用以太网的帧结构。</p>
<h4 id="虚拟局域网">虚拟局域网</h4>
<p>我们学校不掌握，这里就简要的介绍一下吧。</p>
<p>前瞻：</p>
<p>一个以太网是一个广播域，即以太网中任何一台设备发出的广播帧都能被该网络中的所有其他设备所接收。</p>
<p>一个单位的以太网往往为几个部门所共享，但有些部门的信息是需要保密的（例如财务、人事），许多部门共享一个局域网对信息安全不利。</p>
<p>利用以太网交换机可以很方便、灵活地建立虚拟局域网 VLAN (Virtual LAN)，从而把一个较大的局域网，分割成一些较小的局域网。<strong>使用虚拟**<strong>局域网不但可使广播域范围缩小，还能提高整个局域网的安全性。*</strong>*虚拟局域网**<strong>其实只是局域网给用户提供的一种*</strong>*服务**</strong>（或*<strong>*功能**</strong>），****而****并不是一种新型局域网。**</p>
<blockquote>
<p>虚拟局域网协议允许在以太网的帧格式中插入一个 4 字节的标识符，称为 VLAN 标签 (tag)，用来指明发送该帧的计算机属于哪一个虚拟局域网。插入 VLAN 标签的帧称为 802.1Q 帧。</p>
<p><img src="./imgs/fb01689c79ac4f51abfe4f2b6b936363.png" alt=""></p>
<hr>
<ul>
<li>一个虚拟局域网的范围可以跨越多个交换机。划分虚拟局域网的方法有很多种，最常用的是按交换机的接口划分。</li>
<li>每台主机都是通过接入链路（access link）连接到交换机的，但主机并不知道 VLAN 的存在，它们发往交换机的帧都是标准以太网帧。</li>
<li>两台交换机之间的链路称为汇聚链路（trunk link）。只有在汇聚链路上才会使用 802.1Q 帧  。<img src="./imgs/bd5811ac4f844327b01b6d115d59ac04.png" alt=""></li>
</ul>
<p>需要更多相关知识的学习，请自行查阅其他博客哦。</p>
</blockquote>
<h3 id="6-高速以太网">6  高速以太网</h3>
<p>随着电子技术的发展，以太网的速率也不断提升。从传统的 10 Mbit/s 以太网一直发展到现在常用的速率为 1 Gbit/s 的吉比特以太网，甚至更快的以太网。下面简单介绍几种高速以太网技术。</p>
<h4 id="100base-t-以太网">100BASE-T 以太网</h4>
<p>速率达到或超过 100 Mbit/s 的以太网称为高速以太网。</p>
<p>100BASE-T 是在双绞线上传送 100 Mbit/s 基带信号的星形拓扑以太网，又称为快速以太网。</p>
<ul>
<li>快速以太网的 MAC 帧格式仍然是以太网 V2 的帧格式。</li>
<li>100 Mbit/s 以太网的物理层标准：（了解就行）</li>
</ul>
<p>。 100BASE-TX ： 2 对 UTP 5 类线或屏蔽 双绞线</p>
<p>。 100BASE-T4 ： 4 对 UTP 3 类线或 5 类 线</p>
<p>。 100BASE-FX ： 1 对 光纤，发送和接收各用一根</p>
<blockquote>
<p>几个必记的知识点：</p>
<ol>
<li>快速以太网可在全双工方式下工作而无冲突发生，此时不使用 CSMA/CD 协议（使用以太网交换机）；若在半双工方式工作，则一定要使用 CSMA/CD 协议。</li>
<li>快速以太网保持最短有效帧长 64 字节不变，争用期由原来的 51.2 <strong>µs</strong>   变为 5.12 <strong>µs</strong> ，帧间最小间隔由原来的 9.6 <strong>µs</strong>   变为现在的 0.96 <strong>µs</strong> 。都是 10Mbit/s 以太网的 1/10。</li>
<li>快速以太网使用的 MAC 帧格式是 IEEE802.3 标准规定的帧格式，然而其标准并未包括对同轴电缆的支持，这就意味着想从细缆以太网升级到快速以太网的用户必须重新布线。</li>
</ol>
</blockquote>
<h4 id="吉比特以太网">  吉比特以太网</h4>
<blockquote>
<p>重要知识点：</p>
<ol>
<li><strong>允许在</strong> <strong>1</strong> <strong>Gbit/s</strong> 下以全双工和半双工两种方式工作。</li>
<li><strong>使用</strong>以太网 <strong>V2</strong> <strong>的</strong>帧格式。（<strong>书上说的是 IEEE802.3 协议的帧格式，但正如上面所说的这两种区别不大，可以互相交换的</strong>）</li>
<li><strong>在半双工方式下使用</strong> <strong>CSMA/CD</strong> <strong>协议，在全</strong>双工方式不使用 <strong>CSMA/CD</strong> <strong>协议。</strong></li>
<li><strong>与</strong> <strong>10BASE-T</strong> <strong>和</strong> <strong>100BASE-T</strong> <strong>兼容。</strong></li>
</ol>
</blockquote>
<p>吉比特以太网的物理层标准：（了解就行）</p>
<p>。1000BASE-SX ：多模光纤</p>
<p>。1000BASE-LX ：单模光纤 / 多模光纤</p>
<p>。1000BASE-CX ： 2 对 屏蔽 双绞线（最大长度 25m ）</p>
<p>。1000BASE-T ： 使用 4 对 UTP 5 类线</p>
<blockquote>
<p>吉比特以太网交换机可以直接与多个图形工作站相连，也可以作百兆以太网的主干网，与百兆比特或吉比特交换机相连，然后再和大型服务器连接在一起，如图示例：</p>
<p><img src="./imgs/cf6d21067ea2440e9d1a60853401fcc8.png" alt=""></p>
</blockquote>
<p>扩充：</p>
<p><strong>10</strong> <strong>吉比特以太网与</strong> <strong>10</strong> <strong>Mbit/s</strong>，<strong>100</strong> <strong>Mbit/s</strong> <strong>和</strong> <strong>1</strong> <strong>Gbit/s</strong> <strong>以太网的帧格式完全</strong>相同，并保留了 <strong>64</strong> <strong>字节的最短有效帧长，以便保持兼容性。</strong></p>
<p><strong>10</strong> <strong>吉比特以太网</strong>只工作在全双工方式，因此不存在争用问题，也不使用 CSMA/CD 协议。</p>
<p>10 吉 比特 以太网的物理层标准 ：（了解就行）</p>
<p>。 10GBASE-SR ：多模光纤</p>
<p>。 10GBASE-LR ：单模光纤</p>
<p>。 10GBASE-ER ：单模光纤</p>
<p>。 10GBASE-CX4 ： 4 对 双芯同轴电缆</p>
<p>。 10GBASE-T ： 4 对 6A 类 UTP 双绞线</p>
<h2 id="第四章-网络层">第四章 网络层</h2>
<blockquote>
<p><a href="https://so.csdn.net/so/search?q=%E7%BD%91%E7%BB%9C%E5%B1%82&amp;spm=1001.2101.3001.7020">网络层</a>（network layer）是 OSI 模型的第三层。它是 OSI 参考模型中最复杂的一层，也是通信子网的最高层，它在下两层的基础上向资源子网提供服务。网络层的主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务【实现两个不同网络系统之间的数据透明传输】。它通过路由选择算法，为分组通过通信子网选择最适当的路径，以实现网络的<a href="https://baike.baidu.com/item/%E4%BA%92%E8%BF%9E/5922473?fromModule=lemma_inlink" title="互连">互连</a>功能。具体地说，数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、<a href="https://baike.baidu.com/item/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/3441910?fromModule=lemma_inlink" title="流量控制">流量控制</a>、<a href="https://baike.baidu.com/item/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6/732651?fromModule=lemma_inlink" title="拥塞控制">拥塞控制</a>等将信息从一台网络设备传送到另一台网络设备。网络层负责在网络中传送的数据单元是分组或包。</p>
</blockquote>
<p>网络层是 <a href="https://baike.baidu.com/item/OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/708028?fromModule=lemma_inlink" title="OSI参考模型">OSI 参考模型</a>中的第三层，介于<a href="https://baike.baidu.com/item/%E4%BC%A0%E8%BE%93%E5%B1%82/4329536?fromModule=lemma_inlink" title="传输层">传输层</a>和<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/4329290?fromModule=lemma_inlink" title="数据链路层">数据链路层</a>之间，它在链路数据层提供的两个相邻端点之间的<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%B8%A7/10571824?fromModule=lemma_inlink" title="数据帧">数据帧</a>的传送功能上，进一步管理网络中的<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/897073?fromModule=lemma_inlink" title="数据通信">数据通信</a>，将数据设法从源端经过若干个中间节点传送到目的端，从而向传输层提供最基本的端到端的<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81/500685?fromModule=lemma_inlink" title="数据传送">数据传送</a>服务。</p>
<p>网络层主要是为传输层提供服务，为了向传输层提供服务，则网络层必须要使用<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/4329290?fromModule=lemma_inlink" title="数据链路层">数据链路层</a>提供的服务。而数据链路层的主要作用是负责解决两个直接<a href="https://baike.baidu.com/item/%E7%9B%B8%E9%82%BB%E8%8A%82%E7%82%B9/22061788?fromModule=lemma_inlink" title="相邻节点">相邻节点</a>之间的通信，但并不负责解决数据经过<a href="https://baike.baidu.com/item/%E9%80%9A%E4%BF%A1%E5%AD%90%E7%BD%91/10999928?fromModule=lemma_inlink" title="通信子网">通信子网</a>中多个转接节点时的通信问题，因此，为了实现两个端系统之间的数据透明传送，让源端的数据能够以最佳路径透明地通过通信子网中的多个转接节点到达目的端，使得传输层不必关心网络的拓扑构型以及所使用的<a href="https://baike.baidu.com/item/%E9%80%9A%E4%BF%A1%E4%BB%8B%E8%B4%A8/2016628?fromModule=lemma_inlink" title="通信介质">通信介质</a>和交换技术，网络层需要具备如下功能。后续会详细的逐一介绍它的具体功能~</p>
<blockquote>
<p>我们知道如果只是同一局域网内的各个计算机之间的通信，单靠物理层和数据链路层就可以建立起主机间通信链路完成用户间的数据通信（这里强调的是信息交付到主机的应用进程前的通信过程，别以为只需要这两层就完了，它上面的三层只是在这里不明显强调而已），但要扩大应用范围，连接不同的局域子网，就需要借助网络层处理各个网络子网的协议【这里值得一提的是：如果一个网络中的用户不能识别其他网络的<a href="https://so.csdn.net/so/search?q=%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE&amp;spm=1001.2101.3001.7020" title="通信协议">通信协议</a>和地址规范，那么这两个网络之间就不能进行数据通信】，从而进行计算机的网络互连【不同网络之间进行访问不能通过属于数据链路层地址的 MAC 地址来进行寻址，这需要通过网络层对应的网络地址来进行访问】。</p>
<p><img src="./imgs/3bf75877342349f6a1ca2d72016f9d17.png" alt=""></p>
<hr>
<p>这里要注意区分【相邻节点间】和【端点间】的区别。</p>
<p>这里的节点：可以是运行在数据链路层协议的任何设备，包括主机、路由器、交换机、集线器等</p>
<p>这里的端点：不能和后面要介绍的运输层的 “ <a href="https://baike.baidu.com/item/%E7%AB%AF%E5%88%B0%E7%AB%AF/8851783?fromModule=lemma_inlink" title="端到端">端到端</a>的可靠通信 ” 中端点含义混为一谈，这里的端点强调的是主机，运输层的端点强调的是应用进程，因为严格来讲，IP 协议虽然能把分组送到目的主机，但是这个分组还停留在主机的网络层而没有交付到主机中的应用进程，后序请期待运输层更新~。</p>
</blockquote>
<blockquote>
<p>之前在第一章概述部分就谈到了节点</p>
<p><img src="./imgs/42a7c1d9ca9447159c0a975b455664ff.png" alt=""></p>
</blockquote>
<p>最后更值得一提的是：网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。因此，网络层不提供服务质量的承诺，不保证分组交付的时限，所转送的分组可能出错、丢失、重复和失序。进程之间通信的可靠性由运输层负责。</p>
<h3 id="一网络层的几个重要概念">一、网络层的几个重要概念</h3>
<h4 id="11-网络层提供的两种服务">1.1 网络层提供的两种服务</h4>
<p>在计算机网络领域，网络层应该向运输层提供怎样的服务（“面向连接” 还是 “无连接”）曾引起长期的争论。</p>
<p>而争论焦点的实质就是：在计算机通信中，可靠交付应当由谁来负责？是网络还是端系统？</p>
<p>（1）虚电路服务</p>
<p>一种观点认为应当让网络负责可靠交付。当两台计算机通信时，应当先建立一条虚电路，以预留一定的网络资源；然后再使用可靠传输的网络协议，就能实现可靠交付。</p>
<blockquote>
<p>虚电路只是一条 逻辑上 的连接，分组都沿着这条逻辑连接按照 存储转发 方式传送，而并不是真正建立了一条物理连接。 <img src="./imgs/9e4c81cc2a614c92a224599c4f2ed1f4.png" alt=""></p>
<p>虚电路服务与下面要介绍的另一种观点——数据报服务 ，是相补的，对二者的选择取决于应用背景。但是目前现代网络层协议已主要使用后者了~</p>
</blockquote>
<p>（2）数据报服务</p>
<p>另一种观点认为，网络层应尽量简单，向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。 </p>
<blockquote>
<p>网络在发送分组时不需要先建立连接。每一个分组（即 IP 数据报）独立发送，与其前后的分组无关（不进行编号）。 网络层不提供服务质量的 承诺 ， 所 传送的分组可能出错、丢失、重复和失序（不按序到达终点），当然也不保证 分组 交付 的时限。 <img src="./imgs/62f7570d0e854448bbb5879c629025e5.png" alt=""></p>
<p>当然这种方式肯定有它的好处：</p>
<p>① 网络中的路由器可以做得比较简单，而且价格低廉。</p>
<p>② 如果主机（即端系统）中的进程之间需要可靠通信，那么就由主机中的运输层负责（包括差错处理、流量控制等）。</p>
<p>③ 网络的造价大大降低，运行方式十分灵活，能够适应多种应用。</p>
<p>④ 促进了互联网的发展。</p>
<p><img src="./imgs/eee34e9402cc4412817e1e9b23c43f3e.png" alt=""></p>
</blockquote>
<p> 两者对比：</p>
<p><img src="./imgs/e266d8c4dcfd466fa38bee9b5b29bcd4.png" alt=""></p>
<h4 id="12-网络层的两个层面">1.2 网络层的两个层面</h4>
<p>路由表用来决策最佳路由 ； 转发表用来转发分组</p>
<p>前瞻：不同网络中的两个主机之间的通信，要经过若干个路由器转发分组来完成。路由器查找转发表，将分组从指明的接口转发到下一个路由器。</p>
<p><strong>转发表是从</strong>路由表得出的，而路由表又是由互联网中许多的路由器通过不断交换路由信息产生的。在路由器之间传送的信息有以下2大类：</p>
<p>（1）转发源主机和目的主机之间所传送的数据   （2）路由信息（为数据传送服务）</p>
<p>二者~的具体介绍：见 p117~</p>
<p>可以把网络层抽象地划分为数据层面和控制层面。</p>
<table border="1" cellpadding="1" cellspacing="1" style="width:668px;"><tbody><tr><td style="width:312px;"><strong>数据层面</strong></td><td style="width:355px;"><strong>控制层面</strong></td></tr><tr><td style="width:312px;"><p></p><p>●&nbsp;<strong>路由器根据本路由器生成的</strong><strong>转发表，</strong><strong>把收到的分组从查找到的对应接口</strong><strong>转发</strong><strong>出去。</strong></p><p>●&nbsp;<strong>每个路由器</strong><strong>独立</strong><strong>工作。</strong></p><p>●&nbsp;<strong>采用</strong><strong>硬件</strong><strong>进行转发，速度快。</strong></p></td><td style="width:355px;">●&nbsp; <strong>根据路由选择协议所用的路由算法</strong> <strong>计算路由，&nbsp;</strong> <strong>创建出本路由器的</strong> <strong>路由表。</strong> ●&nbsp;&nbsp; <strong>许多路由器</strong> <strong>协同</strong> <strong>动作。</strong> ●&nbsp;&nbsp; <strong>采用</strong> <strong>软件</strong> <strong>计算，速度慢。</strong></td></tr></tbody></table>
<p> 图解上述两个层面：</p>
<p><img src="./imgs/16fa149bb8f04df89c03a1efb0c96ddd.png" alt=""></p>
<p>路由器的路由选择和分组转发分别处于上述控制层面和数据层面之中（实际上这两种的实现都是在路由器内部完成）。</p>
<p>这里用 ” 控制层面和数据层面 “ 这种概念进行划分，是因为最近网络界提出的：软件定义网络 SDN</p>
<p><img src="./imgs/e5fafe786f6e4a438adadf5c54518141.png" alt=""></p>
<p>上面这两张图区别在于前者每个路由器既有转发表又有路由选择软件【图中可以看出】，后者所有路由器都变得更加简单了（它的路由选择软件不存在），因此路由器之间不在交换路由信息（路由表由远程控制器生成）。当然这种集中控制的网络好处有些，但传统的前者分散控制的网络也有它所不及的优点，因此相铺相成吧。</p>
<h3 id="二网际协议-ip">二、网际协议 IP</h3>
<p><strong>网际协议</strong> <strong>IP</strong> <strong>(Internet Protocol)</strong> 是 TCP/IP 体系结构中两个最主要的协议之一。与 IP 协议配套使用的还有三个协议：</p>
<p>（1） <strong>地址解析协议</strong> ARP (Address Resolution Protocol)</p>
<p>（2） <strong>网际控制报文协议</strong> ICMP (Internet Control Message Protocol)</p>
<p>（3） <strong>网际组管理协议</strong> IGMP (Internet Group Management Protocol)</p>
<blockquote>
<p>这里对于 ICMP 、 IGMP  和 ARP 介绍 及 于 IP 协议的联系后文会陆续介绍~（这里前两个协议画在上面，ARP 画在下面都是有它们的理由……） </p>
<p><img src="./imgs/4b2a56407fbe44f6b59cfe636c94f00b.png" alt=""></p>
</blockquote>
<h4 id="21-虚拟互连网络">2.1 虚拟互连网络</h4>
<p>将网络互相连接起来需要使用一些中间设备：</p>
<p>（1） <strong>在物理层使用</strong> <strong>转发器</strong> <strong>(repeater)</strong> <strong>或</strong> <strong>集线器</strong> <strong>(hub)</strong> <strong>。</strong></p>
<p>（2） <strong>在数据链路层使用</strong> <strong>网桥</strong> <strong>(bridge)</strong> <strong>或</strong> <strong>交换机</strong> <strong>(switch)</strong> <strong>。</strong></p>
<p>（3） <strong>在网络层使用</strong> <strong>路由器</strong> <strong>(router)</strong> <strong>。</strong></p>
<p>（4） <strong>在网络层以上使用</strong> <strong>网关</strong> <strong>(gateway)</strong> <strong>。</strong></p>
<p>我们知道：当中间设备是物理层或数据链路层设备时，一般并不称之为网络互连，因为这仅仅是把一个网络扩大了，在网络层看来仍然是一个网络。  而网络互连是指用路由器将不同的网络连接起来。</p>
<p>当参加互连的计算机网络都使用相同的网际协议 IP 时, 可以把互连以后的计算机网络看成一个虚拟互连网络——各种物理网络的差异性被屏蔽，在网络层上看起来好像是一个统一的网络。</p>
<blockquote>
<p>而这种使用 IP 协议的虚拟互连网络又称为虚拟 IP 网。现在的互联网（Internet）就是这种虚拟 IP 网（上层使用 TCP 协议）。</p>
<p><img src="./imgs/2a87fc5a12534232a2c7bd9e16faf160.png" alt=""></p>
</blockquote>
<h4 id="22-ip-地址">2.2  IP 地址</h4>
<p>在 TCP/IP 体系中，IP 地址是一个基本概念。一个连接在互联网上的设备，如果没有 IP 地址，就无法和网上的其他设备进行通信。因此这就是重点！！</p>
<h5 id="221-ip-地址及其表示方法">2.2.1 IP 地址及其表示方法</h5>
<p>整个互联网是一个单一的、抽象的网络，IP 地址就是给每个连接在互联网上的主机（或路由器）的每一个接口分配的一个在全世界范围内唯一的 32 位的标识符。（IP 地址由互联网名字和数字分配机构 ICANN (Internet Corporation for Assigned Names and Numbers) 进行分配。）</p>
<p> 为了便于人的书写和记忆，我们常采用点分十进制记法表示：</p>
<p><img src="./imgs/c26e38a448d5459a87d451c8f69b3308.png" alt=""></p>
<p>IP 地址采用两级结构，由两个字段组成。第一个字段是网络号，它标志主机（或路由器）所连接到的网络；第二个字段是主机号，它标志该主机（或路由器）。</p>
<blockquote>
<p>IP 地址可记为：</p>
<p><img src="./imgs/c58858b7966748d3b12acfd139b73b0a.png" alt=""></p>
<p>符号 “::=” 表示 “定义为”。从 IP 地址的结构可以看出，IP 地址指明了连接到某个网络上的一台主机（或路由器）。</p>
</blockquote>
<p>IP地址规定：前 n 位是主机所连接的网络号，后 (32 - n) 位是主机号。</p>
<p><img src="./imgs/ddf0b1da8d0643baa312da34729887d7.png" alt=""></p>
<p> 但是当计算机或路由器获得一个 IP 地址时，怎样知道它的网络号的数 n 是多少？</p>
<h5 id="222分类的-ip-地址">2.2.2 分类的 IP 地址</h5>
<p>在互联网发展早期采用的是分类的 IP 地址：</p>
<p><img src="./imgs/0f6de5d895624c8e9c9ebd52b2b63f8e.png" alt=""></p>
<p> ⚠️⚠️⚠️：（一些特殊的不指派的 IP 地址）</p>
<p>（1）网络号全0和127（01111111）是保留地址，不进行指派。全 0表示 “本网络”，127保留作为本地环回测试地址。</p>
<p>（2）全0和全1的主机号一般不指派。主机号为全0的IP地址表示该网络的地址；主机号为全1的 IP 地址表示该网络上的所有主机，是该网络的广播地址，用于给同一个链路中相互连接的所有主机发送数据包 (此时目的地址当然就被设为了广播地址)</p>
<p>（3） 0.0.0.0 标识本机上的所有网卡。用与 TCP 服务端程序的绑定地址，相当于监听本机的所有网卡。</p>
<p><img src="./imgs/220b44c191c648cebb7a170f78375b61.png" alt=""></p>
<p>因此根据上面的信息也就不难理解下面这个表格了：</p>
<p><img src="./imgs/6cbe3ff68b7146af9df5efecdad7a35d.png" alt=""></p>
<p>当然分类的 IP 地址不够灵活，会造成 IP 地址资源的浪费，于是新的无分类编址方法取代了分类的 IP 地址。</p>
<h5 id="223无分类编址-cidr-重点">2.2.3 无分类编址 CIDR （重点）</h5>
<p>无分类编址的全名是无分类域间路由选择 CIDR，它把 IP 地址划分为前后两个部分，前面部分是 “网络前缀”(network-prefix)，用来指明网络；后面部分是主机号，用来指明主机。</p>
<blockquote>
<p>在使用 CIDR 编址时，IP 地址的定义及示意图如下：</p>
<p><img src="./imgs/1a8679b019f3437da49cca6851420508.png" alt=""></p>
<p>在 CIDR 编址中，网络前缀的位数 n 不固定，可以在 0 ~ 32 之间任意选取。</p>
</blockquote>
<p>CIDR 使用 “斜线记法”(slash notation)，或称为 CIDR 记法，即在 IP 地址后面加上一个斜线 “/”，斜线后面写上网络前缀所占的位数。例如：128.14.35.7/20，前 20 位是网络前缀（相当于原来的网络号），剩下 12 位是主机号。 </p>
<blockquote>
<p>CIDR 把网络前缀都相同的连续的 IP 地址组成一个 “CIDR 地址块”（即后文的构造超网）。一个 CIDR 地址块包含的 IP 地址数目，取决于网络前缀的位数。</p>
<p>举个栗子：</p>
<p>假设 128.14.35.7/20 是某 CIDR 地址块中的一个地址。则此地址块的起始地址（即最小地址）是 128.14.32.0，最大地址是 128.14.47.255，此地址块可记为 128.14.32.0/20，即用地址块中的最小地址和网络前缀的位数指明一个地址块。</p>
<p>128.14.32.0/20 表示的地址块共有 <img src="./imgs/eq.png" alt=""> 个地址，但主机号全 0 和全 1 的地址不指派。</p>
<p><img src="./imgs/b4fd3554a9244190bf1ed39b24b19acd.png" alt="">上述中：<strong>128.14.35.7</strong> 是 IP 地址，但未指明网络前缀长度，因此不知道其网络地址；128.14.35.7/20 也是 IP 地址，且同时指明了网络前缀为 20 位，由此可算出网络地址；128.14.32.0 /20 是包含多个 IP 地址的地址块或网络地址，同时也是这个地址块中主机号为全 0 的 IP 地址。</p>
<p>在不需要指明网络地址，或仅仅指出地址块的大小时，可将地址块简称为 “/n 地址块”。</p>
</blockquote>
<p>斜线记法可以让我们很方便知道网络前缀的数值，但计算机不理解啊，因此计算机采用地址掩码来算 IP 地址对应的网络地址：</p>
<p>● 计算机使用 32 位的地址掩码 (address mask) 以便从 IP 地址迅速算出网络地址。地址掩码又称为子网掩码。</p>
<p>● 地址掩码由一连串 1 和一连串 0 组成，而 1 的个数就是网络前缀的长度。CIDR 记法中斜线后面的数字就是地址掩码中 1 的个数。   </p>
<p>● 对于 /20 地址块，它的地址掩码是 20 个连续的 1 和 12 个连续的 0。这个掩码用点分十进制表示就是 255.255.240.0。</p>
<blockquote>
<p>把二进制的 IP 地址和地址掩码进行按位AND 运算，即可得出网络地址：</p>
<p><img src="./imgs/197545979cdc4beb846ad8c6ea83d86d.png" alt=""></p>
<p>就是只有双方都是 1 才为 1，否则都为 0。</p>
<p>栗子：</p>
<p><img src="./imgs/5d6f1a22488f4ac7b2d311d1c9555d61.png" alt=""></p>
</blockquote>
<h5 id="224构造超网和划分子网-重点">2.2.4 构造超网和划分子网 （重点）</h5>
<p>在路由器的转发表中，如果几个连续的、小的 CIDR 地址块具有相同的下一跳路由器，则可以把这几个小的地址块合并成一个大的地址块，并用一个转发表项代替原来的多个转发表项。</p>
<p>这种方法称为路由聚合（也称为构造超网），可以大大压缩转发表所占的空间，减少查找转发表所需的时间。</p>
<blockquote>
<p>构造超网也要满足一下条件才行哦：</p>
<p>构造超网就是把某几个 <a href="https://so.csdn.net/so/search?q=CIDR&amp;spm=1001.2101.3001.7020">CIDR</a> 地址块合并起来，用一个更大的 CIDR 地址块来表示。这几个地址块可能大小不一，但只要满足以下条件就能合并：</p>
<p><strong>1)</strong> 这几个地址块中的 IP 地址在地址空间中必须连续；</p>
<p>**2）**这几个地址块中的 IP 地址的总个数一定是 2 的 n 次方；</p>
<p>**3）**这几个地址块中最小的 IP 地址和最大的 IP 地址一定要位于要构成的超网的内部边界。<br>
这样就可以用这些地址块都具有的相同的部分来作为网络前缀，其余的部分作为主机号，这个构造出来的超网就包括了主机号从全 0 到全 1 的 IP 地址。</p>
</blockquote>
<p>划分子网是构造超网的逆运算。因此这里我就只需要着重讲解子网的划分就行了（构造超网就是顺其自然的事了）。</p>
<blockquote>
<p>子网划分是通过借用 IP 地址的若干位主机位来充当子网地址，从而将原网络划分为若干子网而实现的。</p>
</blockquote>
<p>划分子网时，随着子网地址借用主机位数的增多，子网的数目随之增加，而每个子网中的可用主机数逐渐减少。以 C 类网络为例，原有 8 位主机位，2 的 8 次方即 256 个<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA%E5%9C%B0%E5%9D%80?fromModule=lemma_inlink" title="主机地址">主机地址</a>，默认<a href="https://baike.baidu.com/item/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81?fromModule=lemma_inlink" title="子网掩码">子网掩码</a> 255.255.255.0。借用 1 位主机位，产生 2 个子网，每个子网有 126 个主机地址；借用 2 位主机位，产生 4 个子网，每个子网有 62 个主机地址…… 每个子网中，第一个 IP 地址（即主机部分全部为 0 的 IP）和最后一个 IP（即主机部分全部为 1 的 IP）不能分配给主机使用，所以每个子网的可用 IP 地址数为总 IP 地址数量减 2；根据子网 ID 借用的主机位数，我们可以计算出划分的子网数、<a href="https://baike.baidu.com/item/%E6%8E%A9%E7%A0%81?fromModule=lemma_inlink" title="掩码">掩码</a>、每个子网主机数。</p>
<blockquote>
<p>至于划分子网为什么要向主机号字段借位，这里再给大家举一个栗子：</p>
</blockquote>
<p>假设 CIDR 地址块为 211.82.244.0/24, 我现在要划分为两个等长的子网，那么第一个子网的 ip 地址范围就是 211.82.244.00000000~211.82.244.01111111，第二个子网的 ip 地址范围就是 211.82.244.10000000~211.82.244.11111111。而第一个子网我们观察可以发现，其 ip 地址的前 25 位相同，所以可以写成 211.82.244.00000000/25 的形式，也就是 211.82.244.0/25, 第二个子网我们经过观察也能发现，其 ip 地址的前 25 位也相同，所以可以写成 211.82.244.10000000/25 的形式，也就是 211.82.244.128/25。这就是划分子网为何要向主机号字段借位的原因。（上面用红色标出的就是划分子网时借位的子网号：IP 地址 = 网络号 + 子网号 + 主机号）<br>
划分两个等长子网，需要向主机号字段借 1 位（分别可设为 0 和 1），划分 4 个等长子网，就需要向主机号字段借 2 位（分别可设为：00 ， 01 ， 10 ，11），依次类推。<br>
其实划分子网最复杂的地方是不等长划分，不过我们可以用等长划分来实现，比如：把一个网络划分为 1/2 、 1/4 、 1/8 、 1/8 的 4 个不等长子网（这里假设该超网的主机号数：256），可以先划分为两个等长子网（子网号分别为 0 和 1） ，把其中的一个分给第一个网络，剩下的 1/2 再进行等长划分（比如把子网号 1 再分成：子网号 10 和 子网号 11，即再借一位），把其中的一个分给第二个网络，再将剩下的 1/4 平分给网络三和网络四（比如把子网号 11 再分成：子网号 110 和 子网号 111，即再借一位 ）。</p>
<p>综合上述，这里看一道书上的例题和一道理清子网划分的例题和一道经典的考试例题：</p>
<blockquote>
<p>假定某 ISP 已拥有地址块 206.0.64.0/18（相当于 64 个 C 类网络），现在某大学需要 800 个 IP 地址。则该 ISP 可将这块超网进行子网划分，即可以划分出 1/16，即给该大学分配一个地址块：206 . 68 . 0 / 22（即向主机号借 4 位），然后接下来，就只需要再根据该大学分配到的地址块再进一步子网划分给各个系。</p>
<p><img src="./imgs/43d57c0e03354d3aa5a55016c74be8f5.png" alt=""></p>
<p> 注意：表中的星号 ***** 是一种常用的简写方式，表示星号后面的二进制主机号都省略了。</p>
<p>从上表可知要将该大学分配到的地址块按地址数的需要分配给这四个系的话。就需要把划分子网为：1/2 + 1/4 + 1/8 + 1/8 。要划到 1/8，说明就要借 3 位主机号，然后按照上面我讲的方法逐一划分就欧克了。</p>
<p>理清子网划分例题：</p>
<p><img src="./imgs/d4bc216d61a841db942e21dcd3117ecd.png" alt=""></p>
<p> 答案：</p>
<p><img src="./imgs/8100f946c040fbb639c5dad431006163.png" alt=""></p>
<p>这里有些同学可能就有疑惑了，为什么网络 1 需要 128 个 IP 地址呢？</p>
<p>这是因为 62 台主机需要 62 个 IP 地址，路由器接口也需要一个 IP 地址，那么网络中至少需要 63 个可分配的 IP 地址才行。但是如果网络中只有 64 个 IP 地址，去掉主机号全 0 和全 1 的，就只有 62 个可分配的 IP 地址（而我们需要 63 个啊），所以网络中至少需要 128 个 IP 地址，这样可分配的 IP 地址数目就是 126 个。</p>
<p>那为什么不是 65 个呢，我上文不是说了嘛！！，划分出的子网一定要是 2 的 n 次幂，所以就是 128 勒~</p>
<p>经典例题：（多多益善）</p>
<p><img src="./imgs/c2796a96a4ca4232a0f1710db7eae66e.png" alt=""></p>
<p>因为最后这三个子网合并成的该超网一定是从主机号全 0 到全 1 的，所以观察题目可知，这里就只需要考虑 8 位的主机位 和 7 位的主机位。</p>
<p>       192.168.9.<strong>10</strong>000000/26 ：子网号为：10<br>
  A <strong>192.168.9.0</strong>0000000/25  ：子网号：0<br>
  B <strong>192.168.9.00</strong>000000/26 ：子网号：00<br>
  C <strong>192.168.9.11</strong>000000/26：子网号：11<br>
  D <strong>192.168.9.110</strong>00000/27 ：子网号：110</p>
<p>当主机位是 8 位时，即 256 个主机数，此时可划分成：0 、10 、11 【即 1/2（128） + 1/4（64）+ 1/4（64）】。</p>
<p>所以排除：A 和 C。</p>
<p>当主机位是 7 位时，即 128 个主机数，此时可划分成：10 、 110 、 111【即 64 + 32 + 32】。</p>
<p>即排除：D。</p>
<p>那为什么 B 不行呢？</p>
<p>这很显然啊，要从 192.168.9.00000000 ~ 192.168.9.111111111</p>
<p>题目已经给了一个子网：192.168.9.<strong>10</strong>000000</p>
<p>所以如果加上 B 这个子网的话：<strong>192.168.9.00</strong>000000</p>
<p>那么还需要 01，11，因此已经四个子网了。所以选择 B 选项。</p>
</blockquote>
<p>终于讲完这个重点内容了，一定要认真体会理解୧꒰•̀ᴗ•́꒱୨</p>
<h5 id="225ip-地址的特点">2.2.5  IP 地址的特点</h5>
<p>IP 地址具有以下一些重要的特点：<br>
（1）**IP **地址由网络前缀和主机号两部分组成，这种两级结构的好处是：</p>
<p>●  第一， IP 地址管理机构在分配 IP 地址 时可以只 分配 网络前缀， 而剩下的主机号则由得到该 网络前缀的 单位自行分配。这样就方便了 IP 地址的管理。</p>
<p>●  第二， 路由器可以根据 目的 主机的网络前缀来 转发分组（而不 考虑主机 号），这样就可以 使转发表 中的项目数大幅度减少，从而 减少转发表 所占的存储空间，缩短查找转发表的时间。</p>
<p>（2）<strong>IP</strong> 地址标识一台主机（或路由器）和一条链路的接口。</p>
<p>●  当一台 主机 同时连接到两个网络上时，该主机就必须同时具有两个相应的 IP 地址，且其网络前缀必须是不同的。 这种主机称为多归属主机 ( multihomed host) 。</p>
<p>●  由于一台 路由器 至少应当连接到两个网络（这样它才能将 IP 数据报从一个网络转发到另一个网络）， 因此一个路由器至少应当有两个不同网络前缀的 IP 地址。</p>
<p>（3）一个网络（或子网）是指具有相同网络前缀的主机的集合，因此用转发器或交换机连接起来的若干个局域网仍为一个网络，因为这些局域网都具有同样的网络前缀。具有不同网络前缀的局域网必须使用路由器进行互连。</p>
<p>（4）所有分配到网络前缀的网络，不管是范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是平等的。</p>
<p>这里给一张图，认真体会：</p>
<p><img src="./imgs/0cb300a30ce14d5ab57d036aae441293.png" alt=""></p>
<h4 id="23-ip-地址与-mac-地址"> 2.3 IP 地址与 MAC 地址</h4>
<p>在学习局域网时，我们知道由于 MAC 地址已固化在网卡上的 ROM 中，因此常常称 MAC 地址为硬件地址或物理地址。而 IP 地址是一种逻辑地址（因为 IP 地址是用软件实现的）。<a href="https://blog.csdn.net/weixin_46024428/article/details/118278271?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168355044316800226511018%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168355044316800226511018&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-118278271-null-null.142%5Ev86%5Einsert_down1,239%5Ev2%5Einsert_chatgpt&amp;utm_term=ip%E5%9C%B0%E5%9D%80%E5%92%8Cmac%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8C%BA%E5%88%AB&amp;spm=1018.2226.3001.4187" title="IP地址和MAC地址">IP 地址和 MAC 地址</a>  </p>
<p><img src="./imgs/737764b8fbff4ae09bb237c2bab463d4.png" alt=""></p>
<p>IP 地址和 MAC 地址之间没有简单的应关系，所以必须使用 ARP 协议进行地址转换。，但我们能清楚的看到 MAC 地址和 IP 地址的所处位置，和它们转换后数据部分对应的位置。</p>
<p>IP 数据报的转发过程：</p>
<blockquote>
<p><img src="./imgs/e37df27a2f06428eaad7a347cc89e700.png" alt=""></p>
<p>主机 H1 先要查找自己的转发表（实际就是查找 ARP 高速缓存的映射表），看目的主机是否就在本网络上。如是，则直接交付，任务完成；如不是，则必须把 IP 数据报发送给某个路由器。  </p>
<p><img src="./imgs/625cbb199e5c4216b7cca8b60a254339.png" alt=""></p>
<p> <img src="./imgs/7cf6347579c94ac8a849293822407c53.png" alt=""></p>
</blockquote>
<h4 id="24-地址解析协议-arp-重点">2.4 地址解析协议 ARP （重点）</h4>
<p><img src="./imgs/c58cd9a2744e478ab4ff75b9d5e484dc.png" alt=""></p>
<blockquote>
<p>**（1）**每一台主机都设有一个 ARP 高速缓存 (ARP cache) ，里面有 本局域网 上的一些主机和路由器的 IP 地址到 MAC 地址的 映射表 。 当主机 A 欲向 本局域网 上的某台主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存 中查看有无主机 B 的 IP 地址 对应的 MAC 地址 。 如有，就 可将此 MAC 地址 写入 MAC 帧，然后通过局域网将该 MAC 帧 发送出去。 <strong>（2）</strong> 若主机 A 查不到主机 B 的 MAC 地址（比如主机 A 此前没有与主机 B 发送过信息或主机 A 刚开机其 ARP 高速缓存为空），主机 A 就自动运行 ARP 协议来找出主机 B 的 MAC 地址， 并将主机 B 的 IP 地址到 MAC 地址的 映射写入 其 ARP 高速缓存 。 有了主机 B 的 MAC 地址，主机 A 就可以向主机 B 发送数据帧了。 <strong>（3）</strong> 考虑到计算机通信的双向交互特性，主机 A 在发送其 ARP 请求分组时，会将自己的 IP 地址到 MAC 地址的映射写入 ARP 请求分组。当主机 B 收到主机 A 的 ARP 请求分组时，就将主机 A 的地址映射写入主机 B 自己的 ARP 高速缓存中。 **（4）**ARP 把 已经得到的地址映射保存 在高速缓存 中 ，这样就可以 直接从高速缓存中找到所需 的 MAC 地址（如果有的话）而 不必再用广播方式 发送 ARP 请求 分组 。 ARP 对保 存在高速缓存中的 每 一 个地址映射项目 都设置 生存时间 ( 例如， 10 ~ 20 分钟 ) 。凡超过生存时间的项目就从高速缓存中删除掉 。 <img src="./imgs/6f76b5e197664638b32100d73a9a492c.png" alt=""></p>
<p>ARP 请求分组的报格式这里就不做探究了，你只需要理解它的作用和过程即可~ </p>
</blockquote>
<p> 将上述过程用流程图归纳：</p>
<p><img src="./imgs/7f918ea3de5445f285db0f30e2813471.png" alt=""></p>
<p> ARP 用来解决同一个局域网上的主机或路由器的IP 地址到 MAC 地址的映射问题。如果目的主机和源主机不在同一个局域网上（通过比较网络前缀即可知道），那么就无法通过 ARP 进行解析（路由器不转发广播帧），而实际上源主机也不需要知道另一个局域网上的目的主机的 MAC 地址。</p>
<p>但这不慌，当目的主机和源主机不在同一个局域网时，就要通过 ARP 先找到本局域网上的某个路由器的 MAC 地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个节点，依此类推，直至最终交付目的主机。</p>
<p><img src="./imgs/2e1a3fd51e534014b7b01b335ad5f5de.png" alt=""></p>
<p>上述 A - B 的过程：<br>
<img src="./imgs/e3683a50a9eb4405881a794786cc7bff.png" alt=""></p>
<p>从 IP 地址到硬件地址的解析是自动进行的，主机的用户对这种地址解析过程是不知道的。只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器进行通信，ARP 协议就会自动地将该 IP 地址解析为数据链路层所需要的 MAC 地址。</p>
<p><strong>最后再总结一下：使用 ARP 的四种典型情况</strong></p>
<p><strong>(1)</strong> <strong>发送方是主机，要把</strong> <strong>IP</strong> <strong>数据报发送到同一个网络上的另一台主机。这时主机用</strong> <strong>ARP</strong> <strong>找到<strong><strong>目的主机</strong></strong>的</strong> <strong>MAC</strong> <strong>地址。</strong></p>
<p><strong>(2)</strong> <strong>发送方是主机，要把</strong> <strong>IP</strong> <strong>数据报发送到另一个网络上的一台主机。这时主机用</strong> <strong>ARP</strong> <strong>找到<strong><strong>本网络上的一个路由器</strong></strong>的</strong> <strong>MAC</strong> <strong>地址。</strong> </p>
<p><strong>(3)</strong> <strong>发送方是路由器，要把</strong> <strong>IP</strong> <strong>数据报转发到同一个网络上的一台主机。这时路由器用</strong> <strong>ARP</strong> <strong>找到<strong><strong>目的主机</strong></strong>的</strong> <strong>MAC</strong> <strong>地址。</strong></p>
<p><strong>(4)</strong> <strong>发送方是路由器，要把</strong> <strong>IP</strong> <strong>数据报转发到非直连网络上的一台主机。这时<strong><strong>路由器</strong></strong>用</strong> <strong>ARP</strong> <strong>找到直连网络上的<strong><strong>另一个路由器</strong></strong>的</strong> <strong>MAC</strong> <strong>地址。</strong></p>
<p>既然在网络层使用 IP 地址还要用 ARP 转成 MAC 地址才能在局域网中通信。那为什么不直接使用 MAC 地址通信呢？</p>
<p><strong>（1）MAC</strong> <strong>地址固化在网络适配器中，随主机的移动而移动，这不利于形成稳定的路由；<strong><strong>甚至当移动主机</strong></strong>的数量过多、移动过于频繁时，路由根本无法形成。</strong></p>
<p><strong>（2）而</strong> <strong>IP</strong> <strong>地址一旦分配，其在互联网中的相对位置基本不会改变，互联网中的路由信息可在相当大的范围内和相当长的时间内保持不变。而稳定的路由对于互联网通信是必不可少的。</strong></p>
<h4 id="25-ip-数据报的格式"> 2.5 IP 数据报的格式</h4>
<p>这个就是纯记忆的东西，感觉把各字段的作用都写出来，有点多，就借用了其他博主的，忘了的同学，可以看一下： <strong><a href="https://blog.csdn.net/ZBraveHeart/article/details/123791830?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168396809416800226546334%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168396809416800226546334&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123791830-null-null.142%5Ev87%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&amp;utm_term=IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F&amp;spm=1018.2226.3001.4187" title="   IP数据报格式">IP 数据报格式</a></strong></p>
<p>这里提醒一下注意事项：</p>
<p>（1）注意各字段的单位（例如首部长度是以 4 字节为单位长度，片偏移以 8 字节为单位长度……）</p>
<p>（2） 总长度字段是以字节为单位（最大为 $$ 2 的 16 次 减 1），当超过数据链路层的 MTU，就要注意分片的计算过程（P137 那道例题很值得一看），每一个分片的总长度，是指分片后的首部长度与该分片的数据部分长度之和。，除了最后一个分片 (数据部分)，其他每个分片的数据部分长度一定是 8 字节的整倍！。</p>
<h3 id="三ip-层转发分组的过程"> 三、IP 层转发分组的过程</h3>
<h4 id="31-基于终点转发">3.1 基于终点转发</h4>
<p>分组在互连网上传送和转发是基于分组首部中的目的地址的，就叫基于终点转发。</p>
<p><img src="./imgs/8b3e99b3b39940e394cadbc2c58b1d2f.png" alt=""></p>
<p> 这里补充一下：</p>
<p>（1）通常 转发表中的每一项指明到某一个 网络 而不是到某一台主机的 路由。 特定主机路由 和 默认路由 除外（后文会介绍）。</p>
<p>（2）路由器每收到一个分组， 就根据其首部的 目的地址 查找 转发表，找到匹配的 项目，根据 对应的接口或下一 跳 地址 转发出去（可能是直接交付，也可能是转交给下一个路由器）。</p>
<p>（3）如果是转交给下一个路由器，下一个路由器进行同样的查找、转发操作。</p>
<p>（4） 在将分组转发到下一跳路由器的过程中，会用到 ARP 协议进行 IP 地址到 MAC 地址的转换。</p>
<p>使  </p>
<p>那它怎样判断该目的地址已经转发到目的网络呢？</p>
<blockquote>
<p><img src="./imgs/336823f997d24403b47d549257a879ac.png" alt=""><img src="./imgs/05c64676cade4a83ad9d8a2ae6085dd7.png" alt=""><img src="./imgs/e57b00abee104d2395bbea69699a427d.png" alt=""></p>
<p> 过程就如上述顺序！！！</p>
</blockquote>
<h4 id="32-最长前缀匹配">3.2 最长前缀匹配</h4>
<p>在使用 CIDR 时，转发表中的每个项目由 “网络前缀” 和“下一跳”组成。在查找转发表时有时可能会得到不止一个匹配结果。应当从所有匹配结果中选择具有最长网络前缀的路由，即最长前缀匹配 (longest-prefix matching)。（<strong>网络前缀越长，其地址块就越小，因而路由就越具体</strong>）</p>
<p>不理解，这里我举个例子（其实书上 P142 那个栗子已经很形象了）</p>
<blockquote>
<p><img src="./imgs/48b88c513b4447c2afa4c1caf21e528c.png" alt=""></p>
<p> ​​​<img src="./imgs/be4978fe0d5f46bcb607bf18344b3765.png" alt=""></p>
<p> <strong>选择两个匹配的地址中更具体的一个，即选择<strong><strong>网络</strong></strong>前缀最长****的那个路由。</strong></p>
</blockquote>
<h4 id="33-两种特殊的路由">3.3 两种特殊的路由</h4>
<p>（1）虽然互联网中几乎所有的分组转发都是基于目的主机所在的网络进行的，但在大多数情况下都允许对特定的目的主机指明一个路由，这种路由叫做特定主机路由。</p>
<p>● <strong>假设特定主机的 IP</strong> <strong>地址是</strong> <strong>a.b.c.d</strong>**，那么在转发表中对应于特定主机路由的网络前缀就是** <strong>a.b.c.d</strong>**/32****。**</p>
<p>● <strong>特定主机路由一般位于转发表的最前面。</strong></p>
<p>（2）还有一种特殊路由叫默认路由 (default route) 。</p>
<p>● <strong>在实际的转发表中，对应于默认路由的网络前缀是 0.0.0.0/0</strong>**。网络前缀长度为** <strong>0</strong>**，表明地址掩码是** <strong>32</strong> <strong>个</strong> <strong>0</strong>**，而任何目的地址与全** <strong>0</strong> <strong>的掩码****按位</strong> <strong>AND</strong> <strong>运算的结果都是</strong> <strong>0.0.0.0</strong>**，都能与默认路由匹配。**</p>
<p>● <strong>默认路由一般位于转发表的最后一条，只有在<strong><strong>转发表中的其他路由都不匹配的时候才会用</strong></strong>到默认路由。</strong></p>
<p>● <strong>在网络只有很少的对外连接时使用默认路由非常有用。</strong></p>
<h4 id="34-分组转发算法总结">3.4 分组转发算法（总结）</h4>
<p>(1) 从收到的分组的首部提取目的 IP 地址 <em>D</em>。</p>
<p>(2) 从转发表的第一行开始，将目的地址 <em>D</em> 与该行的子网掩码进行按位 AND 运算，看结果与该行的前缀是否匹配。若匹配则查找结束，按照下一跳指出的路由进行处理；若不匹配则继续查找下一行。</p>
<p>(3) 若查找完整个转发表也没有匹配项（比如没有配置默认路由），则丢弃分组并报告转发分组出错。</p>
<p><img src="./imgs/629ad83a648a43b58667a6060c78743e.png" alt=""></p>
<p> 注意：转发表并没有给出到某个网络的完整路径，仅仅给出到某个网络应当先到某个路由器（即下一跳路由器）。在到达下一跳路由器后，再继续查找其转发表， 从而知道再下一步应当到哪一个路由器。就这样一步一步地查找下去，直至最后到达目的网络。</p>
<h4 id="35-使用二叉线索查找转发表-略">3.5 使用二叉线索查找转发表 (略)</h4>
<p>需要的朋友可以自行查阅其他博客~</p>
<h3 id="四网际控制报文协议-icmp重点">四、网际控制报文协议 ICMP（重点）</h3>
<p>主机或路由器使用网际控制报文协议 ICMP (Internet Control Message Protocol) 报告差错和异常情况。(前面 IP 数据报的首部字段中的 “首部检验和” 只检验数据报的首部，不包括数据部分，因此不能保证传输的 ICMP 报文不产生差错。这和下文 ICMP 报文格式中 “ 检验和 ” 使用的方法是一样的，但是它检验的范围包括 icmp 报头和数据部分 ， 不会检验 IP 报头)</p>
<p>解释 ICMP 协议的出现：</p>
<blockquote>
<p>我们都知道，IP 协议是一个不可靠协议，尽最大努力交付，如果 IP 包在传输过程中出现错误，比如 checksum 对不上，拥塞，超时等等，那么 IP 包是会直接被丢弃的，之后也不会有进一步的努力来修正。但高层能提供质量控制的协议毕竟在少数，所以就需要在下层有协议来辅助 IP 完成必要的网络质量管理。ICMP 协议自然就被提出来了。</p>
<p>ICMP 提供一致易懂的出错报告信息。发送的出错<a href="https://baike.baidu.com/item/%E6%8A%A5%E6%96%87?fromModule=lemma_inlink" title="报文">报文</a>返回到发送原数据的设备，因为只有发送设备才是出错报文的逻辑接受者。发送设备随后可根据 ICMP 报文确定发生错误的类型，并确定如何才能更好地重发失败的数据包。但是 ICMP 唯一的功能是报告问题而不是纠正错误，纠正错误的任务由发送方完成。</p>
<p>在网络中经常会使用到 ICMP 协议，比如经常使用的用于检查网络通不通的 <a href="https://baike.baidu.com/item/Ping?fromModule=lemma_inlink" title="Ping">Ping</a> 命令（Linux 和 Windows 中均有），这个 “Ping” 的过程实际上就是 ICMP 协议工作的过程。还有其他的网络命令如跟踪路由的 Tracert 命令也是基于 ICMP 协议的。</p>
<p>不过需要注意的是，ICMP 仅仅只能提供某些特定类型的错误信息汇报，并不能帮助 IP 协议成为可靠的协议。它能做的事还是有限，但用于基本的网络质量管理是足够了。</p>
</blockquote>
<p>注意：</p>
<p>（1）ICMP 报文封装在 IP 数据报中，作为 IP 数据报的数据部分。但 ICMP 不是高层协议，而是 IP 层的协议。</p>
<p>（2）ICMP 只能搭配 IPv4 工作，如果是 IPv6（下文会介绍），需要使用 ICMPv6。</p>
<p>（3）<strong><code>ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告</code>。</strong></p>
<p><strong>ICMP 报文格式  ——&gt;</strong></p>
<p><img src="./imgs/df00a54f913d4ed68360d5aa0f527356.png" alt="">解释：<strong>ICMP</strong> <strong>报文的前</strong> <strong>4</strong> <strong>个字节是统一的格式，共有三个字段：<strong><strong>类型</strong></strong>、<strong><strong>代码</strong></strong>和<strong><strong>检验和</strong></strong>。接着的</strong> <strong>4</strong> <strong>个字节的内容与</strong> <strong>ICMP</strong> <strong>的类型有关。这</strong> <strong>8</strong> <strong>个字节****构成了</strong> <strong>ICMP</strong> <strong>报文的<strong><strong>首部</strong></strong>。最后面是数据字段，其长度取决于</strong> <strong>ICMP</strong> <strong>的类型。</strong> </p>
<p><strong>ICMP</strong> <strong>报文分为两类：</strong> <strong>ICMP</strong> <strong>差错报告</strong> <strong>报文和</strong> <strong>ICMP</strong> <strong>询问</strong> <strong>报文。</strong> <strong>每</strong> <strong>一类</strong> <strong>又细分为不同的类型</strong> <strong>。</strong></p>
<ul>
<li>
<p>一类是 查询类报文 ：主要用于信息的查询和采集，比如采集传输路径上的每个路由器都是谁，本次传输的报文是否达到目的地等等 ， 例如 ping。</p>
</li>
<li>
<p>另一类是 差错诊断类报文 ：主要用于诊断网络故障，比如传输报文被丢弃的原因是什么等等 ， 例如 tracert。</p>
</li>
</ul>
<p><img src="./imgs/3eb4fe6d345d494180f1987c4ad04d14.png" alt="">书上 P147 上对于这几种类型的介绍都去仔细看一下，另外还有书上也举例了不应发送 icmp 差错报告报文的几种情况也看看，这里我就不写了 QvQ 。算了，还是把后者写出来吧~</p>
<p>● 对 ICMP 差错报告报文不再发送 ICMP 差错报告报文。<br>
● 对第一个分片的数据报片的所有后续数据报片都不发送 ICMP 差错报告报文。<br>
● 对具有多播地址的数据报都不发送 ICMP 差错报告报文。<br>
● 对具有特殊地址（如 127.0.0.0 或 0.0.0.0）的数据报不发送 ICMP 差错报告报文。</p>
<p><strong>所有的 ICMP 差错报告报文的数据部分都具有同样的格式。</strong></p>
<blockquote>
<p><img src="./imgs/c88e7a1ae2e44042aa88baf2200a3954.png" alt=""></p>
<p>把收到的需要进行差错报告的 IP 数据报的首部和数据字段的前 8 个字节（这我也不太清楚作用，好像跟运输层的端口号和运输层报文的发送序号有关……）提取出来，作为 ICMP 报文的数据字段，再加上相应的 ICMP 差错报告的前 8 个字节，就构成了 ICMP 差错报告报文。<br>
ICMP 报文包含在 IP 数据报中，IP 报头在 ICMP 报文的最前面。一个 ICMP 报文包括 IP 报头（至少 20 字节）、ICMP 报头（至少八字节）和 ICMP 报文（属于 ICMP 报文的数据部分）。当 IP 报头中的协议字段值为 1 时，就说明这是一个 ICMP 报文。（前面的 IP 数据报首部格式有介绍）</p>
</blockquote>
<p><strong>ICMP 的应用举例：</strong></p>
<p>就书上 P148 那两个重要应用，这里简单介绍一下：</p>
<p><strong>1.</strong> <strong>测试两台主机之间连通性的</strong> <strong>ping 命令使用 ICMP 回送请求和应答报文</strong><br>
PING 是应用层直接使用网络层 ICMP 的例子，它没有通过运输层的 TCP 或 UDP**。**在网络可达性测试中使用的分组网间探测命令 ping 能产生 ICMP 回送请求和应答报文。目的主机收到 ICMP 回送请求报文后立刻回送应答报文，若源主机能收到 ICMP 回送应答报文，则说明到达该主机的网络正常。</p>
<p><img src="./imgs/20c52e4e859d4f4e879ac1d5b7efab4a.png" alt=""></p>
<p> <strong>2. 路由分析诊断程序 tracert 使用了</strong> <strong>IP</strong> <strong>数据报中的</strong> <strong>TTL</strong> <strong>字段、<strong><strong>ICMP</strong> **时间超过</strong><strong>差错报告</strong>**报文</strong></p>
<p>（ <strong>traceroute</strong> 是类 Linux 系统自带的工具，Windows 上类似的工具是 <strong>tracert</strong>，两者有些许不同，tracert 默认使用 ICMP 报文探测，而 traceroute 默认使用 UDP，但是也可以使用 TCP/ICMP 三种报文探测。）<br>
tracert 命令主要用来显示数据包到达目的主机所经过的路径。通过执行一个 tracert 到对方主机的命令，返回数据包到达目的主机所经历的路径详细信息（经过路由器的 IP 地址），并显示每个路径所消耗的时间（到达每个路由器的往返时间）。</p>
<p><img src="./imgs/64eb1a4f657140cda03a65f26467496d.png" alt=""></p>
<h3 id="五ipv6">五、IPv6</h3>
<p> 为了解决 IP 地址耗尽的问题，就有了 IPv6。<img src="./imgs/9bf66b4170e54c9c9cc9081584d3a02a.png" alt=""></p>
<p><strong>IPv6</strong> <strong>对首部的主要更改：</strong></p>
<table border="1" cellpadding="1" cellspacing="1" style="width:689px;"><tbody><tr><td><strong>（1）取消了首部长度字段，因为这里是 40 字节固定的。</strong></td><td style="width:434px;"><strong>（4）把</strong><strong> TTL </strong><strong>字段改称为跳数限制字段</strong></td></tr><tr><td><strong>（2）取消了服务类型字段，因为优先级和流标号字段以实现了这个功能了</strong></td><td style="width:434px;"><strong>（5）取消了协议字段，改用下一个首部字段</strong></td></tr><tr><td><strong>（3）取消了总长度字段</strong><strong>，</strong><strong>改用有效载荷长度字段</strong></td><td style="width:434px;"><strong>（6）取消了检验和字段</strong></td></tr><tr><td><strong>（8）首部长度改为 8 字节整数倍（IPv4 是 4 字节）。</strong></td><td style="width:434px;"><strong>（7）取消了选项字段，而用扩展首部来实现选项功能</strong></td></tr></tbody></table>
<p><strong>IPv6 首部各字段的作用：</strong></p>
<p>为了对比，我把 IPv4 也给出来： </p>
<p><img src="./imgs/f3ffde6be17049d481be7239e3aa996b.png" alt=""></p>
<p><img src="./imgs/4c49329f27ac498e86d98d5ef049596e.png" alt=""></p>
<p><strong>（1）<strong><strong>版本</strong> <strong>(version</strong></strong>)——<strong><strong>占</strong> <strong>4</strong> **位，它</strong>**指明了协议的版本，对</strong> <strong>IPv6</strong> <strong>该****字段为</strong> <strong>6</strong>**。**</p>
<p><strong>（2）通信量类</strong> <strong>(traffic class</strong>**)——<strong><strong>占</strong> <strong>8</strong> **位，这</strong>**是为了区分不同的** <strong>IPv6</strong> <strong>数据报的类别或优先级。</strong></p>
<p><strong>（3）流标号</strong> <strong>(flow label</strong>**)——<strong><strong>占</strong> <strong>20</strong> <strong>位。“流”</strong> **是互联网络</strong><strong>上从特定源点到特定终点的一系列数据报，“流” 所经过的路径上的路由器都保证指明的服务质量</strong>**。所有****属于同一个流的数据报都具有同样的流标号。**</p>
<p><strong>（4）有效载荷长度</strong> <strong>(payload length</strong>**)——<strong><strong>占</strong> <strong>16</strong> **位，它</strong><strong>指明** <strong>IPv6</strong> **数据报除基本首部以外的字节</strong><strong>数（所有扩展首部都算有效载荷之内），<strong><strong>其最大值是</strong> **64 KB（65535 字节）</strong></strong>。**</p>
<p><strong>（5）<strong><strong>下一个首部</strong> <strong>(next header</strong></strong>)——<strong><strong>占</strong> <strong>8</strong> **位，它</strong>**相当于</strong> <strong>IPv4</strong> <strong>的协议字段或可选字段。当</strong> <strong>IPv6</strong> <strong>数据报没有扩展首部时，其值指明有效载荷应交付的高层协议；若有扩展首部，其值<strong><strong>指明后面第一</strong></strong>个扩展首部的类型。</strong></p>
<p><strong>（6）跳数限制</strong> <strong>(hop limit</strong>**)——<strong><strong>占</strong> <strong>8</strong> <strong>位。<strong><strong>源点在每个数据报</strong></strong>发出时即设定跳数限制。路由器在转发数据报时先将跳数限制字段中的值减</strong> <strong>1</strong></strong>。当****跳数限制字段的值为零时，就要将此数据报丢弃。**</p>
<p><strong>（7）源地址</strong>**——<strong><strong>占</strong> <strong>128</strong> **位，是</strong>**数据报的发送端的** <strong>IP</strong> <strong>地址。</strong></p>
<p><strong>（8）目的地址</strong>**——<strong><strong>占</strong> <strong>128</strong> **位，是</strong><strong>数据报</strong>**的接收端的** <strong>IP</strong> <strong>地址。</strong></p>
<p><strong>与 IPv4 不同的是，一****个</strong> <strong>IPv6</strong> <strong>数据报的目的地址可以是以下三种基本类型地址之一：</strong></p>
<p><strong>单播</strong> <strong>(unicast)</strong> <strong>：传统的点对点通信。</strong></p>
<p><strong>多播</strong> <strong>(multicast)</strong> <strong>：一点对多点的通信。</strong> <strong>IPv6</strong> <strong>将广播</strong> <strong>看作多播的一个特例。（就相当于</strong> IPv4 的广播 + 组播 <strong>）</strong></p>
<p><strong>任播</strong> <strong>(</strong> <strong>anycast</strong> <strong>)</strong> <strong>：</strong> <strong>IPv6</strong> <strong>增加的一种</strong> <strong>类型。任播的终点是一组计算机，但数据报只交付其中的一个，通常是距离最近的一个。</strong></p>
<p>而 IPv4 是：</p>
<blockquote>
<p><strong>单播</strong></p>
<p>单播是指单台设备与单台设备之间的通信，源地址和目的地址都是单一的 IPv4 地址，单播数据包的通信可以在网络之间转发。在实际的网络通信中，大多数的通信都属于单播。<br>
广播<br>
广播是一台主机向网络中所有主机发送数据包，广播的目的地址不同于单播单一的地址。<br>
广播有两类：定向广播和有限广播<br>
1、定向广播是将数据包发送到向本网络之外的特定网络所有主机，定向广播的目的地址是定向网络的广播地址，如当前网络为 192.168.0.0/24, 要向 192.168.1.0/24 的网络发送定向广播，那么定向广播的目的地址是：192.168.1.255。可以配置路由器让其转发定向广播。<br>
2、有限广播是将数据包发送到本地网络的所有主机，有限广播使用的目的地址是: 255.255.255.255. 路由器不转发此广播。</p>
<p>组播<br>
单播是单台设备与单台设备之间的通信，广播是单台设备向网络中所有主机发送数据，而组播是单台主机向选定的一组主机发送数据。与单播相比，提高了发送数据包的效率，与广播相比，减少了网络流量。与广播不同的是，要实现组播需要在接受组播的客户机上安装相应的客户端程序。</p>
</blockquote>
<p><strong>冒号十六进制记法</strong></p>
<p>显然 IPv6 用 IPv4 的点分十进制记法以不太可能了。因此冒号十六进制记法诞生了~</p>
<p>在 IPv6 中，每个地址占 128 位。IPv6 使用冒号十六进制记法 (colon hexadecimal notation)：每 16 位二进制值用 4 个十六进制值表示，各组值之间用冒号分隔，并允许把数字前面的 0 省略，例如： <strong>68E6:8C64:FFFF:FFFF:0:1180:960A:FFFF</strong></p>
<p><strong>规定：</strong></p>
<p><strong>（1）在冒号十六进制记法中，一串连续的</strong> <strong>0</strong> <strong>可以被一对冒号取代，这就是<strong><strong>零</strong></strong>压缩</strong>**。例如，<strong><strong>FF05:0:0:0:0:0:0:B3</strong> **可以</strong><strong>写</strong><strong>成** <strong>FF05::B3</strong></strong>。**</p>
<p><strong>（2）为了不引起歧义，在</strong> <strong>IPv6</strong> <strong>地址中只能****使用一次零压缩。</strong></p>
<p><strong>（3）冒号<strong><strong>十六进制记法可结合使用点分</strong></strong>十进制后缀，这种形式在</strong> <strong>IPv4</strong> <strong>转向</strong> <strong>IPv6</strong> **的过渡<strong><strong>阶段</strong></strong>特别****有用。**<strong>例如：<strong><strong>0:0:0:0:0:0:128.10.2.1</strong></strong>。<strong><strong>再使用零压缩即可得出</strong> <strong>::128.10.2.1</strong></strong>。</strong></p>
<p><strong>（4）在冒号十六进制记**<strong>法中，<strong><strong>CIDR</strong> <strong>的斜线表示法仍然可用</strong></strong>。例如，<strong><strong>60</strong> <strong>位的前缀</strong> <strong>12AB00000000CD3</strong> **可记</strong></strong>为</strong> <strong>12AB:0000:0000:CD30:0000:0000:0000:0000/60</strong> <strong>或</strong> <strong>12AB::CD30:0:0:0:0/60</strong> <strong>或</strong> <strong>12AB:0:0:CD30::/60  。</strong></p>
<p>对于 IPV6 的常用地址分类（就简单给张图，我们学校不要求掌握，需要去掌握了解的自行查阅其他博客）</p>
<table border="1" cellspacing="0"><tbody><tr><td style="background-color:#49cacd;border-color:#ffffff;text-align:center;vertical-align:middle;width:174pt;"><p style="margin-left:0in;text-align:center;"><strong>地址类型</strong></p></td><td style="background-color:#49cacd;border-color:#ffffff;text-align:center;vertical-align:middle;width:324pt;"><p style="margin-left:0in;text-align:center;"><strong>二进制</strong><strong>前缀</strong><strong>或地址</strong></p></td><td style="background-color:#49cacd;border-color:#ffffff;text-align:center;vertical-align:middle;width:295pt;"><p style="margin-left:0in;text-align:center;"><strong>CIDR</strong><strong> 风格的冒号十六进制记法</strong></p></td></tr><tr><td style="background-color:#49cacd;border-color:#ffffff;text-align:justify;vertical-align:middle;width:174pt;"><p style="margin-left:0in;text-align:justify;"><strong>未指明地址</strong></p></td><td style="background-color:#cfeced;border-color:#ffffff;text-align:justify;vertical-align:middle;width:324pt;"><p style="margin-left:0in;text-align:justify;"><strong>00…0</strong><strong>（</strong><strong>128</strong><strong> 位</strong><strong>），</strong><strong>仅此一个</strong></p></td><td style="background-color:#e9f6f6;border-color:#ffffff;text-align:justify;vertical-align:middle;width:295pt;"><p style="margin-left:0in;text-align:justify;"><strong>::/128</strong></p></td></tr><tr><td style="background-color:#49cacd;border-color:#ffffff;text-align:justify;vertical-align:middle;width:174pt;"><p style="margin-left:0in;text-align:justify;"><strong>环回地址</strong></p></td><td style="background-color:#cfeced;border-color:#ffffff;text-align:justify;vertical-align:middle;width:324pt;"><p style="margin-left:0in;text-align:justify;"><strong>00…1</strong><strong>（</strong><strong>128</strong><strong> 位</strong><strong>），</strong><strong>仅此一个</strong></p></td><td style="background-color:#e9f6f6;border-color:#ffffff;text-align:justify;vertical-align:middle;width:295pt;"><p style="margin-left:0in;text-align:justify;"><strong>::1/128</strong></p></td></tr><tr><td style="background-color:#49cacd;border-color:#ffffff;text-align:justify;vertical-align:middle;width:174pt;"><p style="margin-left:0in;text-align:justify;"><strong>多播地址</strong></p></td><td style="background-color:#cfeced;border-color:#ffffff;text-align:justify;vertical-align:middle;width:324pt;"><p style="margin-left:0in;text-align:justify;"><strong>11111111</strong><strong>（</strong><strong>8</strong><strong> 位），</strong><strong>功能和 </strong><strong>IPv4 </strong><strong>多播地址一样</strong></p></td><td style="background-color:#e9f6f6;border-color:#ffffff;text-align:justify;vertical-align:middle;width:295pt;"><p style="margin-left:0in;text-align:justify;"><strong>FF00</strong><strong>::/8</strong></p></td></tr><tr><td style="background-color:#49cacd;border-color:#ffffff;text-align:justify;vertical-align:middle;width:174pt;"><p style="margin-left:0in;text-align:justify;"><strong>本地站点单播地址</strong></p></td><td style="background-color:#cfeced;border-color:#ffffff;text-align:justify;vertical-align:middle;width:324pt;"><p style="margin-left:0in;text-align:justify;"><strong>1111111011</strong><strong>（</strong><strong>10</strong><strong> 位）</strong><strong>，</strong><strong>仅供一个单位内部使用</strong></p></td><td style="background-color:#e9f6f6;border-color:#ffffff;text-align:justify;vertical-align:middle;width:295pt;"><p style="margin-left:0in;text-align:justify;"><strong>FEC0::/10</strong></p></td></tr><tr><td style="background-color:#49cacd;border-color:#ffffff;text-align:justify;vertical-align:middle;width:174pt;"><p style="margin-left:0in;text-align:justify;"><strong>本地链路单播地址</strong></p></td><td style="background-color:#cfeced;border-color:#ffffff;text-align:justify;vertical-align:middle;width:324pt;"><p style="margin-left:0in;text-align:justify;"><strong>1111111010</strong><strong>（</strong><strong>10</strong><strong> 位</strong><strong>）</strong><strong>，</strong><strong>启用</strong> <strong>IPv6 </strong><strong>时自动生成</strong></p></td><td style="background-color:#e9f6f6;border-color:#ffffff;text-align:justify;vertical-align:middle;width:295pt;"><p style="margin-left:0in;text-align:justify;"><strong>FE80</strong><strong>::/10</strong></p></td></tr><tr><td style="background-color:#49cacd;border-color:#ffffff;text-align:justify;vertical-align:middle;width:174pt;"><p style="margin-left:0in;text-align:justify;"><strong>全球单播地址</strong></p></td><td colspan="2" style="background-color:#cfeced;border-color:#ffffff;text-align:justify;vertical-align:middle;"><p style="margin-left:0in;text-align:justify;"><strong>除上述</strong><strong>五</strong><strong>种</strong><strong>外，所有其他</strong><strong>的地址（</strong><strong>这是使用得最多的一类，其划分方法有三种</strong><strong>）</strong></p></td></tr></tbody></table>
<p><strong>从 IPv4 向 IPv6 过渡：</strong></p>
<p>从 IPv4 向 IPv6 过渡只能采用逐步演进的办法，同时还必须使 IPv6 能够向后兼容。这就要求 IPv6 必须能够接收和转发 IPv4 分组，并且能够为 IPv4 分组选择路由。</p>
<p><strong>从</strong> <strong>IPv4</strong> <strong>向</strong> <strong>IPv6</strong> <strong>过渡主要有两种方法：</strong><a href="https://blog.csdn.net/FS_China/article/details/120646401?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E5%8F%8C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%92%8C%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF%E3%80%82&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-120646401.142%5Ev87%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&amp;spm=1018.2226.3001.4187" title="双协议栈和隧道技术">双协议栈和隧道技术</a><strong>。</strong></p>
<h3 id="六互联网的路由选择协议">六、互联网的路由选择协议</h3>
<p><strong>根据****路由算法是否具有自适应性，路由选择策略分为两大类：</strong></p>
<p><strong>（1）静态</strong> <strong>路由选择策略：用人工配置每一条路由，适用于简单的小网络；</strong></p>
<p><strong>（2）动态</strong> <strong>路由选择策略：使用</strong> <strong>路由选择协议</strong> <strong>生成每一条路由，并可根据网络的通信量或</strong> <strong>拓扑</strong> <strong>的变化进行动态调整，适用于复杂的大网络</strong> <strong>。</strong></p>
<p>对于静态路由选择 我们可以自己在右图这个软件上模拟实现：（这几个实验的操作后序会上传在资源里，但我想你们老师应该都会讲的吧）</p>
<p><img src="./imgs/d8e3a994fa324a68bc20e09a4f04d1ea.png" alt=""></p>
<h4 id="61-分层次的路由选择协议">6.1 分层次的路由选择协议</h4>
<p>由于互联网的规模非常大，如果让所有的路由器知道所有的网络应怎样到达，则路由表将会非常大，处理起来花费的时间也会很多，所以互联网采用分层次的路由选择协议：</p>
<p>（1） <strong>把整个互联网划分为许多较小的</strong> <strong>自治系统</strong> <strong>AS</strong> <strong>。例如，一个</strong> <strong>ISP</strong> <strong>就是一个自治系统；</strong></p>
<p>（2） <strong>在一个自治系统内部使用</strong> <strong>内部网关协议</strong> <strong>，如</strong> <strong>RIP</strong> <strong>和</strong> <strong>OSPF 等</strong> <strong>；</strong></p>
<p>（3） <strong>在不同自治系统之间使用</strong> <strong>外部网关协议</strong> <strong>，如</strong> <strong>BGP-4</strong> <strong>。</strong></p>
<p><strong>自治系统</strong> <strong>(AS)</strong> <strong>是<strong><strong>在单一技术管理下的许多网络、<strong><strong>IP</strong> <strong>地址以及路由器</strong></strong>，这些</strong></strong>路由器<strong><strong>使用</strong></strong>同<strong><strong>一</strong></strong>种自治系统内部的路由选择协议和共同的度量。每一个</strong> <strong>AS</strong> <strong>对其他</strong> <strong>AS</strong> <strong>表现出的是一个<strong><strong>单一</strong></strong>的、一致<strong><strong>的</strong></strong>路由选择策略。</strong> </p>
<p><img src="./imgs/1603f8940f374446ad208e1106efeb24.png" alt=""></p>
<h4 id="62-内部网关协议-rip-重点">6.2 内部网关协议 RIP （重点）</h4>
<p>RIP（Routing Information Protocol）是一种分布式的基于距离向量的路由选择协议。</p>
<p>RIP 协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录，这组距离就叫做 “距离向量”。</p>
<p><strong>“距离” 的定义：</strong></p>
<p>（1） <strong>路由器</strong> 到 直连网络 的距离定义 为 1 ； 每经过一个路由器，距离就加 1。</p>
<p>（2） <strong>RIP</strong> 允许的距离的最大值为 15 ，“距离” 等于 16 表示不可达 ， 因此 RIP 只适用于小的自治系统。</p>
<p>（3） <strong>RIP</strong> 认为，好的路由就是它通过的路由器的数目少，即 “距离短”。</p>
<p><strong>RIP</strong> <strong>路由表中<strong><strong>最主要的信息</strong></strong>就是</strong>**：<strong><strong>到</strong></strong>某个网络<strong><strong>的</strong></strong>距离****，<strong><strong>以及应经过的</strong></strong>下一跳<strong><strong>地址</strong></strong>。**</p>
<p><img src="./imgs/3afe9636af6e4b7a8d16f311b4d9bb87.png" alt=""><strong>RIP 协议的特点：</strong></p>
<p>（1）每个路由器仅和相邻路由器交换信息。</p>
<p>（2）路由器交换的信息是当前本路由器所知道的全部信息，即自己的路由表：我到本自治系统中所有网络的（最短）距离，以及到每个网络应经过的下一跳路由器。</p>
<p>（3）路由器按固定的时间间隔交换路由信息，然后根据收到的路由信息更新路由表。</p>
<p><strong>RIP 路由表的建立：</strong></p>
<p>路由器在刚刚开始工作时，其路由表是空的。</p>
<p>（1）然后路由器就得出到几个直连网络的距离（即 1）。</p>
<p>（2）之后，每一个路由器和相邻路由器交换路由信息，并使用距离向量算法更新自己的路由表。更新的原则是找出到每个目的网络的最短距离。</p>
<p>（3）经过若干次更新后，最终所有的路由器都会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器。</p>
<h5 id="621-距离向量算法">6.2.1 距离向量算法</h5>
<p>对每一个相邻路由器发送过来的 RIP 报文（里面包含路由信息），进行以下操作： </p>
<p><strong>(1)</strong> <strong>对地址****为</strong> <strong>X</strong> <strong>的<strong><strong>相邻路由器发来</strong></strong>的</strong> <strong>RIP</strong> <strong>报文</strong>**，先修改此报文中<strong><strong>的路由信息：把** **“下一跳” 字段中的地址都</strong></strong>改为** <strong>X</strong>**，并<strong><strong>把所有的 “距离” 字段的值</strong></strong>加** <strong>1</strong>**。修改后，每一条路由可表示为：到<strong><strong>目的</strong></strong>网络** <strong>N</strong>**，距离是** <strong>d</strong>**，下**<strong>一跳路由器是** <strong>X</strong></strong>。**</p>
<p><strong>(2)</strong> <strong>用****修改后的路由，<strong><strong>与路由表中</strong></strong>原来的路由进行对比：</strong></p>
<p>● <strong>若原来的路由表中没有目的****网络</strong> <strong>N</strong>**，则<strong><strong>把</strong></strong>该路由添加<strong><strong>到路由表</strong></strong>中；**</p>
<p><strong>否则（即<strong><strong>在路由表中有目的</strong></strong>网络</strong> <strong>N</strong>**），就<strong><strong>再查看下一跳路由器</strong></strong>地址，**</p>
<p>● <strong>若下一跳路由器地址****是</strong> <strong>X</strong>**，则用修改后的路由<strong><strong>更新</strong></strong>原<strong><strong>路由表中</strong></strong>的路由；**</p>
<p>   <strong>否则（即这个<strong><strong>路由</strong></strong>是：到<strong><strong>目的</strong></strong>网络</strong> <strong>N</strong>**，但<strong><strong>下一跳路由器</strong></strong>不是** <strong>X</strong>**），**</p>
<p>● <strong>若修改后的路由中<strong><strong>的</strong></strong>距离</strong> <strong>d</strong> <strong>小于<strong><strong>路由表中的距离，则进行</strong></strong>更新</strong>**；**</p>
<p><strong>否则<strong><strong>什么也不做</strong></strong>。</strong></p>
<p><strong>(3)</strong> <strong>若 3</strong> <strong>分钟还没有收到相邻路由器****的</strong> <strong>RIP</strong> <strong>报文，<strong><strong>则把此相邻路由器记为不可达的路由器，即把距离置为</strong> <strong>16</strong></strong>（<strong><strong>距离为</strong> <strong>16</strong> <strong>表示不可达</strong></strong>）。</strong></p>
<p>上述文字描述部分看懂了嘛？ 没看懂的话，这里举个栗子，结合栗子来理解：</p>
<p><img src="./imgs/83c283fa5ac44de8844e86c3b23ca8ff.png" alt=""> 步骤如 a ~ d : (1) 先都将下一跳改为 R4 ，然后举例都加 1  （2）用修改后的路由，与路由表中原来的路由进行对比：发现原来路由表的目的网络没有 Net1，所有就直接添加上 ； 然后对比下一项，发现目的网络都是 Net2 , 并且下一跳路由器都是 R4 ，所有就用修改后的路由更新原路由表中的路由；对比最后一项，发现虽然目的网络都是 Net3，但是它们的下一跳路由器不同，因此就对比距离单位看哪个距离最短，发现修改后的路由表距离最短（为 2），所有就更新成它。</p>
<p>最后对于 RIP 协议的报文格式（不需要掌握），想了想还是给大家看一下，可以加深对 RIP 报文的理解。</p>
<p>我们应知道 RIP 是基于 UDP 协议的， 而后文的要介绍的 OSPF 是基于 IP，BGP 是基于 TCP 的。它们共同用于发现和维护前往目的地的最短路。从上面我所阐述的，我们可以理解 RIP 、OSPF 、BGP 分别属于应用层协议 、网络层协议、应用层协议（都是废话，哈哈~）。<img src="./imgs/59ccbff9d8a847859932a4b116c4ee36.png" alt=""></p>
<p>我们可以看出这和上面详细介绍的 ICMP 报文基本格式是相识的。需要详细了解各字段含义的请参考 其他博客 ~</p>
<h5 id="622rip-协议的缺点坏消息传播得慢">6.2.2 RIP 协议的缺点：坏消息传播得慢</h5>
<p>为了，证明这个坏消息，请看下述的栗子：</p>
<blockquote>
<p><img src="./imgs/18d0e2b5681c4123908b95877d36657d.png" alt=""></p>
<p>接着就一直更新下去~ </p>
<p><img src="./imgs/2f981beb8eee4328b04ceae41a0a038d.png" alt=""> ​​​<img src="./imgs/38533eb372734f5c937817e76c0e6bcc.png" alt=""></p>
</blockquote>
<p><strong>RIP 协议优缺点总结：</strong></p>
<p>（1）RIP 协议最大的优点就是实现简单，开销较小。</p>
<p>（2）RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。</p>
<p>（3）路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。  </p>
<p>（4）坏消息传播得慢，使更新过程的时间过长。</p>
<p> 最后有条件的可以自己做个实验：<strong>实验</strong> <strong>4-7</strong>**：配置** <strong>RIP</strong> <strong>动态路由。</strong></p>
<h4 id="63-内部网关协议-ospf">6.3 内部网关协议 OSPF</h4>
<p> 开放最短路径优先 OSPF（Open Shortest Path First）是为了克服 RIP 的缺点而开发出来的。</p>
<p>●  “开放” 表明 OSPF 是一个公开发表的协议。</p>
<p>●  “最短路径优先” 是因为使用了 Dijkstra 提出的 最短路径优先 SPF 算法。</p>
<p>● OSPF 最主要的特征就是使用 分布式 的链路状态协议，不是像 RIP 那样的距离向量协议</p>
<p>OSPF 协议的特点：<br>
<strong>（1）用<strong><strong>洪</strong></strong>泛法<strong><strong>向本自治系统中</strong></strong>所有的路由器****发送信息。</strong></p>
<p><strong>（2）发送的信息是与本路由器<strong><strong>相邻</strong></strong>的所有路由器的<strong><strong>链路状态</strong></strong>，而这只是路由器所知道的<strong><strong>部分信息</strong></strong>。</strong></p>
<p>●  链路状态 指明本 路由器都和哪些路由器相邻，以及该链路的度量 (metric)。</p>
<p>●  链路状态的 “度量” 可以是距离、带宽、时延或费用等</p>
<p><strong>（3）当链路状态<strong><strong>发生变化</strong></strong>或每隔一段时间，路由器<strong><strong>才用</strong></strong>洪泛法向所有路由器发送链路状态信息。</strong></p>
<p> 洪泛法工作图解：</p>
<p><img src="./imgs/bf7ec9bcf7c442fbabad91096f1f92fd.png" alt=""></p>
<p>路由器 R 使用可靠的洪泛法（收到更新分组后要发送确认）发出链路状态更新分组给其相邻的三个路由器，这三个路由器再将收到的分组再进行转发（上游路由器除外）……</p>
<blockquote>
<p>知识补充：</p>
<p>（1）<strong>所有的</strong>路由器都维持一个链路状态数据库 (link-state database)，这个数据库实际上就是全网的拓扑结构图。这个拓扑结构图在全网范围内是一致的，每个路由器都知道整个网络的拓扑结构。</p>
<p>（2）<strong>每个</strong>路由器根据链路状态数据库中的数据，使用 SPF 算法构造出自己的路由表。 </p>
<p>（3）上面所介绍的使用 RIP 协议的每个路由器虽然知道所有网络的距离以及吓一跳路由器，但却不知道全网的的拓扑结构（只有到了下一跳路由器，才能知道下一跳应该怎么走~）</p>
<p>  (4)  RIP 适用于小型互联网， OSPF 适用于大型互联网。</p>
</blockquote>
<p>为了能把 OSPF 用于规模更大的网络，<strong>OSPF</strong> <strong>把自治系统再划分为不同的****区域</strong> <strong>(area</strong>**)****：**</p>
<p><img src="./imgs/c4115674a7df4ecdae09da3cdbaa5ec5.png" alt=""></p>
<p>书上 P165 对于它的介绍简单了解下就行了，反正我们学校不要求掌握，hh~ </p>
<h4 id="64-外部网关协议-bgp">6.4 外部网关协议 BGP</h4>
<p>由于不同的自治系统使用不同的内部路由选择协议并使用不同的度量，所以必须在不同的自治系统之间使用另外的路由选择协议。目前使用最多的是边界网关协议 BGP， 其最新版本是 BGP-4（常简写为 BGP）。</p>
<p>注意：BGP 只能是力求寻找一条能够到达目的网络且比较好的路由，而并非要寻找一条最佳路由。</p>
<p> 我们学校介绍的极为简略，可能不会怎么考察，如果需要深入了解的，看这篇博客吧：</p>
<p><a href="https://blog.csdn.net/keith6785753/article/details/107088632?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168500349716800215090112%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168500349716800215090112&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-107088632-null-null.142%5Ev88%5Einsert_down28v1,239%5Ev2%5Einsert_chatgpt&amp;utm_term=BGP&amp;spm=1018.2226.3001.4187" title="BGP协议总结（比较详细，好理解）_Looo~ye的博客-CSDN博客">BGP 协议总结（比较详细，好理解）_Looo~ye 的博客 - CSDN 博客</a></p>
<p>还有书上 P175 对于路由器构成的介绍，都去看一下，对你有好处，我就不写了~</p>
<h3 id="七ip-多播">七、IP 多播</h3>
<p> 这里看两种情况的对比，就能清楚 IP 多播的好处了：</p>
<p><img src="./imgs/b22d01c4552e47569ae5534552686027.png" alt=""></p>
<p> 当采用多播后：</p>
<p><img src="./imgs/edc4d92a244744e4977c3ff199ff4146.png" alt=""></p>
<p>当需要信息的主机数增大，效果更明显 。</p>
<p>需要我们记的知识点：</p>
<blockquote>
<p><strong>（1）<strong><strong>IP</strong> **多播所传送的分组需要使用</strong><strong>多</strong>**播</strong> <strong>IP</strong> <strong>地址，也就是</strong> <strong>D</strong> <strong>类</strong> <strong>IP</strong> <strong>地址（224.0.0.0 —— 239.255.255.255）。</strong></p>
<p><strong>（2）多播地址只能用于目的地址，而不能用于源地址。</strong></p>
<p><strong>（3）IP</strong> <strong>多<strong><strong>播可以分为</strong></strong>两种，一<strong><strong>种是只在本局域网上进行硬件多播，另一种则是在互联网的范围进行多播</strong></strong>。在<strong><strong>互联网上进行多播的最后阶段，还是要把多播数据报在局域网上用硬件多播交付多播组的所有</strong></strong>成员。</strong></p>
<p><strong>（4）多播数据报的协议字段为 2，表明使用网际组管理协议 IGMP。</strong></p>
</blockquote>
<p>当然还有很多知识没说明的，比如 IGMP 协议 和 多播路由选择协议 的介绍。由于我们学校对于非这方面专业的学生要求挺低的，所有就不讲了，需要去进一步了解的，可以自己去看书上 P181 那几页，或者搜博客看，相信看完一定对你有很大收获的。</p>
<h3 id="八虚拟专用网-vpn-和网络地址转换-nat">八、虚拟专用网 VPN 和网络地址转换 NAT</h3>
<p> 考虑到 IP 地址的紧缺，以及某些主机只需要和本机构内部的其他主机进行通信，互联网管理机构将一部分 IP 地址作为专用地址（private address）供机构内部自行分配使用。</p>
<p>专用地址只能用于一个机构的内部通信，不能用于和互联网上的主机通信（互联网中的所有路由器对目的地址是专用地址的数据报一律不进行转发）。不同的机构在内部可使用相同的专用地址。</p>
<p><strong>与专用地址相对的是<strong><strong>全球地址</strong></strong>，这是互联网主机通信所必须具有的、全球****唯一的</strong> <strong>IP</strong> <strong>地址，必须向互联网的管理机构****申请才可以使用。</strong></p>
<p>互联网管理机构划分的三个 IPv4 专用地址块如下：</p>
<p>10.0.0.0/8 ，即从 10.0.0.0 到 10.255.255.255</p>
<p>172.16.0.0/12 ，即从 172.16.0.0 到 172.31.255.255</p>
<p>192.168.0.0/16，即从 192.168.0.0 到 192.168.255.255</p>
<p><strong>虚拟专用网 VPN</strong></p>
<p>采用专用 IP 地址的互连网络称为专用网。</p>
<p>如果一个机构有很多部门且分布在世界各地，就可以利用公用的互联网作为此机构各专用网之间的通信载体，形成一个更大的专用网，这样的专用网称为虚拟专用网 VPN (Virtual Private Network)。虚拟专用网用于一个机构内部的主机通信，而不是用于和机构外的主机通信。</p>
<p>这时候，你可能就有疑问了，既然要借用公用的 IP 地址传输，那怎么实现呢？难道不会泄密嘛？ </p>
<p><img src="./imgs/5a86ef42e3d341a4890e81c0332ea1d6.png" alt=""></p>
<p>部门 A 和部门 B 要借助两个路由器 R1 和 R2（它们的一个接口地址必须是合法的全球 IP 地址，在专有网内部网络的接口地址则是专有网的本地地址） 。假设部门 A 的 x 要和部门 B 的 y 通信 ， X 先把数据报发给 R1，此时 R1 发现数据的源地址是 10.1.01，目的地址是 10.2.0.3，必须要通过公有的互联网才能到达，它就先把整个内部数据报进行加密，这样就保证了安全，然后重新加上数据报的首部（就是在原来数据报的首部前在加一个新首部），其源地址是路由器 R1 的全球 IP 地址 125.1.2.3，目的地址是 194.4.5.6。路由器 R2 收到该数据报后，将其数据部分取出进行解密，恢复出原来的内部数据报（目的地址是 10.2.0.3），然后交付给主机 Y。</p>
<p><img src="./imgs/79828e2f106440a4bce9b5ec9345e010.png" alt=""></p>
<p><strong>远程接入 VPN</strong></p>
<p>有的公司可能没有分布在不同场所的部门，但却有很多流动员工在外地工作，他们需要经常访问公司内网的服务器，远程接入 VPN 可满足这种需求。</p>
<p>在外地工作的员工通过拨号接入互联网，而员工个人电脑中的 VPN 软件可在员工的个人电脑和公司的主机之间建立 VPN 隧道（当然也是加密的），因而外地员工就可以使用公司内部的网络了。</p>
<p><strong>网络地址转换 NAT</strong></p>
<p>专用网内的主机如果想要和互联网上的主机通信，使用得最多的方法是网络地址转换 NAT</p>
<p>这种方法需要在专用网连接到互联网的路由器上安装 NAT 软件。装有 NAT 软件的路由器叫做 NAT 路由器，它至少有一个有效的全球 IP 地址。</p>
<p><strong>所有使用专用地址的主机在和外界通信时都要在</strong> <strong>NAT</strong> <strong>路由器上将其专用地址转换成全球</strong> <strong>IP</strong> <strong>地址才能和互联网通信。</strong><img src="./imgs/df9350ca81d74e3fbbbe0dd148c72803.png" alt=""></p>
<p>在看了书上 P188 的解释说明后，在<strong>内部主机与外部主机通信时，在</strong> <strong>NAT</strong> <strong>路由器上发生了两次地址转换：</strong></p>
<p>离开专用网时：替换源地址， 将专用地址 替换为全球地址。</p>
<p>进入专用网时：替换目的地址，将全球地址替换 为专用地址</p>
<p><strong>NAT</strong> <strong>转换</strong> <strong>表举例：</strong></p>
<p><img src="./imgs/c7a5195b4333408385509e4153f580c3.png" alt=""></p>
<p>当 NAT 路由器具有 <em>n</em> 个全球 IP 地址时，专用网内最多可以同时有 <em>n</em> 台主机接入到互联网。可以使专用网内较多数量的主机轮流使用 NAT 路由器有限数量的全球 IP 地址。</p>
<p>注意：通过 NAT 路由器的通信必须由专用网内的主机发起，因此专用网内部的主机不能直接充当服务器用。</p>
<p><strong>网络地址与端口号转换 NAPT</strong></p>
<p>从上面的介绍，不难看出 NAT 并不能节省 IP 地址。为了更加有效地利用 NAT 路由器上的全球 IP 地址，现在常用的 NAT 转换表把运输层的端口号也利用上。这样，就可以使多个专用网主机，共用 NAT 路由器上的一个全球 IP 地址，同时和互联网上的不同主机进行通信。</p>
<p>使用端口号的 NAT 叫做网络地址与端口号转换 NAPT (Network Address and Port Translation)，而不使用端口号的 NAT 就叫做传统的 NAT (traditional NAT)。</p>
<p><strong>NAPT 转换表举例：</strong></p>
<p><img src="./imgs/208d03b2c9244c9fb32004b526f0a2a3.png" alt=""></p>
<blockquote>
<p>NAPT 把专用网内不同的源 IP 地址都转换为相同的全球 IP 地址，但将 TCP 源端口号（不管是否不同）转换为不同的新的端口号。</p>
<p>当 NAPT 路由器收到从互联网发来的应答时，就可以从 IP 数据报的数据部分找出运输层端口号，然后根据不同的目的端口号，从 NAPT 转换表中找到正确的目的主机和端口号。</p>
</blockquote>

    </div>
    
    

    

</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=">
            

        </a>

        <a href="//tryanel.github.io/days/" target="_blank">
            
            明天，我们会更好
            
        </a>
    </div>

    <div class="info">
        <a href="https://github.com/Tryanel/Tryanel.github.io">Copyright</a> © 2023 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="background-color: rgba(255, 255, 255, 0.81);"></div>
    </body>
</html>
